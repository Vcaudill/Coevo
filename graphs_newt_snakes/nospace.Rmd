---
title: "Nospace"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(ggplot2)
library(viridis)
library(colorspace)
library(gridExtra)
library(tidyverse)
require(reshape2)
library(plyr)
library(gridGraphics)
library(grid)
```

## No Space?

This is may no space experiment! I worked with Peter to make the 1on1 newt-snake simulation into a simulation that is not dependent on space. We changed a few things that were dependent on space like reproduction and the interaction, but everything else remained mostly the same.

Some things to not is that in the reproduction callback new individuals will be paced near their parents, but their parents are randomly chosen for anywhere in the simulation. Population size is determined by the amount of individuals in the whole area. To choose the amount of interactions between newts and snake we use numNeighbors = rbinom(1, p1.individualCount, (interaction_rate * 2 * PI * surs^2)/W^2). This will choose a value based on a binomial distribution with the newt population as the size (amount that could be drawn) and a probability of success based on the interaction rate, area a snake and the total area of the simulation.

Extra notes: From a fist glance at the visual output there is a lack of color (color represents phenotype) 

## My Goals

The goal of this experiment is to see in there is a change in the newts and snakes phenotype that is not based on spatial interactions. Specifically, in this experiment there will be no spatial interaction (between newts and snakes). I will compare these results to all of my other simulations data!

## The Specifics of the Simulations

To make these simulations similar to the previous simulation experiments I use the same msprime files to start each of the SLiM simulations. I also keep the parameters the same. 

```{r, making data frames}

making_data_frames <- function(files, spe_col) {
i=1
for (current_file in files){
 #print(current_file)

  if(i ==1){
    file <- read.table(current_file, header = TRUE)
  
    file[[spe_col]][file[[spe_col]] == "NULL"] <- NA
      # might want to change to all_of(spe_col)
    file %>% 
      select(all_of(spe_col), gen) %>%
      #rownames_to_column() %>% 
      gather(variable, value, -gen) %>% 
      spread(gen, value) -> new_file
      
    new_file$variable[i] <- paste0(spe_col,"_trial_", i)
    i = i + 1
    next
    }
  file <- read.table(current_file, header = TRUE)
  
  file[[spe_col]][file[[spe_col]] == "NULL"] <- NA

file %>% 
  select(all_of(spe_col), gen) %>%
  #rownames_to_column() %>% 
  gather(variable, value, -gen) %>% 
  spread(gen, value) -> temp_file

temp_file$variable[1] <- paste0(spe_col,"_trial_", i)

new_file<-rbind(new_file, temp_file)
i = i + 1
}
return(new_file)
}

```

```{r, making resueable figures, results='hide', message=FALSE, warning=FALSE}

phenotype_trends <- function(file, title, subt, my_color, is_log=FALSE, leg_off=FALSE){
  data_frame_temp <- as.data.frame(t(file))
  
  colnames(data_frame_temp) <- data_frame_temp[1,]
  names(data_frame_temp) <- colnames(data_frame_temp)
  steps <- colnames(file[ , !(names(file) %in% "variable")])
data_frame_temp <- data_frame_temp[-1, ] 
data_frame_temp$steps <- as.numeric(unlist(steps))
  
  graph_file <- melt(data_frame_temp,  id.vars = 'steps', variable.name = 'series')
  
    p <- ggplot(graph_file, aes(steps, as.numeric(value))) + geom_line(aes(colour = series))+ 
    ggtitle(title, subtitle = subt) +
    scale_color_manual(values = rep(my_color, nrow(file)))+
    xlab("Generations") + ylab("Interaction")+
    theme_bw() + theme(legend.position="none")
    
    if(is_log==TRUE){
  p = p + scale_y_log10() + ylab("Interaction (Log)")
    }
     if(leg_off==TRUE){
 p = p+ theme(legend.position = "none")}
    return(p)
}

var_by_var <- function(Newt_file_x, Snake_file_x, Newt_file_y, Snake_file_y, title, subt, x_label, y_label, logy=FALSE, subtract_x=FALSE, by_gen=FALSE, just_two=FALSE, colored=FALSE, color_label=NULL, highcol="darkseagreen"){

  data_frame_newt_temp_x <- Newt_file_x
  data_frame_newt_temp_x <- data_frame_newt_temp_x[ , !(names(data_frame_newt_temp_x) %in% "variable")]
  
  data_frame_snake_temp_x <- Snake_file_x
  data_frame_snake_temp_x <- data_frame_snake_temp_x[ , !(names(data_frame_snake_temp_x) %in% "variable")]
  
  data_frame_newt_temp_y <- Newt_file_y
  data_frame_newt_temp_y <- data_frame_newt_temp_y[ , !(names(data_frame_newt_temp_y) %in% "variable")]
  
  data_frame_snake_temp_y <- Snake_file_y
  data_frame_snake_temp_y <- data_frame_snake_temp_y[ , !(names(data_frame_snake_temp_y) %in% "variable")]
  
  
  Number <- colnames(data_frame_newt_temp_x)
  data_frame_newt_x <- gather(data_frame_newt_temp_x, Number, value_x)
  data_frame_newt_x$type <- "Newt"
  data_frame_newt_y <- gather(data_frame_newt_temp_y, Number, value_y)
  data_frame_newt <- cbind(data_frame_newt_x, data_frame_newt_y)
  data_frame_newt <- data_frame_newt[-4]
  data_frame_snake_x <- gather(data_frame_snake_temp_x, Number, value_x)
  data_frame_snake_x$type <- "Snake"
  data_frame_snake_y <- gather(data_frame_snake_temp_y, Number, value_y)
  data_frame_snake <- cbind(data_frame_snake_x, data_frame_snake_y)
  data_frame_snake <- data_frame_snake[-4]
  
  
 if(subtract_x==FALSE){
   combo <- rbind(data_frame_newt, data_frame_snake)
   combo_s <- combo[sample(nrow(combo), nrow(combo)), ]
   p <- ggplot(combo_s) +
    #xlim(0, 1000)+
      ggtitle(title, subtitle = subt) +
      xlab(x_label) + ylab(y_label)+
      geom_point(aes(x=as.numeric(value_x), y=as.numeric(value_y), color=type), alpha=0.1)+
      scale_color_manual(name = "Species", values = c("Newt" = "darkred", "Snake" = "steelblue"))+
      theme(plot.title = element_text(size=5)) +
      theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))
 }
 if(subtract_x==TRUE){
    subtract_val <- data_frame_snake_x$value_x - data_frame_newt_x$value_x
    total_sub_dataframe <- data.frame(subtract_val, data_frame_newt_y$value_y, data_frame_snake_y$value_y)
    total_sub_dataframe <- total_sub_dataframe[sample(nrow(total_sub_dataframe), nrow(total_sub_dataframe)), ]
    colnames(total_sub_dataframe) <- c("SnakeMisNewt_Pheno","Newts","Snakes")
     p <- ggplot(total_sub_dataframe) +
      #xlim(0, 1000)+
       ggtitle(title, subtitle = subt) +
       xlab(x_label) + ylab(y_label)+
       geom_point(aes(x=as.numeric(SnakeMisNewt_Pheno), y=as.numeric(Newts), color="Newts"), alpha=0.1)+
       geom_point(aes(x=as.numeric(SnakeMisNewt_Pheno), y=as.numeric(Snakes), color="Snakes"), alpha=0.1)+
        scale_colour_manual(name = "Species", values = c("Newts" = "darkred", "Snakes" = "steelblue"))+
        theme(plot.title = element_text(size=5)) +
        theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))
 }
  if(by_gen==TRUE){
    combo <- rbind(data_frame_newt, data_frame_snake)
    combo_s <- combo[sample(nrow(combo), nrow(combo)), ]
       p <- ggplot(combo_s) +
    #xlim(0, 1000)+
      ggtitle(title, subtitle = subt) +
      xlab(x_label) + ylab(y_label)+
      geom_point(aes(x=as.numeric(Number), y=as.numeric(value_y), color=type), alpha=0.1)+
      scale_color_manual(name = "Species", values = c("Newt" = "darkred", "Snake" = "steelblue"))+
      theme(plot.title = element_text(size=5)) +
      theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))
  }
  
  
  
   if(just_two==TRUE){
     just2 <- cbind(data_frame_newt_x, data_frame_snake_y)
     just2 <- just2[-4]
       p <- ggplot(just2) +
    #xlim(0, 1000)+
      ggtitle(title, subtitle = subt) +
      xlab(x_label) + ylab(y_label)+
      geom_point(aes(x=as.numeric(value_x), y=as.numeric(value_y)), color = "darkgreen", alpha=0.1)+
      theme(plot.title = element_text(size=5)) +
      theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))
   }
  

   if(colored==TRUE){
     color3 <- cbind(data_frame_newt_x, data_frame_snake_y, data_frame_newt_y)
     color3 <- color3[-c(1,3,4,6)]
     suppressWarnings(suppressMessages(suppressPackageStartupMessages({require(scales)})))
     amin <- 0.1
     lowcol.hex <- as.hexmode(round(col2rgb(highcol) * amin + 255 * (1 - amin)))
     lowcol <- paste0("#",   sep = "",
                 paste(format(lowcol.hex, width = 2), collapse = ""))
       p <- ggplot(color3) +
    #xlim(0, 1000)+
      ggtitle(title, subtitle = subt) +
      xlab(x_label) + ylab(y_label)+
      geom_point(aes(x=as.numeric(value_x), y=as.numeric(value_y), color = value_y.1))+
      theme(plot.title = element_text(size=5)) +
      scale_colour_gradient(high = highcol, low = lowcol) + 
      labs(colour = color_label) +
      theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))
  }
  if(logy==TRUE){
    p = p + scale_y_log10()
  }
  
  
  
  return(p)
 
  
}


```

```{r, beta info}
# graph the betas
files <- list.files(path="~/Desktop/nospace/u5", pattern="nu_*1.56", full.names=TRUE, recursive=FALSE)
file <- read.table(files[51], header = TRUE)
beta_n <- making_data_frames(files, all_of("beta_n"))
beta_s <- making_data_frames(files, all_of("beta_s"))
Newt_mean_Pheno <- making_data_frames(files, all_of("Newt_mean_Pheno"))
Snake_mean_Pheno <- making_data_frames(files, all_of("Snake_mean_Pheno"))
mean_newts_eaten <- making_data_frames(files, all_of("mean_newts_eaten"))
mean_snakes_eaten <- making_data_frames(files, all_of("mean_snakes_eaten"))
newt_deaths <- making_data_frames(files, all_of("newt_deaths"))
snake_deaths <- making_data_frames(files, all_of("snake_deaths"))
Newt_age <- making_data_frames(files, all_of("Newt_age"))
Snake_age <- making_data_frames(files, all_of("Snake_age"))
Newt_pop_size <- making_data_frames(files, all_of("Newt_pop_size"))
Snake_pop_size <- making_data_frames(files, all_of("Snake_pop_size"))
```
