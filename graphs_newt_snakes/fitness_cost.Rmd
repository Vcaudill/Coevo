---
title: "Fitness Cost"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(ggplot2)
library(viridis)
library(colorspace)
library(gridExtra)
library(tidyverse)
require(reshape2)
library(plyr)
library(gridGraphics)
library(grid)
```

## Fitness Cost

In my newts and snakes simulation the phenotypes of both of the populations keeps increasing forever. In the spatial simulations this increase eventually leads to the death of one of the species and the collapses of the SLiM simulation (something I currently calculate needs to have individuals). To have my simulation run essentially forever I wanted to add in a cost to having a high phenotype. 

Too come up with a cost curve I thought about the biology behind the existence of a fitness cost in the context of newts and snakes. In snakes for every mutation that allows for them to be resistant to the toxin they partially break their mobility. So snakes become slower when they are more resistant and can be preyed upon by other predators. Newts are a bit more complicated. It is unknown if there is a fitness cost for being more toxic. Maybe producing toxin makes them slower, maybe it takes more energy to produce so there is less energy for offspring.

Here is an example of what I think a fitness cost might look like (values are not realistic). As the phenotype gets larger the phenotype has a higher cost. So to keep a high cost phenotype there needs to be strong selection. The graph below is my initial idea on how fitness cost in my system should work.


```{r, fitness cost}


phenotype <- c(0:5)
plot(phenotype, phenotype^2, type = "l", main="Fitness Cost", xlab="Phenotype", ylab="Cost")
abline(v=3, col="red")
abline(h=9, col="red") # represents half of the individuals fitness
```

I chose a phenotype of 3 to be half as good (this might be a tad too strong). I chose the value 3 because of the phenotypes of newts and snakes seen in the Brodies map. To calculate cost I need to look at the fitness scaling (between 0 and 1) and make my chosen phenotype meet the line at half of the total fitness (0.5). 

Fitness scaling = e^-cost 

If a phenotype of 3 is half the total fitness the cost would be log 2

c(p) = (a/b)^2
c(3) = (a/b)^2
log(2) = (a/b)^2
b = 3/log(2) = 10

SO cost = (phenotype/10)^2

**Special Note** Phenotype is arbitrary (scale for the snakes resistance) 

A cost would push the phenotypes back towards 0, but would also make it harder to observe selection. I ran one simulation with the cost once and the phenotypes just keep decreasing (math version will be presented later). The simulation ran for a long time (5000 generations) and the population size did not explode or decrease. Is it possible for the phenotypes to be completely pushed back to 0? Are non-zero phenotypes a sign of poitive selection (especially if they started above 0)? Do we still see spots were coevolution is happening? Should I change the slope of the cost curve?


## Dataframe and Graphs

I use the same method for building my dataframes and figures as I did in the nospace R markdown. My general theme is to make my figures and data frames reusable from simulation to simulation and from one variable to the next. It might be helpful to write some more information about each of the functions that I use.  

```{r, making data frames}

making_data_frames <- function(files, spe_col) {
i=1
for (current_file in files){
 #print(current_file)

  if(i ==1){
    file <- read.table(current_file, header = TRUE)
  
    file[[spe_col]][file[[spe_col]] == "NULL"] <- NA
      # might want to change to all_of(spe_col)
    file %>% 
      select(all_of(spe_col), gen) %>%
      #rownames_to_column() %>% 
      gather(variable, value, -gen) %>% 
      spread(gen, value) -> new_file
      
    new_file$variable[i] <- paste0(spe_col,"_trial_", i)
    i = i + 1
    next
    }
  file <- read.table(current_file, header = TRUE)
  
  file[[spe_col]][file[[spe_col]] == "NULL"] <- NA

file %>% 
  select(all_of(spe_col), gen) %>%
  #rownames_to_column() %>% 
  gather(variable, value, -gen) %>% 
  spread(gen, value) -> temp_file

temp_file$variable[1] <- paste0(spe_col,"_trial_", i)

new_file<-rbind(new_file, temp_file)
i = i + 1
}
return(new_file)
}

```

```{r, making resueable figures, results='hide', message=FALSE, warning=FALSE}

phenotype_trends <- function(file, title, subt, my_color, is_log=FALSE, leg_off=FALSE){
  # Looks at the mean phenotype of all of the simulations and graphs them as lines together
  # good for seeing what all of the simulations are doing
  # it can log the y axis and turn off the legend
  data_frame_temp <- as.data.frame(t(file))
  
  colnames(data_frame_temp) <- data_frame_temp[1,]
  names(data_frame_temp) <- colnames(data_frame_temp)
  steps <- colnames(file[ , !(names(file) %in% "variable")])
data_frame_temp <- data_frame_temp[-1, ] 
data_frame_temp$steps <- as.numeric(unlist(steps))
  
  graph_file <- melt(data_frame_temp,  id.vars = 'steps', variable.name = 'series')
  
    p <- ggplot(graph_file, aes(steps, as.numeric(value))) + geom_line(aes(colour = series))+ 
    ggtitle(title, subtitle = subt) +
    scale_color_manual(values = rep(my_color, nrow(file)))+
    xlab("Generations") + ylab("Phenotype")+
    theme_bw() + theme(legend.position="none")
    
    if(is_log==TRUE){
  p = p + scale_y_log10() + ylab("Phenotype (Log)")
    }
     if(leg_off==TRUE){
 p = p+ theme(legend.position = "none")}
    return(p)
}

var_by_var <- function(Newt_file_x, Snake_file_x, Newt_file_y, Snake_file_y, title, subt, x_label, y_label, logy=FALSE, subtract_x=FALSE, by_gen=FALSE, just_two=FALSE, colored=FALSE, color_label=NULL, highcol="darkseagreen"){

  # very powerful and confusing graph. It can plot a max of 4 variables at a time!
  # I use it to compare newts and snakes to each other
  # I can log the y axis
  # I can look at things by generation (uses just the newt x and snake x)
  # I can compare newt to snake (uses the newt x and snake y)
  # I can subtract (snake - newt) (subtracts the x value and plots the y value)
  # Color can plot var by var and pick a 3rd var to color the points (use thenewt x, snake y and newt file y for the color)
  
  data_frame_newt_temp_x <- Newt_file_x
  data_frame_newt_temp_x <- data_frame_newt_temp_x[ , !(names(data_frame_newt_temp_x) %in% "variable")]
  
  data_frame_snake_temp_x <- Snake_file_x
  data_frame_snake_temp_x <- data_frame_snake_temp_x[ , !(names(data_frame_snake_temp_x) %in% "variable")]
  
  data_frame_newt_temp_y <- Newt_file_y
  data_frame_newt_temp_y <- data_frame_newt_temp_y[ , !(names(data_frame_newt_temp_y) %in% "variable")]
  
  data_frame_snake_temp_y <- Snake_file_y
  data_frame_snake_temp_y <- data_frame_snake_temp_y[ , !(names(data_frame_snake_temp_y) %in% "variable")]
  
  
  Number <- colnames(data_frame_newt_temp_x)
  data_frame_newt_x <- gather(data_frame_newt_temp_x, Number, value_x)
  data_frame_newt_x$type <- "Newt"
  data_frame_newt_y <- gather(data_frame_newt_temp_y, Number, value_y)
  data_frame_newt <- cbind(data_frame_newt_x, data_frame_newt_y)
  data_frame_newt <- data_frame_newt[-4]
  data_frame_snake_x <- gather(data_frame_snake_temp_x, Number, value_x)
  data_frame_snake_x$type <- "Snake"
  data_frame_snake_y <- gather(data_frame_snake_temp_y, Number, value_y)
  data_frame_snake <- cbind(data_frame_snake_x, data_frame_snake_y)
  data_frame_snake <- data_frame_snake[-4]
  
  
 if(subtract_x==FALSE){
   combo <- rbind(data_frame_newt, data_frame_snake)
   combo_s <- combo[sample(nrow(combo), nrow(combo)), ]
   p <- ggplot(combo_s) +
    #xlim(0, 1000)+
      ggtitle(title, subtitle = subt) +
      xlab(x_label) + ylab(y_label)+
      geom_point(aes(x=as.numeric(value_x), y=as.numeric(value_y), color=type), alpha=0.1)+
      scale_color_manual(name = "Species", values = c("Newt" = "darkred", "Snake" = "steelblue"))+
      theme(plot.title = element_text(size=5)) +
      theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))
 }
 if(subtract_x==TRUE){
    subtract_val <- data_frame_snake_x$value_x - data_frame_newt_x$value_x
    total_sub_dataframe <- data.frame(subtract_val, data_frame_newt_y$value_y, data_frame_snake_y$value_y)
    total_sub_dataframe <- total_sub_dataframe[sample(nrow(total_sub_dataframe), nrow(total_sub_dataframe)), ]
    colnames(total_sub_dataframe) <- c("SnakeMisNewt_Pheno","Newts","Snakes")
     p <- ggplot(total_sub_dataframe) +
      #xlim(0, 1000)+
       ggtitle(title, subtitle = subt) +
       xlab(x_label) + ylab(y_label)+
       geom_point(aes(x=as.numeric(SnakeMisNewt_Pheno), y=as.numeric(Newts), color="Newts"), alpha=0.1)+
       geom_point(aes(x=as.numeric(SnakeMisNewt_Pheno), y=as.numeric(Snakes), color="Snakes"), alpha=0.1)+
        scale_colour_manual(name = "Species", values = c("Newts" = "darkred", "Snakes" = "steelblue"))+
        theme(plot.title = element_text(size=5)) +
        theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))
 }
  if(by_gen==TRUE){
    combo <- rbind(data_frame_newt, data_frame_snake)
    combo_s <- combo[sample(nrow(combo), nrow(combo)), ]
       p <- ggplot(combo_s) +
    #xlim(0, 1000)+
      ggtitle(title, subtitle = subt) +
      xlab(x_label) + ylab(y_label)+
      geom_point(aes(x=as.numeric(Number), y=as.numeric(value_y), color=type), alpha=0.1)+
      scale_color_manual(name = "Species", values = c("Newt" = "darkred", "Snake" = "steelblue"))+
      theme(plot.title = element_text(size=5)) +
      theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))
  }
  
  
  
   if(just_two==TRUE){
     just2 <- cbind(data_frame_newt_x, data_frame_snake_y)
     just2 <- just2[-4]
       p <- ggplot(just2) +
    #xlim(0, 1000)+
      ggtitle(title, subtitle = subt) +
      xlab(x_label) + ylab(y_label)+
      geom_point(aes(x=as.numeric(value_x), y=as.numeric(value_y)), color = "darkgreen", alpha=0.1)+
      theme(plot.title = element_text(size=5)) +
      theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))
   }
  

   if(colored==TRUE){
     color3 <- cbind(data_frame_newt_x, data_frame_snake_y, data_frame_newt_y)
     color3 <- color3[-c(1,3,4,6)]
     suppressWarnings(suppressMessages(suppressPackageStartupMessages({require(scales)})))
     amin <- 0.1
     lowcol.hex <- as.hexmode(round(col2rgb(highcol) * amin + 255 * (1 - amin)))
     lowcol <- paste0("#",   sep = "",
                 paste(format(lowcol.hex, width = 2), collapse = ""))
       p <- ggplot(color3) +
    #xlim(0, 1000)+
      ggtitle(title, subtitle = subt) +
      xlab(x_label) + ylab(y_label)+
      geom_point(aes(x=as.numeric(value_x), y=as.numeric(value_y), color = value_y.1))+
      theme(plot.title = element_text(size=5)) +
      scale_colour_gradient(high = highcol, low = lowcol) + 
      labs(colour = color_label) +
      theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))
  }
  if(logy==TRUE){
    p = p + scale_y_log10()
  }
  
  
  
  return(p)
 
  
}

phenotype_boxplot <- function(Newt_file, Snake_file, title, subt, boxy=FALSE, section=FALSE, section_num=0, leg_off=FALSE, ylim_max=100){
  #this function can graph phenotype of all of the simulations (as a mean or boxplot) by generations (I can specify the amount of generations to show)
  data_frame_newt_temp <- Newt_file
  data_frame_newt_temp <- data_frame_newt_temp[ , !(names(data_frame_newt_temp) %in% "variable")]
  
  data_frame_snake_temp <- Snake_file
  data_frame_snake_temp <- data_frame_snake_temp[ , !(names(data_frame_snake_temp) %in% "variable")]
  
   if(section==TRUE){
   
   selcol = seq(1,ncol(data_frame_newt_temp), section_num)
   data_frame_newt_temp <- data_frame_newt_temp %>% select(all_of(selcol))
   data_frame_snake_temp <- data_frame_snake_temp %>% select(all_of(selcol))
   
   }
   Number <- colnames(data_frame_newt_temp)
  data_frame_newt <- gather(data_frame_newt_temp, Number, value)
  data_frame_newt$type <- "Newt"
  data_frame_snake <- gather(data_frame_snake_temp, Number, value)
  data_frame_snake$type <- "Snake"
  
 combo <- rbind(data_frame_newt, data_frame_snake)
 
 small_combo <- aggregate(as.numeric(combo$value),by=list(Number=as.numeric(combo$Number),type=combo$type),data=combo,FUN=mean, na.action = TRUE)

if(boxy==TRUE){
  p <- ggplot(combo) +
    ylim(0, ylim_max)+
    ggtitle(title, subtitle = subt) +
    xlab("Generation") + ylab("Average Phenotypes")+
    scale_color_manual(name = "Species", values = c("Newt" = "darkred", "Snake" = "steelblue"))+
    theme(plot.title = element_text(size=5)) +
    theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))+
    geom_boxplot(aes(x=factor(as.numeric(Number)), y=as.numeric(value), color=type) )
  }
if(boxy==FALSE){
  p <- ggplot(small_combo) +
  #xlim(0, 1000)+
    ggtitle(title, subtitle = subt) +
    xlab("Generation") + ylab("Average Phenotypes")+
    scale_color_manual(name = "Species", values = c("Newt" = "darkred", "Snake" = "steelblue"))+
    theme(plot.title = element_text(size=5)) +
    theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))+
    geom_point(aes(x=factor(as.numeric(Number)), y=as.numeric(x), color=type) )
}

 if(leg_off==TRUE){
 p = p+ theme(legend.position = "none")}

return(p)
}


phenotype_dif_boxplot <- function(Newt_file, Snake_file, title, subt, boxy=FALSE, section=FALSE, section_num=0, leg_off=FALSE){
  #this function can graph to difference between phenotypes of all of the simulations (as lines or boxplot) by generations
  #(I can specify the amount of generations to show)
  data_frame_newt_temp <- Newt_file
  data_frame_newt_temp <- data_frame_newt_temp[ , !(names(data_frame_newt_temp) %in% "variable")]
  
  data_frame_snake_temp <- Snake_file 
  data_frame_snake_temp <- data_frame_snake_temp[ , !(names(data_frame_snake_temp) %in% "variable")]

  if(section==TRUE){
   
   selcol = seq(1,ncol(data_frame_newt_temp), section_num)
   data_frame_newt_temp <- data_frame_newt_temp %>% select(all_of(selcol))
   data_frame_snake_temp <- data_frame_snake_temp %>% select(all_of(selcol))
   
 }
  
  Number <- colnames(data_frame_newt_temp)
  data_frame_newt <- gather(data_frame_newt_temp, Number, value)
  data_frame_snake <- gather(data_frame_snake_temp, Number, value)
  dif <- as.numeric(data_frame_snake$value)-as.numeric(data_frame_newt$value)
  
  df_dif <- as.data.frame(dif)
  df_dif$Number <- as.numeric(data_frame_newt$Number)
  
  if(boxy==TRUE){
 p <- ggplot(df_dif) +
    ggtitle(title, subtitle = subt) +
    xlab("Generation") + ylab("Average Phenotype Differences")+
    theme(plot.title = element_text(size=5)) +
    theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))+
    geom_boxplot(aes(x=factor(as.numeric(Number)), y=as.numeric(dif)), color="darkolivegreen" )
 }
 if(boxy==FALSE){
   df_dif$trial <- rep(Newt_file$variable, ncol(Newt_file)-1)
   p <- ggplot(df_dif) +
    ggtitle(title, subtitle = subt) +
    xlab("Generation") + ylab("Average Phenotype Differences")+
    theme(plot.title = element_text(size=5)) +
    theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))+
    geom_line(aes(x=as.numeric(Number), y=as.numeric(dif), color=trial ))+ 
     theme(legend.position="none")+
     scale_color_manual(values = rep("darkolivegreen", nrow(data_frame_newt_temp)))
 }
   if(leg_off==TRUE){
 p = p+ theme(legend.position = "none")}
  return(p)
}


phenotype_change_graph_s <- function(files, title, is_log=FALSE, xlim_value){
  # this shows me how the phenotype change in one single for each simulation
  # it takes all of the files and reads all of them in to take the first and last point
  # highly inefficient
file1 <- read.table(files[1], header = TRUE)
p <- ggplot(file1, aes(x=1:144)) +
  xlim(0, xlim_value)+
  ggtitle(title) +
  xlab("Simulation number") + ylab("Phenotype")+
  theme_bw()


if(is_log==TRUE){
  p = p + scale_y_log10() + ylab("Phenotype  (Log)")
  
}

i=1
for (current_file in files){

  file <- read.table(current_file, header = TRUE)
  file$Newt_mean_Pheno[file$Newt_mean_Pheno == "NULL"] <- 0
  file$Snake_mean_Pheno[file$Snake_mean_Pheno == "NULL"] <- 0
  file <- file[complete.cases(file), ]
 p <- p + geom_point(data= file, x = i, aes(y = as.numeric(Newt_mean_Pheno[1])+0.1), color= darken("darkred")) +
   geom_point(data= file,x = i, aes(y = as.numeric(Newt_mean_Pheno[50])+0.1), color=lighten("darkred"))  + 
  geom_point(data= file, x = i, aes(y = as.numeric(Snake_mean_Pheno[1])+0.1), color=darken("steelblue")) +
  geom_point(data= file, x = i, aes(y = as.numeric(Snake_mean_Pheno[50])+0.1), color=lighten("steelblue"))+
  geom_segment(data = file, x=i, xend=i, aes( y=as.numeric(Newt_mean_Pheno[1])+0.1, yend=as.numeric(Newt_mean_Pheno[50])+0.1, colour="Newt"), size = 0.3, arrow = arrow(length = unit(0.5, "cm")))+
   geom_segment(data = file, x=i, xend=i, aes( y=as.numeric(Snake_mean_Pheno[1])+0.1, yend=as.numeric(Snake_mean_Pheno[50])+0.1, colour="Snake"), size = 0.3, arrow = arrow(length = unit(0.5, "cm")))
   
 i = i+1
}
p <- p +
 scale_colour_manual(name = "Species", values = c("Newt" = "darkred", "Snake"="steelblue"))
return(p)
}


```

## Simulations

I ran a spatial antagonistic co-evolution simulation with a fitness cost. Both newts and snakes had the same mutation rate, mutation effect sizes and fitness costs. Here, fitness cost remained the same between all of the simulations, but the mutation rate and mutation effect size differed. I ran about 100 simulations to get a general idea of what might be happening in the simulations. I wanted to focus on what was happening to the phenotype of newts and snakes, while also observing other factors that I looked at in previous rmarkdowns (beta, phenotype differences, population sizes, ect).

```{r, data info}
# Files for No space results
files <- list.files(path="~/Desktop/cost_sim/gen_5000/u5", pattern="nu_*1.56", full.names=TRUE, recursive=FALSE)
file <- read.table(files[51], header = TRUE)
beta_n <- making_data_frames(files, all_of("beta_n"))
beta_s <- making_data_frames(files, all_of("beta_s"))
Newt_mean_Pheno <- making_data_frames(files, all_of("Newt_mean_Pheno"))
Snake_mean_Pheno <- making_data_frames(files, all_of("Snake_mean_Pheno"))
Newt_sd_Pheno <- making_data_frames(files, all_of("Newt_sd_Pheno"))
Snake_sd_Pheno <- making_data_frames(files, all_of("Snake_sd_Pheno"))
mean_newts_eaten <- making_data_frames(files, all_of("mean_newts_eaten"))
mean_snakes_eaten <- making_data_frames(files, all_of("mean_snakes_eaten"))
newt_deaths <- making_data_frames(files, all_of("newt_deaths"))
snake_deaths <- making_data_frames(files, all_of("snake_deaths"))
Newt_age <- making_data_frames(files, all_of("Newt_age"))
Snake_age <- making_data_frames(files, all_of("Snake_age"))
Newt_pop_size <- making_data_frames(files, all_of("Newt_pop_size"))
Snake_pop_size <- making_data_frames(files, all_of("Snake_pop_size"))
```

## Exploring the Change in Phenotypes

Here, I am looking at how the phenotypes of newts and snakes change from what they began at and what the ended at for all of the simulations that I ran. In all of the simulation the mean phenotype of the newts and snakes started out higher and after 5,000 generations it dropped. The phenotypes did not become 0. I kind of want them to hang out around 3. I wonder what would happen to the newt and snake phenotype if I kept the simulation running?

```{r, phenotype change}

phenotype_change_graph_s(files, title="Change in Phenotype Space", is_log=TRUE, xlim_value=104)
```

I also graphed the newt and snake phenotype by generation for all of simulations. The typical trend that I saw was that the newt/snake phenotype would drop quickly then level out (it might be lowering slowly, but thats difficulat to tell).

```{r, looking at all sims phenotypes}
a1<-phenotype_trends(Newt_mean_Pheno, "Newt Phenotype Simulation Trend", "sigma = 0.2, mu = 1.5625e-10", "darkred", is_log=FALSE, leg_off=FALSE)
a2<-phenotype_trends(Snake_mean_Pheno, "Snake Phenotype Simulation Trend", "sigma = 0.2, mu = 1.5625e-10", "steelblue", is_log=FALSE, leg_off=FALSE)

grid.arrange(a1, a2, nrow=1)
```

When looking at the variation between the simulations for the mean phenotypes and the standard deviation I saw that the simulations seemed to match each other. There was little variation between the simulations. Is it possible for the interaction of selection and cost to make the newt and snake phenotypes more similar between simulations? Can the selection coef. be determined from these results?  

```{r, comparative figures this params}

sp<-phenotype_boxplot(Newt_mean_Pheno, Snake_mean_Pheno, title="Space: Variation in the Mean Phenotype For Newts and Snakes by Generation", subt="sigma = 0.2, mu = 1.5625e-10", boxy=TRUE, section=TRUE, section_num=10, ylim_max=5)

sdp<-phenotype_boxplot(Newt_sd_Pheno, Snake_sd_Pheno, title="Space: Variation in the Sd of Phenotype For Newts and Snakes by Generation", subt="sigma = 0.2, mu = 1.5625e-10", boxy=TRUE, section=TRUE, section_num=10, ylim_max=5)

grid.arrange(sp, sdp, nrow=1)
```

## The Difference Betwwen Snake and Newt Mean Phenotype

As I have seen in most of my newt and snake simulations the difference between snake and newt mean phenotype was small. With the addition of a phenotype cost I see less simulations where either the newt or snake has a higher phenotype. Here, there are two simulations that show this happening. Does adding a cost keep one of the species from escaping the interaction?

```{r, the differences}

bp <- phenotype_dif_boxplot(Newt_mean_Pheno, Snake_mean_Pheno, title="Space: Differences", subt="sigma = 0.2, mu = 1.5625e-10",boxy=TRUE, section=TRUE, section_num=10)

bp2 <- phenotype_dif_boxplot(Newt_mean_Pheno, Snake_mean_Pheno, title="Space: Differences", subt="sigma = 0.2, mu = 1.5625e-10",boxy=FALSE, section=FALSE, section_num=0)

grid.arrange(bp, bp2, nrow=1)
```

## Interaction Between Polulation Factors and Phenotype

In this section I look at the interaction between population factors such as population size and the amount of newts and snakes killed and the phenotype of the newts and snakes. I will also try to compare these results to my simulations without cost.

When I plotted the difference between mean phenotype and deaths/age I saw a square blob. There are too many points that were plotted on-top of each other to see a trend. A possible trend is that when the snake mean phenotype is higher more newts are dying. When the newt phenotype is higher there might be more snakes dying. This result is not what I saw in my other spatial simulation, it is more like what I saw in my nospace simulations. Why would this be occuring? I also saw a really weird interaction between population size and phenotype. When the snake phenotype was higher there were more newts and when the newt phenotype was higher there were more snakes. This is the exact opposite from what I had been seeing in the spatial and nospace simulations. Why would adding a cost to phenotypes be causing these patterns? Maybe, if the snake phenotype was higher then there would be more snakes, except that if the phenotype was higher there would be a cost lowering the amount of snakes. Maybe this does make sense. If newts or snakes had a high phenotype then there fitness would be lower which could lower the population size. 

```{r, sel coef graphs}

ps1 <- var_by_var( Newt_mean_Pheno, Snake_mean_Pheno, mean_newts_eaten, mean_snakes_eaten, title="Space: Differnece in mean phenotype by Deaths", subt="sigma = 0.2, mu = 1.5625e-10", x_label="Dif in Mean Pheno", y_label="Deaths/age", subtract_x=TRUE)

ps2 <- var_by_var( Newt_mean_Pheno, Snake_mean_Pheno, Newt_pop_size, Snake_pop_size, title="Space: Differnece in mean phenotype by PopSize", subt="sigma = 0.2, mu = 1.5625e-10", x_label="Dif in Mean Pheno", y_label="PopSize", subtract_x=TRUE) 


grid.arrange(ps1, ps2, nrow=1)
```

I also made my favorite whale plots! Except here I see the higher phenotype for a particular species when their population size is lower. I wonder if this is because of the interaction between newts and snakes and the cost of the phenotype. For example, maybe there are a lot of newts and they are interaction with snakes the only snakes to survive this interaction are snakes with a higher phenotype. The snakes have a higher phenotype are less fit so they reproduce less. I also saw a lot more in-between points where both the populations of newts and snakes were not large. The patter looks more like a hump and less like a curve.

```{r, popsize of newts and snakes with color of phenotype}

vc1 <- var_by_var(Newt_pop_size, Newt_mean_Pheno, Newt_mean_Pheno, Snake_pop_size, title="Space: Newt VS Snake Population Size Color=Phenotype", subt="sigma = 0.1, mu = 1.0e-10", y_label="Snake Popsize", x_label="Newt Popsize", colored=TRUE, color_label="Newt Phenotype" , highcol="darkred") 

vc2 <- var_by_var(Newt_pop_size, Snake_mean_Pheno, Snake_mean_Pheno, Snake_pop_size, title="Space: Newt VS Snake Population Size Color=Phenotype", subt="sigma = 0.1, mu = 1.0e-10", y_label="Snake Popsize", x_label="Newt Popsize", colored=TRUE, color_label="Snake Phenotype", highcol="steelblue") 

vc1 
vc2
```

## Beta Value and Other Comparisons 

I am currently working on a better way to measure the correlation between phenotype and fitness (beta). However, this is the old way that I have been measuring beta (which is for the whole population). The problem with this way of measuring beta is that ther migh be some area with a higher beat and areas with a lower beta which should cause the beta for the would population to be close to 0.

So, when I plotted my beta values I was nor surprised to seem them clustered around 0. Beta does look to be slightly more negative. Could this be due to cost or is it just random chance? 

```{r, beta distribution}


hist(unlist(beta_s[ , 2:52]), col=rgb(173,216,230,max = 255, alpha = 80, names = "lt.blue"), main="Space: Beta Values", xlab="Beta", breaks=15) 
hist(unlist(beta_n[ , 2:52]), col=rgb(255,192,203, max = 255, alpha = 80, names = "lt.pink"), add = TRUE, breaks=15) #ylim=c(0,2100)

abline(v = mean(unlist(beta_n[ , 2:52])), col = rgb(255,192,203, max = 255), lwd = 2)
abline(v = mean(unlist(beta_s[ , 2:52])), col = rgb(173,216,230, max = 255), lwd = 2)
legend("topright", c("Newt", "Snake"), fill=c(rgb(255,192,203, max = 255), rgb(173,216,230, max = 255)))

```

The green eyeball of newt beta by snake beta values is centered around zero with a quite a few additional points neagtive for both the newts and the snakes.


```{r, comp betas}

var_by_var(beta_n, beta_s, beta_n, beta_s, title="Space: Newt Betas by Snake Betas", subt="sigma = 0.2, mu = 1.5625e-10", x_label="Newt betas", y_label="Snake Betas", just_two = TRUE) 

```

In the last set of figures I was surprised to see that beta values were very negative at the beginning of my simulation. This reflects on how quickly the newt and snake phenotype dropped in the beginning of the simulations. In the other three figures I did not notice any specfic patter or trend. It looks like a blob when looking at the difference between snake and newt phenotype vs age or beta. It also looks like a blob in the figure which plots newt mean phenotype by snake mean phenotype. 

```{r, beta figures}


g1 <- var_by_var( beta_n, beta_s, beta_n, beta_s, title="Space: Betas By Generation", subt="sigma = 0.2, mu = 1.5625e-10", x_label="Generation", y_label="Betas", by_gen=TRUE) 

g2 <- var_by_var( Newt_mean_Pheno, Snake_mean_Pheno, beta_n, beta_s, title="Space: Differnece in mean phenotype by Betas", subt="sigma = 0.2, mu = 1.5625e-10", x_label="Dif in Pheno", y_label="Betas", subtract_x=TRUE)

g3 <- var_by_var( Newt_mean_Pheno, Snake_mean_Pheno, Newt_age, Snake_age, title="Space: Differnece in mean phenotype by Age", subt="sigma = 0.2, mu = 1.5625e-10", x_label="Dif in Pheno", y_label="Age", subtract_x=TRUE) 

g4 <- var_by_var(Newt_mean_Pheno, beta_s, beta_n, Snake_mean_Pheno, title="Space: Newt Pheno by Snake Pheno", subt="sigma = 0.2, mu = 1.5625e-10", x_label="Newt Mean Phenotype", y_label="Snake Mean Phenotype", just_two = TRUE) 


grid.arrange(g1, g2, g3, g4, nrow=2)

```

## Extra thoughts

Right now the phenotype of newts and snakes goes down due to fitness cost. However, it does not go down to 0. Which might indicate that there is a benefit for having a costly phenotype. I think the cost is too high in this case.

Original choice is 10 phenotypes dropped to ~0.3
Next choice is 100 phenotypes hold around 2-3

what would phenotypes be like for 10, 20, 30, 40, 50, 60, 70, 80, 90, and 100

