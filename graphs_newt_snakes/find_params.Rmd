---
title: "Finding Sigma and Mu"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(viridis)
library(colorspace)
library(gridExtra)

#setwd("~/Desktop/Proposal Old Drafts")
```

## This is a r file to explore paramater values for my coevolution simulation 

I ran a few experiments in the 1000 generation simulation and discovered that there were some combinations of sigma and mu that created "extreme" phenotypes (but not outside of the mathematical expectations). This markdown will hopefully help me visualize different values of sigma and mu and their resulting phenotypes. 

### Math

$$
\text{Population size, } N = 10^4 
$$
$$
\text{Time to most recent comman ancestor, } 2N 
$$
$$
\text{Number of Mutations differ between two, } \sim 4N\mu L
$$
$$
\mu = \text{mutation rate / bp, My simulation } 10^-12 \text{ to } 10^-8
$$
$$
L = \text{sequence length }
$$
$$
\sigma = \text{effect size SD, My simulation } 0.01 \text{ to } 0.5
$$
$$
Var[phenotype] \sim 4N\mu L\sigma^2
$$
$$
SD[phenotype] \sim \sigma \sqrt{4N\mu L} -> \sigma \sqrt{\mu}*2*10^6
$$
$$
\mu = 10^-12 \sigma = 0.01, = 0.02
$$
$$
\mu = 10^-8 \sigma = 0.5, = 100
$$

# Different Combinations 

Here I am using different values with the above formula to try to get the phenotypes of 5 and 2 

```{r find sigma and mu, echo=FALSE}

sigma = seq(0.01, 0.5, length.out=100)
mu = seq(10^-12, 10^-8, length.out=100)

mat = mapply(rep, 1:4, 4:1)
my_grid <- as.data.frame(expand.grid(sigma, mu))
my_grid$results = mapply(`*`,sigma*2*10^6,rep(sqrt(mu),each=length(sigma)))

ggplot(my_grid, aes(x = Var1, y=Var2, colour = results)) +
  geom_point(data=my_grid[my_grid$results <=5, ], aes(x = Var1, y=Var2, colour="Less than 5"))+
  geom_point(data=my_grid[my_grid$results <=2, ], aes(x = Var1, y=Var2, colour="Less than 2"))+
  ggtitle("Value Combinations That Might Work") +
  xlab("Sigma") + ylab("Mu")+  
  theme_bw()+
  scale_color_manual(name = "Fake Phenotypes", values = c("Less than 5" = "blue", "Less than 2" = "green"))


```


I think it would be cool to draw them as lines (like take the max Mu that would produce the correct phenotype for every sigma value)

```{r max unique values, echo=FALSE}

#2=sigma*sqrt(mu)*2*10^6
y_mu_2 = (2/(sigma*2*10^6))^2
y_mu_5 = (5/(sigma*2*10^6))^2
x_sigma_2 = 2/(sqrt(mu)*2*10^6)
x_sigma_5 = 5/(sqrt(mu)*2*10^6)
ggplot() +
  geom_line(aes(x = sigma, y=y_mu_5, colour="Less than 5"))+
  geom_line(aes(x = sigma, y=y_mu_2, colour="Less than 2"))+
  #lines are out of order, but the points line up. Looks Good!
  #geom_point(aes(x = x_sigma_5, y=mu), col="blue")+
  #geom_point(aes(x = x_sigma_2, y=mu), col="green")+
  scale_y_log10()+
  #geom_point(data=my_grid[my_grid$results <=2, ], aes(x = Var1, y=Var2), col="green")+
  ggtitle("Value Combinations That Might Work") +
  xlab("Sigma") + ylab("Mu (log)")+ #xlim(0, 0.6)+
  theme_bw()+
  scale_color_manual(name = "Fake Phenotypes", values = c("Less than 5" = "blue", "Less than 2" = "green"))



```
# Values to try

For this experiment I ran 6 simulations with different sigma and mu values to try to get the phenotype of newts and snakes at or below a certain value (in this case 5 and 2). It do this experiment I set the values for SD[phenotype] and sigma (0.1, 0.2, 0.3) and solved for mu. I ran 1 simulation per pair (so far) just to see where the newt and snake phenotypes would end up.

*For the less than 5* 
Pairs:

* sigma = 0.1, mu = 6.25e-10
* sigma = 0.2, mu = 1.5625e-10
* sigma = 0.3, mu = 6.944444e-11


*For the less than 2* 
Pairs:

* sigma = 0.1, mu = 1e-10
* sigma = 0.2, mu = 2.5e-11
* sigma = 0.3, mu = 1.111111e-11

```{r functions, echo=FALSE}

collect_data_points <- function(files) {
  newt_max_pheno_1 = 0
  snake_max_pheno_1 = 0
  newt_min_pheno_1 = 0
  snake_min_pheno_1 = 0
  true_max_1 = 0
  true_min_1 = 0
  min_difference_1 = 0
  max_difference_1 = 0
  mean = 0
  sd = 0
  mean_mean_dif = 0
  sd_mean_dif = 0
 

  for (current_file in files){
  #print(current_file)

  file <- read.table(current_file, header = TRUE)
  
  file$Newt_max_Pheno[file$Newt_max_Pheno == "NULL"] <- NA
  file$Snake_max_Pheno[file$Snake_max_Pheno == "NULL"] <- NA
  file$Newt_min_Pheno[file$Newt_min_Pheno == "NULL"] <- NA
  file$Snake_min_Pheno[file$Snake_min_Pheno == "NULL"] <- NA
  file$Newt_mean_Pheno[file$Newt_mean_Pheno == "NULL"] <- NA
  file$Snake_mean_Pheno[file$Snake_mean_Pheno == "NULL"] <- NA
  file$Newt_mean_Pheno <- lapply(file$Newt_mean_Pheno,as.numeric)
  file$Snake_mean_Pheno <- lapply(file$Snake_mean_Pheno,as.numeric)
  file$Newt_max_Pheno <- lapply(file$Newt_max_Pheno,as.numeric)
  file$Snake_max_Pheno <- lapply(file$Snake_max_Pheno,as.numeric)
  file$Newt_min_Pheno <- lapply(file$Newt_min_Pheno,as.numeric)
  file$Snake_min_Pheno <- lapply(file$Snake_min_Pheno,as.numeric)
  
  mean = mean(c(as.numeric(file$Newt_mean_Pheno), as.numeric(file$Snake_mean_Pheno)), na.rm = TRUE)
  sd = sd(c(as.numeric(file$Newt_mean_Pheno), as.numeric(file$Snake_mean_Pheno)), na.rm = TRUE)
  mean_mean_dif = mean(as.numeric(file$Snake_mean_Pheno) - as.numeric(file$Newt_mean_Pheno),na.rm = TRUE)
  sd_mean_dif = sd(as.numeric(file$Snake_mean_Pheno) - as.numeric(file$Newt_mean_Pheno),na.rm = TRUE)
  

    if (max(as.numeric(file$Newt_max_Pheno), na.rm = TRUE) > newt_max_pheno_1){
    newt_max_pheno_1 = max(as.numeric(file$Newt_max_Pheno), na.rm = TRUE) }
  
  if (max(as.numeric(file$Snake_max_Pheno), na.rm = TRUE) > snake_max_pheno_1){
    snake_max_pheno_1 = max(as.numeric(file$Snake_max_Pheno), na.rm = TRUE) }
  
  if (min(as.numeric(file$Newt_min_Pheno), na.rm = TRUE) < newt_min_pheno_1){
    newt_min_pheno_1 = min(as.numeric(file$Newt_min_Pheno), na.rm = TRUE) }
  
  if (min(as.numeric(file$Snake_min_Pheno), na.rm = TRUE) < snake_min_pheno_1){
    snake_min_pheno_1 = min(as.numeric(file$Snake_min_Pheno), na.rm = TRUE) }
  
  if (min(as.numeric(file$Snake_mean_Pheno), na.rm = TRUE) - max(as.numeric(file$Newt_mean_Pheno), na.rm = TRUE) < min_difference_1){
    min_difference_1 = min(as.numeric(file$Snake_mean_Pheno), na.rm = TRUE) - max(as.numeric(file$Newt_mean_Pheno), na.rm = TRUE)
  }
  
  
  if (max(as.numeric(file$Snake_mean_Pheno), na.rm = TRUE) - min(as.numeric(file$Newt_mean_Pheno), na.rm = TRUE) > max_difference_1){
    max_difference_1 = max(as.numeric(file$Snake_mean_Pheno), na.rm = TRUE) - min(as.numeric(file$Newt_mean_Pheno), na.rm = TRUE)
  }
  }
  
    if (newt_max_pheno_1 > snake_max_pheno_1){
    true_max_1 = newt_max_pheno_1 }
  if ( snake_max_pheno_1 > newt_max_pheno_1){
    true_max_1 = snake_max_pheno_1 }
  
    if (newt_min_pheno_1 < snake_min_pheno_1){
    true_min_1 = newt_min_pheno_1 }
  if ( snake_min_pheno_1 < newt_min_pheno_1){
    true_min_1 = snake_min_pheno_1 }
  
  return(c(newt_max_pheno_1, snake_max_pheno_1, newt_min_pheno_1, snake_min_pheno_1, true_max_1, true_min_1, min_difference_1, max_difference_1, mean, sd, mean_mean_dif, sd_mean_dif))
}


phenotype_graph_s <- function(files, the_mean, the_sd, title, subt, is_log=FALSE, boxy=FALSE){
  
  file1 <- read.table(files[1], header = TRUE)
  file1$Newt_mean_Pheno[file1$Newt_mean_Pheno == "NULL"] <- NA
  file1$Snake_mean_Pheno[file1$Snake_mean_Pheno == "NULL"] <- NA
  file1$Newt_mean_Pheno[file1$Newt_sd_Pheno == "NULL"] <- NA
  file1$Snake_mean_Pheno[file1$Snake_sd_Pheno == "NULL"] <- NA
  
  
p <- ggplot(file1, aes(x=gen)) +
  xlim(0, 1000)+
  #ylim(0, true_max_1)+
  #geom_line(aes(y = Newt_mean_Pheno, colour="Newt")) + 
  #geom_boxplot(aes(x=gen+5, group = gen, lower=Newt_mean_Pheno-Newt_sd_Pheno, upper=Newt_mean_Pheno+Newt_sd_Pheno, middle=Newt_mean_Pheno, ymin=Newt_mean_Pheno-3*Newt_sd_Pheno, ymax=Newt_mean_Pheno+3*Newt_sd_Pheno, colour="Newt"), stat="identity", position = position_dodge(width = 0.9), alpha = .3, width=3.15)+
  #geom_line(aes(y = Snake_mean_Pheno, colour="Snake"), linetype="twodash")+
  #geom_boxplot(aes(x=gen-5,group = gen, lower=Snake_mean_Pheno-Snake_sd_Pheno, upper=Snake_mean_Pheno+Snake_sd_Pheno, middle=Snake_mean_Pheno, ymin=Snake_mean_Pheno-3*Snake_sd_Pheno, ymax=Snake_mean_Pheno+3*Snake_sd_Pheno, colour="Snake"), stat="identity", position = "identity", alpha = .3, width=3.15)+
  #geom_errorbar(aes(x = gen+5, colour="Newt", ymin = Newt_mean_Pheno - 2*Newt_sd_Pheno, ymax = Newt_mean_Pheno + 2*Newt_sd_Pheno))+ # error bar to show variation
  #geom_errorbar(aes(x = gen-5, colour="Snake", ymin = Snake_mean_Pheno - 2*Snake_sd_Pheno, ymax = Snake_mean_Pheno + 2*Snake_sd_Pheno))+ # error bar to show variation
  ggtitle(title, subtitle = subt) +
  xlab("Generation") + ylab("Average Phenotypes")+
  scale_color_manual(name = "Species", values = c("Newt" = "darkred", "Snake" = "steelblue"))+
  theme(plot.title = element_text(size=5)) +
  theme_bw()


if(boxy==FALSE){
 p= p + geom_line(aes(y = Newt_mean_Pheno, colour="Newt")) + geom_line(aes(y = Snake_mean_Pheno, colour="Snake"), linetype="twodash")
    
  
}


if(boxy==TRUE){
  p = p +  geom_boxplot(aes(x=gen-5,group = gen, lower=Snake_mean_Pheno-Snake_sd_Pheno, upper=Snake_mean_Pheno+Snake_sd_Pheno, middle=Snake_mean_Pheno, ymin=Snake_mean_Pheno-3*Snake_sd_Pheno, ymax=Snake_mean_Pheno+3*Snake_sd_Pheno, colour="Snake"), stat="identity", position = "identity", alpha = .3, width=3.15)+
      geom_boxplot(aes(x=gen+5, group = gen, lower=Newt_mean_Pheno-Newt_sd_Pheno, upper=Newt_mean_Pheno+Newt_sd_Pheno, middle=Newt_mean_Pheno, ymin=Newt_mean_Pheno-3*Newt_sd_Pheno, ymax=Newt_mean_Pheno+3*Newt_sd_Pheno, colour="Newt"), stat="identity", position = position_dodge(width = 0.9), alpha = .3, width=3.15)
}

if(is_log==TRUE){
  p = p + ylab("Average Phenotypes (Log)") + scale_y_log10(limits=c(the_mean-(the_sd*3), the_mean+(the_sd*10)))
  }

return(p)
}

differnce_graph <- function(files, the_mean, the_sd, min_difference_1, max_difference_1, title, is_log=FALSE){
  
 file1 <- read.table(files[1], header = TRUE)
p <- ggplot(file1, aes(x=gen)) +
  xlim(0, 1000)+
  geom_line(aes(y = abs(Snake_mean_Pheno - Newt_mean_Pheno)), color = "mediumseagreen") + 
  ggtitle(title) +
  xlab("Generation") + ylab("Average Difference")+
  theme_bw()

if(is_log==TRUE){
  p = p + scale_y_log10(limits=c(min_difference_1, max_difference_1)) + ylab("Average Difference (Log)")
}

if(is_log==FALSE){
  if((abs(the_mean)-the_sd*10 < min_difference_1) & (abs(the_mean)+the_sd*10 > max_difference_1)){
    p = p + ylim(abs(the_mean)-the_sd*10, abs(the_mean)+the_sd*10)
  }else{p = p + ylim(min_difference_1-the_sd*5, max_difference_1+the_sd*5)}
  
}

for (current_file in files){
  #print(current_file)

  file <- read.table(current_file, header = TRUE)
  file$Newt_mean_Pheno[file$Newt_mean_Pheno == "NULL"] <- NA
  file$Snake_mean_Pheno[file$Snake_mean_Pheno == "NULL"] <- NA
  file <- file[complete.cases(file), ]
  file$mean_dif = as.numeric(file$Snake_mean_Pheno) - as.numeric(file$Newt_mean_Pheno)
  file$mean_dif[file$mean_dif == 0] <- 0.01
  file$pos <- "Snake"
  file$pos[file$mean_dif < 0] <- "Newt"
  file$pos[file$mean_dif ==  0.01] <- "ZEqual"

 p <- p + geom_line(data=file, aes(x=gen, y=abs(mean_dif), color = pos), na.rm=TRUE)
  #Sys.sleep(2) na.rm=TRUE
 # color = "mediumseagreen"

}
return(p)
}


phenotype_change_graph_s <- function(files, the_mean, the_sd, title, is_log=FALSE, xlim_value){
file1 <- read.table(files[1], header = TRUE)
p <- ggplot(file1, aes(x=1:144)) +
  xlim(0, xlim_value)+
  ggtitle(title) +
  xlab("Simulation number") + ylab("Phenotype")+
  theme_bw()


if(is_log==TRUE){
  p = p + scale_y_log10() + ylab("Phenotype  (Log)")
  
}

i=1
for (current_file in files){

  file <- read.table(current_file, header = TRUE)
  file$Newt_mean_Pheno[file$Newt_mean_Pheno == "NULL"] <- 0
  file$Snake_mean_Pheno[file$Snake_mean_Pheno == "NULL"] <- 0
  file <- file[complete.cases(file), ]
 p <- p + geom_point(data= file, x = i, aes(y = as.numeric(Newt_mean_Pheno[1])+0.1), color= darken("darkred")) +
   geom_point(data= file,x = i, aes(y = as.numeric(Newt_mean_Pheno[50])+0.1), color=lighten("darkred"))  + 
  geom_point(data= file, x = i, aes(y = as.numeric(Snake_mean_Pheno[1])+0.1), color=darken("steelblue")) +
  geom_point(data= file, x = i, aes(y = as.numeric(Snake_mean_Pheno[50])+0.1), color=lighten("steelblue"))+
  geom_segment(data = file, x=i, xend=i, aes( y=as.numeric(Newt_mean_Pheno[1])+0.1, yend=as.numeric(Newt_mean_Pheno[50])+0.1, colour="Newt"), size = 0.3, arrow = arrow(length = unit(0.5, "cm")))+
   geom_segment(data = file, x=i, xend=i, aes( y=as.numeric(Snake_mean_Pheno[1])+0.1, yend=as.numeric(Snake_mean_Pheno[50])+0.1, colour="Snake"), size = 0.3, arrow = arrow(length = unit(0.5, "cm")))
   
 i = i+1
}
p <- p +
 scale_colour_manual(name = "Species", values = c("Newt" = "darkred", "Snake"="steelblue"))
return(p)
}
  
untrasform <- function(files, the_mean, the_sd, title1, title2, is_log=FALSE){

file1 <- read.table(files[1], header = TRUE)
p <- ggplot(file1, aes(x=as.numeric(Newt_mean_Pheno))) +
  #ylim(0, true_max_1)+
  geom_line(aes(y = (log(as.numeric(Newt_mean_Pheno))*10)), color = "darkred") + 
  ggtitle(title1) +
  xlab("Trasnformed") + ylab("Untransformed")+
  theme_bw()
q <- ggplot(file1, aes(x=as.numeric(Snake_mean_Pheno))) +
  #ylim(0, true_max_1)+
  geom_line(aes(y = (log(as.numeric(Snake_mean_Pheno))*10)), color = "steelblue") + 
  ggtitle(title2) +
  xlab("Transformed") + ylab("Untransformed")+
  theme_bw()


for (current_file in files){
  #print(current_file)
  file <- read.table(current_file, header = TRUE)
  file$Newt_mean_Pheno[file$Newt_mean_Pheno == "NULL"] <- NA
  file$Snake_mean_Pheno[file$Snake_mean_Pheno == "NULL"] <- NA
  file <- file[complete.cases(file), ]
  #print(file$Newt_mean_Pheno)
  #print(exp(file$Newt_mean_Pheno/10))
  #print(log(as.numeric(file$Newt_mean_Pheno))*10)
  file <- read.table(current_file, header = TRUE)
 p <- p + geom_line(data=file, aes(y = (log(as.numeric(Newt_mean_Pheno))*10)), color = "darkred",na.rm = TRUE) 

 q <- q + geom_line(data=file, aes(y = (log(as.numeric(Snake_mean_Pheno))*10)), color="steelblue", linetype="twodash", na.rm = FALSE)
}
return(list(p,q))

}

```


# Test 1 Under 5

For this test I ran 3 simulations (msprime and slim, a "set") to see if the phenotypes would be under 5. I looked at the maximum and minimum phenotypes for newts and snakes. The first set of figures below show the mean phenotypes for the newts and snakes every 20 generations. Newts are red and snakes are blue. Surprisingly, (or not?) the snakes have a higher mean phenotype. The phenotypes of both newts and snake are increasing as the generation increases.  The second set of figures are boxplots calculated from the mean and standard deviation each generation for one simulation. Sense these are values for only one simulation the standard deviation can be large. 

Extra notes:

* 1000 gen slim simulations only take a few minutes at most on the cluster 
* boxplots are calculated from mean and sd (box is 2sd and line is 3sd)

```{r data from the mistake folder, echo=FALSE}
files <- list.files(path="~/Desktop/findparams/under_5", pattern="file_*", full.names=TRUE, recursive=FALSE)

out = collect_data_points(files)

newt_max_pheno_u5 = out[1]
snake_max_pheno_u5 = out[2]
newt_min_pheno_u5  = out[3]
snake_min_pheno_u5 = out[4]
true_max_u5 = out[5]
true_min_u5 = out[6]
min_difference_u5 = out[7]
max_difference_u5 = out[8]
my_mean_u5 = out[9]
my_sd_u5 = out[10]
mean_mean_dif_u5 = out[11]
sd_mean_dif_u5 = out[12]

print(paste0("Newt max pheno: ", newt_max_pheno_u5))
print(paste0("Snake max phenot: ", snake_max_pheno_u5))
print(paste0("Newt min pheno: ", newt_min_pheno_u5))
print(paste0("Snake min Pheno: ", snake_min_pheno_u5))
print(paste0("Mean of combined snake and newt: ", my_mean_u5))
print(paste0("Sd of combined snake and newt: ", my_sd_u5))
print(paste0("Mean of the mean difference: ", mean_mean_dif_u5))
print(paste0("SD of the mean difference: ", sd_mean_dif_u5))

```

```{r phenotype graph for under 5, echo=FALSE}
myfiles <- list.files(path="~/Desktop/findparams/under_5", pattern="file_*", full.names=TRUE, recursive=FALSE)

# sigma = 0.1, mu = 6.25e-10
# sigma = 0.2, mu = 1.5625e-10
# sigma = 0.3, mu = 6.944444e-11

p_1 = phenotype_graph_s(files=myfiles[1], the_mean=my_mean_u5, the_sd=my_sd_u5, title="Under 5: Phenotype Measurements for Newts and Snakes",subt="sigma = 0.2, mu = 1.5625e-10", is_log=FALSE)

p_2 = phenotype_graph_s(files=myfiles[2], the_mean=my_mean_u5, the_sd=my_sd_u5, title="Under 5: Phenotype Measurements for Newts and Snakes",subt="sigma = 0.1, mu = 6.25e-10" , is_log=FALSE)

p_3 = phenotype_graph_s(files=myfiles[3], the_mean=my_mean_u5, the_sd=my_sd_u5, title="Under 5: Phenotype Measurements for Newts and Snakes", subt="sigma = 0.3, mu = 6.944444e-11" , is_log=FALSE)

grid.arrange(p_1, p_2, p_3, nrow=2)

p_1 = phenotype_graph_s(files=myfiles[1], the_mean=my_mean_u5, the_sd=my_sd_u5, title="Under 5: Phenotype Measurements for Newts and Snakes",subt="sigma = 0.2, mu = 1.5625e-10", is_log=FALSE, boxy = TRUE)

p_2 = phenotype_graph_s(files=myfiles[2], the_mean=my_mean_u5, the_sd=my_sd_u5, title="Under 5: Phenotype Measurements for Newts and Snakes",subt="sigma = 0.1, mu = 6.25e-10" , is_log=FALSE, boxy = TRUE)

p_3 = phenotype_graph_s(files=myfiles[3], the_mean=my_mean_u5, the_sd=my_sd_u5, title="Under 5: Phenotype Measurements for Newts and Snakes", subt="sigma = 0.3, mu = 6.944444e-11" , is_log=FALSE, boxy = TRUE)

grid.arrange(p_1, p_2, p_3, nrow=2)


```

Some things that I noticed was that snakes had a higher phenotype than the newts in all of the simulations. Snakes also had a higher standard deviation than newts. Sense there is only one simulation per test values I am not sure what a normal simulation would look like (solution run more simulations with the same values? should they used the same msprime file?). It looks like the phenotypes are going above 5, is this normal or just a fluke? I personally like aesthetics of the sigma = 0.1, mu = 6.25e-10 boxplot, is there some sort of space thing creating the high variance?  

# Looking at the difference for under 5

Here I look at the difference between the snake and newt mean phenotypes (snake-newt). Pink lines indicate that the snake mean phenotype was higher than the newt mean phenotype. Blue lines indicate that the mean phenotype of newts was higher. In the three simulations that I ran for the under 5 test the snake phenotype was always higher than the newts phenotype. 

```{r difference under 5, echo=FALSE}

## need to work on making this figure better 
files <- list.files(path="~/Desktop/findparams/under_5", pattern="file_*", full.names=TRUE, recursive=FALSE)
title = "Under 5: Difference Between Phenotypes (Snakes-Newts)"
p = differnce_graph(files, mean_mean_dif_u5, sd_mean_dif_u5, min_difference_u5, max_difference_u5, title, is_log=FALSE)

p
```

The difference between the mean snake phenotype and the mean newt phenotype (pink lines) increased as the generation increased. What does it mean when the difference between the mean was increasing? was the snake mean phenotype increasing faster than the newts? Where there a few snakes that got really resistance to the newts (increasing the overall mean)? Was the increase in the newts phenotype slower than the snakes, how to tell and if so why? Ironically, it kind of matches what is seen in the wild (snake resistance > newt toxin)? Would be cool to see the spatial aspect...

# Showing the pheotype change for under 5

Here, I just look at the starting and ending mean phenotypes values for each of the simulations. The arrows start at the beginning phenotypes and point to the ending phenotypes. Newts are red and snakes are blue.

These are the simulation numbers:

1. sigma = 0.2, mu = 1.5625e-10
2. sigma = 0.1, mu = 6.25e-10
3. sigma = 0.3, mu = 6.944444e-11

```{r pheno change under 5, echo=FALSE}

files <- list.files(path="~/Desktop/findparams/under_5", pattern="file_*", full.names=TRUE, recursive=FALSE)
title = "Under 5: Phenotype Change"
p=phenotype_change_graph_s(files, my_mean_u5, my_sd_u5, title, is_log=FALSE, xlim_value=4)
  
p 

```

There was a positive change in the snake phenotype for all three simulations. Why is one of then so much larger than the others? The newt phenotype increased in 2 out of 3 of the simulations. Again, why?

# Trasforming Phenotypes for under 5

I want to see what the un-transformed phenotypes are and compare them to their transformed form. To do this I use the mean phenotype values.

I calculated the phenotypes from this expression, newt pheno = exp(inds_n.sumOfMutationsOfType(m1)/10). So to un-transform and find the # of mutations I need to ln both sides of the equation ln(pheno=e^(sumOfMutations/10)). Then solve for sumOfMutations,  sumOfMutations = 10 * ln(pheno)


```{r trasformation under 5, echo=FALSE}

files <- list.files(path="~/Desktop/findparams/under_5", pattern="file_*", full.names=TRUE, recursive=FALSE)

title1 = "Under 5: Newt trasnformed vs un-trasformed"
title2 = "Under 5: Snake trasnformed vs un-trasformed"
graph = untrasform(files, my_mean_u5, my_sd_u5, title1, title2, is_log=FALSE)
graph[1]
graph[2]

```

Both the transformed lines curve and are 5 and under. How do I know if the phenotypes will remain 5 and under?

# Test 2 Under 2

For this test I again ran 3 simulations (msprime and slim, a "set") to see if the phenotypes would be 2 or under. I looked at the maximum and minimum phenotypes for newts and snakes. The first set of figures below show the mean phenotypes for the newts and snakes every 20 generations. Surprisingly, (or not?) the snakes have a higher mean phenotype. The phenotypes of both newts and snake are increasing as the generation increases.  The second set of figures are boxplots calculated from the mean and standard deviation each generation for one simulation. Sense these are values for only one simulation the standard deviation can be large. 

```{r data from the under 2 folder, echo=FALSE}
files <- list.files(path="~/Desktop/findparams/under_2", pattern="file_*", full.names=TRUE, recursive=FALSE)

out = collect_data_points(files)

newt_max_pheno_u2 = out[1]
snake_max_pheno_u2 = out[2]
newt_min_pheno_u2 = out[3]
snake_min_pheno_u2 = out[4]
true_max_u2 = out[5]
true_min_u2 = out[6]
min_difference_u2 = out[7]
max_difference_u2 = out[8]
my_mean_u2 = out[9]
my_sd_u2 = out[10]
mean_mean_dif_u2 = out[11]
sd_mean_dif_u2 = out[12]

print(paste0("Newt max pheno: ", newt_max_pheno_u2))
print(paste0("Snake max phenot: ", snake_max_pheno_u2))
print(paste0("Newt min pheno: ", newt_min_pheno_u2))
print(paste0("Snake min Pheno: ", snake_min_pheno_u2))
print(paste0("Mean of combined snake and newt: ", my_mean_u2))
print(paste0("Sd of combined snake and newt: ", my_sd_u2))
print(paste0("Mean of the mean difference: ", mean_mean_dif_u2))
print(paste0("SD of the mean difference: ", sd_mean_dif_u2))

```

```{r phenotype graph for under 2, echo=FALSE}
myfiles <- list.files(path="~/Desktop/findparams/under_2", pattern="file_*", full.names=TRUE, recursive=FALSE)

# sigma = 0.1, mu = 1e-10
# sigma = 0.2, mu = 2.5e-11
# sigma = 0.3, mu = 1.111111e-11

p_1 = phenotype_graph_s(files=myfiles[1], the_mean=my_mean_u2, the_sd=my_sd_u2, title="Under 2: Phenotype Measurements for Newts and Snakes",subt="sigma = 0.3, mu = 1.111111e-11", is_log=FALSE)

p_2 = phenotype_graph_s(files=myfiles[2], the_mean=my_mean_u2, the_sd=my_sd_u2, title="Under 2: Phenotype Measurements for Newts and Snakes",subt="sigma = 0.1, mu = 1e-10" , is_log=FALSE)

p_3 = phenotype_graph_s(files=myfiles[3], the_mean=my_mean_u2, the_sd=my_sd_u2, title="Under 2: Phenotype Measurements for Newts and Snakes", subt="sigma = 0.2, mu = 2.5e-11" , is_log=FALSE)

grid.arrange(p_1, p_2, p_3, nrow=2)

p_1 = phenotype_graph_s(files=myfiles[1], the_mean=my_mean_u2, the_sd=my_sd_u2, title="Under 2: Phenotype Measurements for Newts and Snakes",subt="sigma = 0.3, mu = 1.111111e-11", is_log=FALSE, boxy = TRUE)

p_2 = phenotype_graph_s(files=myfiles[2], the_mean=my_mean_u2, the_sd=my_sd_u2, title="Under 2: Phenotype Measurements for Newts and Snakes",subt="sigma = 0.1, mu = 1e-10" , is_log=FALSE, boxy = TRUE)

p_3 = phenotype_graph_s(files=myfiles[3], the_mean=my_mean_u2, the_sd=my_sd_u2, title="Under 2: Phenotype Measurements for Newts and Snakes", subt="sigma = 0.2, mu = 2.5e-11" , is_log=FALSE, boxy = TRUE)

grid.arrange(p_1, p_2, p_3, nrow=2)

```


Wow, theses simulations are very different from each other. Is there more variation between individuals when the average phenotype is higher. What do I expect from a normal run? How might the msprime impact the results? Like if there was a few more mutations in one species than the other, how whould I be able to compare different simulations?

# Looking at the difference between phenotypes for under 2

Here I graph the difference between phenotypes (snake resistance - newt toxicity). I sort of expected them to be "strait lines" because the newt and snake would be coevolving with each other. In this case two are slightly increasing?, but the difference seems to be close to 0. The other line is staying flat and snake resistance is higher than newt toxicity. Is this what I expect? 

Extra notes:

* Found a way to make the limits on the graph nicer so they don't leave out any line (hopefully)
* This time around the differences between the phenotypes was smaller than the paramiters used for under 5

```{r difference under 2, echo=FALSE}

## need to work on making this figure better 
files <- list.files(path="~/Desktop/findparams/under_2", pattern="file_*", full.names=TRUE, recursive=FALSE)
title = "Under 2: Difference Between Phenotypes (Snakes-Newts)"
p = differnce_graph(files, mean_mean_dif_u2, sd_mean_dif_u2, min_difference_u2, max_difference_u2, title, is_log=FALSE)

p
```

# Looking at the Phenotype change for under 2

I graphed the starting and end mean phenotype for both the snakes and newts. The arrow points the way that the phenotype has moved (up = an increase, down = a decrease). Here the arrows look a lot smaller than the arrows for the under 5 experiment, but that might just be because of the very few experiments that I ran.

These are the simulation numbers:

1. sigma = 0.3, mu = 1.111111e-11
2. sigma = 0.1, mu = 1e-10
3. sigma = 0.2, mu = 2.5e-11


```{r pheno change for under 2, echo=FALSE}

files <- list.files(path="~/Desktop/findparams/under_2", pattern="file_*", full.names=TRUE, recursive=FALSE)
title = "Under 2: Phenotype Change"
p=phenotype_change_graph_s(files, my_mean_u2, my_sd_u2, title, is_log=FALSE, xlim_value=4)
  
p 

```

I wonder if the difference between the starting mean phenotype will have an effect on the direction and lenght of the arrow? This could be just the randomness of 3 single simulations.

# Trasforming the under 2 phenotypes

I look at the un-transformed phenotypes compared to their transformed values. I use the mean phenotype values and calculated the phenotypes from this expression, newt pheno = exp(inds_n.sumOfMutationsOfType(m1)/10). 

```{r trasformation under 2, echo=FALSE}

files <- list.files(path="~/Desktop/findparams/under_2", pattern="file_*", full.names=TRUE, recursive=FALSE)

title1 = "Under 2: Newt trasnformed vs un-trasformed"
title2 = "Under 2: Snake trasnformed vs un-trasformed"
graph = untrasform(files, my_mean_u2, my_sd_u2, title1, title2, is_log=FALSE)
graph[1]
graph[2]

```

The transformation lines in the under 2 simulations look more linear than in the under 5 simulations. This might be do to the range in phenotypes being smaller. Based on the max/min and mean phenotypes and the transformation equation nothing seems unexpected. 

# Thoghts about next steps.

I think the parameters that I chose are generating the phenotypes that I expect. It would be cool to pick one set of parameters (maybe sigma = 0.2, mu = 1.5625e-10) and do two things. One I would like to run a bunch of short simulations and see what a normal range of values are. Second I would like to extend the number of generations and see if the pheotypes keep increasing forever.

I also want to start collecting more information, but I am not sure what information I should be collecting.
Right now I have these columns `r colnames(read.table(files[1], header = TRUE))` and information recored in the trees


