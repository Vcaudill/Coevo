---
title: "GA3"
output: html_document
date: '2022-07-21'
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE,echo = FALSE) 

library(ggplot2)
library(viridis)
library(colorspace)
library(gridExtra)
library(tidyverse)
require(reshape2)
library(plyr)
library(gridGraphics)
library(grid)
library(knitr)
library(kableExtra)
library("reshape")
library(ggplot2)
library(ggpubr)
theme_set(theme_pubr())
library(stringr)
library(patchwork)
```

GA3 file will be the slow evolution file. The main goal will be testing to see if there is an effect caused by mutation rate or effect size when the mutational variance between two species is the same (a low).

Prediction: Higher mutation rate will be advantages in the beginning of a simulation. A higher effect size might lead to more spatial co-evolution. Space might influence the effects. - A non-spatial simulation with these values might be fun to compare

For the initial part of this experiment I will run four trials per GA combination

GA combinations:

- 1e-8*(0.005)^2 = 2.5e-13
- 1e-9*(0.0158)^2 = 2.5e-13
- 1e-10*(0.05)^2 = 2.5e-13
- 1e-11*(0.158)^2 = 2.5e-13


## Data Colllection

I have created some bash script to run through all the files in my data folders and add some columns and coagulate all of the files into one file per data set. In this case, there are three data sets; one for whole population data (lit), one for correlation data (cor), and one for individual grids (grid). After all of these files are created, I load it into R and finish adding in some comparative columns. I also load in my figure creation functions. There originally was a problem with naming where I was putting the newt information in first (fixed, but is something to be aware of moving forward).

```{bash, data file gathering}
#!/usr/bin/env bash

# Run these comands while in The the folder that contains the file you would like to condence
# Goal is to condence all the text files into one file 
# Requirements: need to have the same name and need to add additional columns
thepath=/Users/victoria/Desktop/
foldername=GA3
thefolder=${thepath}${foldername}/*

add_in_column=",rep,snake_mu_rate,snake_mu_effect_sd,newt_mu_rate,newt_mu_effect_sd"

cor_head_file=$(find ${thepath}${foldername} -name "*_cor_*" | head -n 1)
cor_head=$(head -n 1 "${cor_head_file}")

grid_head_file=$(find ${thepath}${foldername} -name "*_grid_*" | head -n 1)
grid_head=$(head -n 1 "${grid_head_file}")

lit_head_file=$(find ${thepath}${foldername} -name "*_lit_*" | head -n 1)
lit_head=$(head -n 1 "${lit_head_file}")




#test -f /Users/victoria/Desktop/bash_test/all_lit.txt && echo "all lit file exists."
#test -f /Users/victoria/Desktop/bash_test/all_grid.txt && echo "all grid file exists."
#test -f /Users/victoria/Desktop/bash_test/all_cor.txt && echo "all cor file exists."

if [[ -f ${thepath}${foldername}/all_lit.txt ]] && [[ -f ${thepath}${foldername}/all_grid.txt ]] && [[ -f ${thepath}${foldername}/all_cor.txt ]]
then
  echo "All cor, lit, and grid files exist!"
  echo "This program will now end!"
  exit 0
fi

#creating the files
echo ${lit_head}${add_in_column} > ${thepath}${foldername}/all_lit.txt
echo ${grid_head}${add_in_column} > ${thepath}${foldername}/all_grid.txt
echo ${cor_head}${add_in_column} > ${thepath}${foldername}/all_cor.txt



for filename in $thefolder*.text;
  do 
#getting the variables 
#my_type=$(echo ${filename} |sed 's/.*GA205_//; s/_.*//')
my_other_type=$(echo ${filename} |sed 's/.*GA520_//; s/_.*//')
snake_mu_rate=$(echo ${filename} |sed 's/.*snake_mu_rate_//; s/_.*//')
snake_mu_effect_sd=$(echo ${filename} |sed 's/.*snake_mu_effect_sd_//; s/_.*//')
newt_mu_rate=$(echo ${filename} |sed 's/.*newt_mu_rate_//; s/_.*//')
newt_mu_effect_sd=$(echo ${filename} |sed 's/.*newt_mu_effect_sd_//; s/_.*//')
rep=$(echo ${filename} | sed "s/.*rep_//; s/_.*//")
#echo ${newt_mu_rate}	
# echo $my_type
# echo $my_other_type
# these new columns adding them to the data
sed -i '' -e 's/$/,'${rep}'/' $filename
sed -i '' -e 's/$/,'${snake_mu_rate}'/' $filename
sed -i '' -e 's/$/,'${snake_mu_effect_sd}'/' $filename
sed -i '' -e 's/$/,'${newt_mu_rate}'/' $filename
sed -i '' -e 's/$/,'${newt_mu_effect_sd}'/' $filename
#infile >outfile
if [[ $my_type == "lit" ]]
then
    tail -n +2 -q $filename >> ${thepath}${foldername}/all_lit.txt
fi

if [[ $my_type == "grid" ]]
then
    tail -n +2 -q $filename >> ${thepath}${foldername}/all_grid.txt
fi

if [[ $my_other_type == "cor" ]]
then
    tail -n +2 -q $filename >> ${thepath}${foldername}/all_cor.txt
fi

done

```


```{r, data gathering}

folder="GA3"
filelocation=paste0("~/Desktop/",folder)


snewt <- read.csv("~/Desktop/snake_newt_real_data.csv", header = TRUE)

GA3_tall_tall_file<- read.csv(paste0(filelocation, "/all_lit.txt") , header = TRUE)

GA3_tall_tall_file$group_rep <- paste0(GA3_tall_tall_file$snake_mu_rate, "_", GA3_tall_tall_file$snake_mu_effect_sd,"_",GA3_tall_tall_file$newt_mu_rate, "_", GA3_tall_tall_file$newt_mu_effect_sd, "_", GA3_tall_tall_file$rep)

GA3_tall_tall_file$group <- paste0(GA3_tall_tall_file$snake_mu_rate, "_", GA3_tall_tall_file$snake_mu_effect_sd,"_",GA3_tall_tall_file$newt_mu_rate, "_", GA3_tall_tall_file$newt_mu_effect_sd)

GA3_tall_tall_file$sim=LETTERS[factor(GA3_tall_tall_file$group)]
GA3_tall_tall_file$dif <- GA3_tall_tall_file$Snake_mean_Pheno-GA3_tall_tall_file$Newt_mean_Pheno



GA3_cor_tall_file<- read.csv(paste0(filelocation,"/all_cor.txt") , header = TRUE)
GA3_cor_tall_file$group_rep <- paste0(GA3_cor_tall_file$snake_mu_rate, "_", GA3_cor_tall_file$snake_mu_effect_sd,"_",GA3_cor_tall_file$newt_mu_rate, "_", GA3_cor_tall_file$newt_mu_effect_sd, "_", GA3_cor_tall_file$rep)
GA3_cor_tall_file$group <- paste0(GA3_cor_tall_file$snake_mu_rate, "_", GA3_cor_tall_file$snake_mu_effect_sd,"_",GA3_cor_tall_file$newt_mu_rate, "_", GA3_cor_tall_file$newt_mu_effect_sd)
GA3_cor_tall_file$sim=LETTERS[factor(GA3_cor_tall_file$group)]

GA3_GA3_grid_tall_file<-read.csv(paste0(filelocation,"/all_grid.txt") , header = TRUE)
GA3_GA3_grid_tall_file$group <- paste0(GA3_GA3_grid_tall_file$snake_mu_rate, "_", GA3_GA3_grid_tall_file$snake_mu_effect_sd,"_",GA3_GA3_grid_tall_file$newt_mu_rate, "_", GA3_GA3_grid_tall_file$newt_mu_effect_sd)
GA3_GA3_grid_tall_file$group_rep <- paste0(GA3_GA3_grid_tall_file$snake_mu_rate, "_", GA3_GA3_grid_tall_file$snake_mu_effect_sd,"_",GA3_GA3_grid_tall_file$newt_mu_rate, "_", GA3_GA3_grid_tall_file$newt_mu_effect_sd, "_", GA3_GA3_grid_tall_file$rep)

GA3_GA3_grid_tall_file$sim=LETTERS[factor(GA3_GA3_grid_tall_file$group)]
GA3_GA3_grid_tall_file$snake_newt_rep <- paste0("Snake_",GA3_GA3_grid_tall_file$snake_mu_rate, "_", GA3_GA3_grid_tall_file$snake_mu_effect_sd, "_Newt_",GA3_GA3_grid_tall_file$newt_mu_rate, "_", GA3_GA3_grid_tall_file$newt_mu_effect_sd, "_", GA3_GA3_grid_tall_file$rep)

```


```{r, cor box set up}

boxplot_cors_by_gen <- function(file, title, subt, x_label, y_label, min_gen, max_gen){
 snewt$mean_res = snewt$mean_toxin+snewt$dif
  real_snewt_cor = cor(snewt$mean_toxin, snewt$mean_res)
  #file=GA3_cor_tall_file
  #file$snake_newt <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  
  myplot <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen),]) +
  ylim(-1.1, 1.1)+
  #ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen"))+
  #xlab(x_label) + ylab(y_label)+
  geom_boxplot(aes(x=factor(rep), y=as.numeric(mean_newt_pheno_By_mean_snake_pheno), color = "CA"))+
  geom_hline(yintercept=real_snewt_cor, linetype="dashed")+
    geom_hline(yintercept=0, linetype="solid")+
  #geom_boxplot(aes(x=factor("CB"), y=as.numeric(num_newts_By_num_snakes), color = "CB"))+
  #geom_boxplot(aes(x=factor("CC"), y=as.numeric(sum_newt_pheno_By_num_snake), color = "CC"))+
  #geom_boxplot(aes(x=factor("CD"), y=as.numeric(sum_snake_pheno_By_num_newt), color = "CD"))+
  theme(plot.title = element_text(size=5)) +
  facet_wrap(~sim)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank())


  return(myplot)
}



hist_cors_by_gen_col_rep <- function(file, title, subt, x_label, y_label, min_gen, max_gen){
 snewt$mean_res = snewt$mean_toxin+snewt$dif
  real_snewt_cor = cor(snewt$mean_toxin, snewt$mean_res)
   #file$snake_newt <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  #unique(file$sim)
  plot <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen),]) +
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen"))+
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(x=as.numeric(mean_newt_pheno_By_mean_snake_pheno),fill=factor(rep)))+
  geom_vline(xintercept=real_snewt_cor, linetype="dashed")+
  geom_vline(xintercept=0, linetype="solid")+
  #geom_boxplot(aes(x=factor("CB"), y=as.numeric(num_newts_By_num_snakes), color = "CB"))+
  #geom_boxplot(aes(x=factor("CC"), y=as.numeric(sum_newt_pheno_By_num_snake), color = "CC"))+
  #geom_boxplot(aes(x=factor("CD"), y=as.numeric(sum_snake_pheno_By_num_newt), color = "CD"))+
  theme(plot.title = element_text(size=5)) +
  xlim(-1.1, 1.1)+
  facet_wrap(~sim)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank())


  return(plot)
}

hist_cors_by_gen_col_rep_nofill <- function(file, title, subt, x_label, y_label, min_gen, max_gen){
 snewt$mean_res = snewt$mean_toxin+snewt$dif
  real_snewt_cor = cor(snewt$mean_toxin, snewt$mean_res)
  #file$snake_newt <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  unique(file$sim)
  plot <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen),]) +
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen"))+
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(x=as.numeric(mean_newt_pheno_By_mean_snake_pheno)))+
  geom_vline(xintercept=real_snewt_cor, linetype="dashed")+
  geom_vline(xintercept=0, linetype="solid")+
  #geom_boxplot(aes(x=factor("CB"), y=as.numeric(num_newts_By_num_snakes), color = "CB"))+
  #geom_boxplot(aes(x=factor("CC"), y=as.numeric(sum_newt_pheno_By_num_snake), color = "CC"))+
  #geom_boxplot(aes(x=factor("CD"), y=as.numeric(sum_snake_pheno_By_num_newt), color = "CD"))+
  theme(plot.title = element_text(size=5)) +
  #stat_bin(bins=30)+
  facet_wrap(~sim)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank())

suppressMessages(print(plot))

  return(plot)
}


var_cor <- function(file, cfile, title, subt, x_label, y_label, min_gen, max_gen){
  real_snewt_cor = cor(snewt$mean_toxin, snewt$mean_res)
  real_snewt_var = var(snewt$dif)
  var_cor_table=data.frame()

  
  for(i in 1:length(unique(file$snake_newt_rep))){
    pattern<-unique(file$snake_newt_rep)[i]
    temp_file<-file[which(file$gen>=min_gen & file$gen<=max_gen & file$snake_newt_rep==pattern),]
    temp_cor_file<-cfile[which(cfile$gen>=min_gen & cfile$gen<=max_gen & cfile$snake_newt_rep==pattern),]
    
    var_cor_table_temp<- data.frame("pattern"=pattern, "var"= var(temp_file$dif),"cor" = cor(temp_file$newt_toxin, temp_file$snake_res), "mean_corr" = mean(temp_cor_file$mean_newt_pheno_By_mean_snake_pheno))
    var_cor_table <- rbind(var_cor_table, var_cor_table_temp)
  }
 
  var_cor_table_temp<- data.frame("pattern"="real", "var"= real_snewt_var, "cor" = real_snewt_cor, "mean_corr" = real_snewt_cor)
  var_cor_table <- rbind(var_cor_table, var_cor_table_temp)
  
  plot <- ggplot(var_cor_table) +
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen"))+
  xlab(x_label) + ylab(y_label)+
  geom_point(aes(x=as.numeric(var), y=as.numeric(cor), color = pattern), shape=17, size=3)+
  geom_point(aes(x=as.numeric(var), y=as.numeric(mean_corr), color = pattern), size=3)+
  theme(plot.title = element_text(size=5)) +
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))


  return(plot)
}


cor_trends_by_gen <- function(file, cfile, title, subt, x_label, x_label_cor, y_label, min_gen, max_gen, pattern){
#file=GA3_tall_tall_file
#cfile=GA3_cor_tall_file 
 # pattern="1.0e-10_0.05_1.0e-08_0.005_3"
 file$snake_newt_rep <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd,"_", file$rep)
  cfile$snake_newt_rep <- paste0(cfile$snake_mu_rate, "_", cfile$snake_mu_effect_sd, "_", cfile$newt_mu_rate, "_", cfile$newt_mu_effect_sd, "_", cfile$rep)
  plot <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen & file$snake_newt_rep==pattern),]) +
    #geom_line(aes(generation, dif, group=rep, col="dif"))+
      ggtitle(title, subtitle = paste0(subt," pattern ", pattern, " From ", min_gen, " gen to ", max_gen, " gen"))+
    geom_line(aes(generation, Snake_mean_Pheno, group=rep, color="Snake_mean_Pheno"),)+
    geom_line(aes(generation, Newt_mean_Pheno, group=rep, color="Newt_mean_Pheno"))+
    #ylim(0,10)+
    #xlab(x_label) + ylab(y_label)+
    scale_color_manual(name = "Type",
values = c( "Snake_mean_Pheno" = "steelblue", "Newt_mean_Pheno" = "darkred"),
labels = c("Snake", "Newt"))+
    theme_bw() +theme(legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank(), axis.ticks.x = element_blank(), axis.text.x = element_blank(),
                      plot.margin=unit(c(1,1,+0.3,1), "cm"))
  
  cor_plot <- ggplot(cfile[which(cfile$gen>=min_gen & cfile$gen<=max_gen & cfile$snake_newt_rep==pattern),]) +
    geom_line(aes(generation, mean_newt_pheno_By_mean_snake_pheno, col="CA"))+
    #ggtitle(title, subtitle = subt) +
    ylim(-1.1, 1.1)+
    #xlab(x_label_cor) + ylab(y_label)+
    theme_bw() +theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank(),
                      plot.margin=unit(c(-0.5,1,1,1), "cm"))
  
  file<-file[which(file$gen>=min_gen & file$gen<=max_gen & file$snake_newt_rep==pattern),]
  cfile<-cfile[which(cfile$gen>=min_gen & cfile$gen<=max_gen & cfile$snake_newt_rep==pattern),]
  
  if(nrow(cfile)>nrow(file)){
    toDelete <- seq(0, nrow(cfile), 2)
    cfile_short <-  cfile[-toDelete, ]
  }else{
    cfile_short <-  cfile
  }
  
  if(nrow(cfile_short)>nrow(file)){
      toDelete <- seq(0, nrow(cfile_short), 2)
      cfile_short <-  cfile_short[-toDelete, ]
    }
  figure <- ggarrange(plot, cor_plot + font("x.text", size = 10),heights = c(2, 1.5),ncol = 1, nrow = 2, align = "v")
    print(paste0("pattern ", pattern))
  print(paste0("Cor between average snake pheno and local cor ", cor(file$Snake_mean_Pheno, cfile_short$mean_newt_pheno_By_mean_snake_pheno)))
  print(paste0("Cor between average newt pheno and local cor ", cor(file$Newt_mean_Pheno, cfile_short$mean_newt_pheno_By_mean_snake_pheno)))
  print(paste0("Cor between average dif pheno and local cor ", cor(file$dif, cfile_short$mean_newt_pheno_By_mean_snake_pheno)))
  print(paste0("Cor between newt pheno and snake ", cor(file$Newt_mean_Pheno, file$Snake_mean_Pheno)))
  return(figure)
}


four_types_boxplot_cors_by_gen <- function(file,title, subt, x_label, y_label, min_gen, max_gen){
  #file$snake_newt <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  plot <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen),]) +
  ylim(-1.1, 1.1)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen"))+
  xlab(x_label) + ylab(y_label)+
  geom_boxplot(aes(x=factor("CA"), y=as.numeric(mean_newt_pheno_By_mean_snake_pheno), color = "CA"))+
  geom_boxplot(aes(x=factor("CB"), y=as.numeric(num_newts_By_num_snakes), color = "CB"))+
  geom_boxplot(aes(x=factor("CC"), y=as.numeric(sum_newt_pheno_By_num_snake), color = "CC"))+
  geom_boxplot(aes(x=factor("CD"), y=as.numeric(sum_snake_pheno_By_num_newt), color = "CD"))+
  geom_hline(yintercept=0, linetype="solid")+
  theme(plot.title = element_text(size=5)) +
  facet_wrap(~sim)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank())


  return(plot)
}

```


```{r, general file and graph making}

#the functions to make the params file and the summary and heatmap figures 

create_parm_file <- function(file, min_gen, max_gen){
params <- data_frame()

for(i in 1:length(unique(file$snake_newt_rep))){

  pattern=unique(file$snake_newt_rep)[i]
  sumitup <- file[which(file$gen>=min_gen & file$gen<=max_gen & file$snake_newt_rep ==pattern),]
 
  params_temp<- data_frame(Newt_mean_Pheno=mean(sumitup$Newt_mean_Pheno),
                           Snake_mean_Pheno=mean(sumitup$Snake_mean_Pheno), 
                           Newt_mean_Pheno_sd=sd(sumitup$Newt_mean_Pheno),
                           Snake_mean_Pheno_sd=sd(sumitup$Snake_mean_Pheno),
                           Newt_pop_size=mean(sumitup$Newt_pop_size),
                           Snake_pop_size=mean(sumitup$Snake_pop_size),
                           dif=mean(sumitup$dif),
                           snake_mu_rate=sumitup$snake_mu_rate[1],
                           newt_mu_rate=sumitup$newt_mu_rate[1],
                           snake_mu_effect_sd=sumitup$snake_mu_effect_sd[1],
                           newt_mu_effect_sd=sumitup$newt_mu_effect_sd[1],
                           rep=sumitup$rep[1])
  
  
  params <- rbind(params, params_temp)
}

params$snake <- paste0(params$snake_mu_rate, "_",params$snake_mu_effect_sd)
params$newt <- paste0(params$newt_mu_rate, "_",params$newt_mu_effect_sd)
params$snake_newt <- paste0(params$snake, "_", params$newt)
return(params)
}

GA_summary <- function(file, min_gen, max_gen, x_line, y_line, title, subt, y_label, x_label){

file$snake_newt_rep <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd, "_", file$rep)

params<-create_parm_file(file, min_gen, max_gen)

my_plot <- ggplot(params) +
  #xlim(0, 1000)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
  xlab(x_label) + ylab(y_label)+
  geom_point(aes(x=as.numeric(get(x_line)), y=as.numeric(get(y_line)), color = factor(snake), shape=factor(newt)),size=3)+
#  geom_point(aes(x=as.numeric(Newt_pop_size_20), y=as.numeric(Snake_pop_size_20), color = factor(snake), shape=factor(newt)))+
  theme(plot.title = element_text(size=5)) +
  #scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  #facet_wrap(~sim)+
  theme_bw() +  theme(axis.text.x = element_text( hjust=1, size = 8))

return(my_plot)
}

build_heatmap <- function(file, min_gen, max_gen, fill_line, fill_line_text, title, subt, y_label, x_label, red_blue=F){
  file$snake_newt_rep <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd, "_", file$rep)
  params<-create_parm_file(file, min_gen, max_gen)
  
 my_plot <- ggplot(params, aes(newt, paste0(snake, "_", rep))) +    # Create heatmap with ggplot2
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
  xlab(x_label) + ylab(y_label)+
  geom_tile(aes(fill = get(fill_line)))+theme(axis.text.x = element_text(angle = 45, hjust=1, size = 10), axis.text.y = element_text(size = 10))
 
 if(red_blue==FALSE){
  my_plot<- my_plot + scale_fill_viridis_c(name = fill_line_text) + theme(legend.text=element_text(angle = 45, hjust=1, size=10))
  }
 if(red_blue==TRUE){
  my_plot<- my_plot + scale_fill_gradient2(low = "red",mid = "beige", high = "blue", name = fill_line_text) + theme(legend.text=element_text(size=5))
 }
 
  return(my_plot)
}

trends_by_gen <- function(file, title, subt, x_label, y_label, min_gen, max_gen){
 
  plot <- ggplot(file[ which(file$generation>=min_gen & file$generation<=max_gen),]) +
    facet_wrap(~sim)+
    geom_line(aes(generation, dif, group=rep, col="dif"))+
    ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
    geom_line(aes(generation, Snake_mean_Pheno, group=rep, color="Snake_mean_Pheno"),)+
    geom_line(aes(generation, Newt_mean_Pheno, group=rep, color="Newt_mean_Pheno"))+
    geom_hline(yintercept=0, linetype="dashed", color="gray54")+
    ylim(-1.,2.5)+
    xlab(x_label) + ylab(y_label)+
    scale_color_manual(name = "Type",
values = c( "Snake_mean_Pheno" = "steelblue", "Newt_mean_Pheno" = "darkred", "dif" = "black"),
labels = c("Snake", "Newt", "Dif"))+
    theme_bw() + theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank())
  return(plot)
}

whale_gen <- function(file, title, subt, x_label, y_label,min_gen, max_gen, rep){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
dif <- ggplot(file[ which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep),]) +
  #xlim(0, 1000)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen, rep ",rep)) +
  xlab(x_label) + ylab(y_label)+
  geom_point(aes(x=as.numeric(Newt_pop_size), y=as.numeric(Snake_pop_size), color = dif))+
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      # strip.background = element_blank(), 
                      # strip.text.x = element_blank(), 
                      # panel.grid.major = element_blank(), 
                      # panel.grid.minor = element_blank(),
                      # panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}


pop_size_hist <- function(file, title, subt, x_label, y_label,min_gen, max_gen, rep){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  file<-file[ which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep),]
  themin <- min(file$Snake_pop_size-file$Newt_pop_size) 
  themax <- max(file$Snake_pop_size-file$Newt_pop_size)
  true_max <- max(abs(themin), abs(themax))
dif <- ggplot(file) +
  #xlim(0, 1000)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(Snake_pop_size-Newt_pop_size), fill="darkolivegreen4")+
  xlim((-1*themax)-5, themax+5)+
  theme(plot.title = element_text(size=5)) +
  facet_wrap(~sim)+
  geom_vline(xintercept = 0)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      # strip.background = element_blank(), 
                      # strip.text.x = element_blank(), 
                      # panel.grid.major = element_blank(), 
                      # panel.grid.minor = element_blank(),
                      # panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)
}

pheno_dif_hist <- function(file, title, subt, x_label, y_label,min_gen, max_gen, rep){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  file<-file[ which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep),]
  
  themin <- min(file$dif) 
  themax <- max(file$dif)
  true_max <- max(abs(themin), abs(themax))
dif <- ggplot(file) +
  #xlim(0, 1000)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen, rep ",rep)) +
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(dif), fill="aquamarine4")+
  xlim((-1*true_max)-1, true_max+1)+

  # y=as.numeric(Snake_pop_size-Newt_pop_size), color = snake_GA, shape = factor(newt_GA)
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  #scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  geom_vline(xintercept = 0)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      # strip.background = element_blank(), 
                      # strip.text.x = element_blank(), 
                      # panel.grid.major = element_blank(), 
                      # panel.grid.minor = element_blank(),
                      # panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}




two_hist <- function(file, title, subt, x_label, y_label,min_gen, max_gen, rep){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  
  file<-file[ which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep),]
  
  thepopmin <- min(file$Snake_pop_size-file$Newt_pop_size)/1000 
  thepopmax <- max(file$Snake_pop_size-file$Newt_pop_size)/1000
  thedifmin <- min(file$dif) 
  thedifmax <- max(file$dif)
  true_max <- max(abs(thepopmin), abs(thepopmax),abs(thedifmin), abs(thedifmax))

  data_points <- nrow(file[which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep &  file$snake_GA==file$snake_GA[1] &  file$newt_GA==file$newt_GA[1]),])
dif <- ggplot(file) +
  
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen, rep ",rep)) +
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(x=dif, y=..count../data_points), fill="#8B008B",  alpha = 0.65)+
  geom_histogram(aes(x=(Snake_pop_size-Newt_pop_size)/1000, y=..count../data_points), fill="#008B00",  alpha = 0.65)+
  scale_y_continuous(labels = scales::percent)+
  xlim((-1*true_max), true_max)+
  # y=as.numeric(Snake_pop_size-Newt_pop_size), color = snake_GA, shape = factor(newt_GA)
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  #scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  geom_vline(xintercept = 0)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      # strip.background = element_blank(), 
                      # strip.text.x = element_blank(), 
                      # panel.grid.major = element_blank(), 
                      # panel.grid.minor = element_blank(),
                      # panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}

two_hist_all_rep <- function(file, title, subt, x_label, y_label,min_gen, max_gen){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  
  file<-file[ which(file$generation>=min_gen & file$generation<=max_gen),]
  
  thepopmin <- min(file$Snake_pop_size-file$Newt_pop_size)/100 
  thepopmax <- max(file$Snake_pop_size-file$Newt_pop_size)/100
  thedifmin <- min(file$dif) 
  thedifmax <- max(file$dif)
  true_max <- max(abs(thepopmin), abs(thepopmax),abs(thedifmin), abs(thedifmax))

  data_points <- nrow(file[which(file$generation>=min_gen & file$generation<=max_gen  &  file$snake_GA==file$snake_GA[1] &  file$newt_GA==file$newt_GA[1]),])
  
dif <- ggplot(file) +
  
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(x=dif, y=..count../data_points), fill="#8B008B",  alpha = 0.65, bins = 20)+ #purple
  geom_histogram(aes(x=(Snake_pop_size-Newt_pop_size)/100, y=..count../data_points), fill="#008B00",  alpha = 0.65, bins = 20)+ #green
  scale_y_continuous(labels = scales::percent)+
  xlim((-1*true_max)-1, true_max+1)+
  # y=as.numeric(Snake_pop_size-Newt_pop_size), color = snake_GA, shape = factor(newt_GA)
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  #scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  geom_vline(xintercept = 0)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      #strip.background = element_blank(), 
                      strip.text.x = element_blank(), 
                      #panel.grid.major = element_blank(), 
                      #panel.grid.minor = element_blank(),
                      #panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}

two_hist_death_all_rep <- function(file, title, subt, x_label, y_label,min_gen, max_gen){
  #file=GA3_tall_tall_file
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  
  file<-file[ which(file$generation>=min_gen & file$generation<=max_gen),]
  
  thepopmin <- min(file$newt_deaths)
  thepopmax <- max(file$newt_deaths)
  thedifmin <- min(file$snake_deaths) 
  thedifmax <- max(file$snake_deaths)
  true_max <- max(abs(thepopmin), abs(thepopmax),abs(thedifmin), abs(thedifmax))

  data_points <- nrow(file[which(file$generation>=min_gen & file$generation<=max_gen  &  file$snake_GA==file$snake_GA[1] &  file$newt_GA==file$newt_GA[1]),])
  
dif <- ggplot(file) +
  
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(x=newt_deaths), fill="red",  alpha = 0.65, bins = 20)+
  geom_histogram(aes(x=snake_deaths), fill="blue",  alpha = 0.65, bins = 20)+
  #scale_y_continuous(labels = scales::percent)+
  #xlim((-1*true_max)-1, true_max+1)+
  # y=as.numeric(Snake_pop_size-Newt_pop_size), color = snake_GA, shape = factor(newt_GA)
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  #scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  #geom_vline(xintercept = 0)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      #strip.background = element_blank(), 
                      strip.text.x = element_blank(), 
                      #panel.grid.major = element_blank(), 
                      #panel.grid.minor = element_blank(),
                      #panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}

#two_hist_death_all_rep(GA3_tall_tall_file, title="Snake-Newt Winning Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Phenotype (purple) & Snake-Newt Popsize/100 (green)",  min_gen=20000, max_gen=25000)

```

## Mean Phenotype Whole Simulation {.tabset}

The first thing that I observe is the general mean newt and snake phenotype trends across time. In the phenotype differences figure the red and blue lines represent mean newt and snake phenotype.  The black lines are the differences between mean phenotypes of snakes and newts. The table shows the average mean phenotype differences from generation 100 to 50,000. In both the figure and table there will be a positive value when snakes have a higher phenotype and a negative value when newts have a higher phenotype.

### Phenotype differences
```{r, graphing by gen}
trends_by_gen(GA3_tall_tall_file, title="Space Tall: Newt VS Snake Population Size GA3", subt="Gen 16sims", y_label="Mean Phenotype", x_label="Generations", 100, 50000)


#aggregate(GA3_tall_tall_file[which(GA3_tall_tall_file$generation>=100 & GA3_tall_tall_file$generation<=50000),]$dif, list(GA3_tall_tall_file[which(GA3_tall_tall_file$generation>=100 & GA3_tall_tall_file$generation<=50000),]$group_rep), FUN=mean) 

```

### Table of average Differences

```{r, average difference}
aggregate(GA3_tall_tall_file[which(GA3_tall_tall_file$generation>=100 & GA3_tall_tall_file$generation<=50000),]$dif, list(GA3_tall_tall_file[which(GA3_tall_tall_file$generation>=100 & GA3_tall_tall_file$generation<=50000),]$group), FUN=mean) 
```

## {-}

In the phenotype differences figure the mean phenotypes of newts and snakes generally goes up. There are a few cases where the mean phenotype stays flat. There are two cases where the mean phenotype goes down (L, N, very rare). In most of the simulations newts end up having a higher mean phenotype (more black lines lower then 0 and negative means in the table). In the table, a larger value (both positive and negative) might indicate agreement between the simulation. A value closer to 0 can indicate a small difference between snake and newt mean phenotype or larger but opposite differences between snake and newt mean phenotype.

## Connection between higher phenotype and population {.tabset}

Previous results show that there is a connection between phenotype and population size. Typically, when one species has a larger phenotype they also have a larger population size (special note; snakes tend to have slightly larger population size when newt and snake phenotypes are close). The phenotype differences figure shows the newt population size by snake population size. Each dot is one time point from the simulation, the dots shown are from generation 5,000 to 10,000. The color of the dots is the difference between snake and newt mean phenotype (more blue snakes have a higher phenotype, more red newts have a higher phenotype).  The figure of phenotype and population size differences has two histograms. The purple histogram shows the difference between snake and newt phenotype. The green histogram shows the difference between snake and newt population size divided by 1000. I show one trials result below.

### Phenotype differences
```{r, whale}
min_gen=5000
max_gen=10000
rep=0

whale_gen(GA3_tall_tall_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake-Newt Popsize", x_label="Snake-Newt Phenotype", min_gen=min_gen, max_gen=max_gen, rep=rep )
```

### Phenotype & Populationsize differences
```{r, popsize and pheno}

suppressMessages(print(two_hist(GA3_tall_tall_file, title="Snake-Newt Winning Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Popsize/1000 (green) & Snake-Newt Phenotype (purple)",  min_gen=min_gen, max_gen=max_gen, rep=rep )))

#suppressMessages(print(two_hist_all_rep(GA3_tall_tall_file, title="Snake-Newt Winning Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Popsize/100 (green) & Snake-Newt Phenotype (purple)",  min_gen=min_gen, max_gen=max_gen)))


```

## {-}

In these figures, snakes often had a larger population size (even when newts phenotype is larger). In the phenotype differences figure, GA combinations that had resulted in higher newt phenotypes also resulted with a closer snake-newt population size. The cluster of the results tended to be in the right bottom corner. When snakes had a larger phenotype the clues of points tended to be in the top left corner. When looking at the histograms the difference between phenotypes is small, but newts have a higher mean phenotype in more than half of the GA combinations. The more positive the mean phenotype the difference the more positive the mean population size difference.

## Correlation

This next section is about spatial correlation! Over the course of two species co-evolving I predicted that there would be some areas in space when the phenotypes would both be higher and some areas when the phenotypes would both be lower. If this were true the spacial correlation would be high. However, the spatial correlation can also be negative or close to 0. It could be close to 0 if the mean phenotypes are randomly paired though out different locations. It could be negative if there is a high-low relationship between the phenotypes. 

Collecting an accurate spatial correlation is difficult. What is the correct time point or set of time points to be measuring from? What is the correct amount of area to be measuring from? How does the spreading of phenotype affect this measurement? How does spatial correlation change over time? In this figure there are four box plots per GA combination. Each of these box plot is form a different trial. the dashed black line is the real newt and snake spatial correlation.



```{r, combo myplots}
#files
#GA3_tall_tall_file
#GA2_long_file 
#GA3_cor_tall_file
#GA2_cor_file

# Legend: Not needed currently
# 
# - "CA" = mean_newt_pheno_By_mean_snake_pheno (Pink)
# - "CB" = num_newts_By_num_snakes (Green)
# - "CC" = sum_newt_pheno_By_num_snake (Blue)
# - "CD" = sum_snake_pheno_By_num_newt (Purple)

ginmin = 10000
ginmax = 15000

boxplot_cors_by_gen(GA3_cor_tall_file, "Simulation Correlation Comparied to Real Correlation Trials", "GA3", "newt/snake GAs&rep", "Cor", ginmin, ginmax)


#four_types_boxplot_cors_by_gen(GA3_cor_tall_file, "Simulation four Correlation", "GA3", "newt/snake GAs&rep", "Cor", ginmin, ginmax)


```

After looking at this figure, I can see that there is a larger range of correlation values. The can sometimes be positive, near 0, or negative. Very few reach (or come near) the real newt-snake correlation. How do you find the correct time slice to look for spatial correlation? How would these phenotypes become spatially correlated and then become not spatially correlated.


## Correlation Histograms {.tabset}

In order to understand how spatial correlations where changing with time I took 5,000 generation time slices to look at all four trials correlation values. Each color is a different trial per GA combination. The histogram values are stacked. 

### Plot 1
```{r, GA3 cor by dif windows}
ginmin = 0
ginmax = 5000
suppressMessages(print(hist_cors_by_gen_col_rep(GA3_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA3", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))
```

### Plot 2

```{r, GA3 cor by dif windows 2}
ginmin = 5000
ginmax = 10000
suppressMessages(print(hist_cors_by_gen_col_rep(GA3_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA3", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))
```

### Plot 3
```{r, GA3 cor by dif windows 3}
ginmin = 10000
ginmax = 15000
suppressMessages(print(hist_cors_by_gen_col_rep(GA3_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA3", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))
```

### Plot 4
```{r, GA3 cor by dif windows 4}
ginmin = 15000
ginmax = 20000
suppressMessages(print(hist_cors_by_gen_col_rep(GA3_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA3", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))
```

### Plot 5
```{r, GA3 cor by dif windows 5}
ginmin = 20000
ginmax = 25000
suppressMessages(print(hist_cors_by_gen_col_rep(GA3_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA3", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))
```

### Plot 6
```{r, GA3 cor by dif windows 6}
ginmin = 25000
ginmax = 30000
suppressMessages(print(hist_cors_by_gen_col_rep(GA3_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA3", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))
```

### Plot 7
```{r, GA3 cor by dif windows 7}
ginmin = 30000
ginmax = 35000
suppressMessages(print(hist_cors_by_gen_col_rep(GA3_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA3", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))
```

### Plot 8
```{r, GA3 cor by dif windows 8}
ginmin = 35000
ginmax = 40000
suppressMessages(print(hist_cors_by_gen_col_rep(GA3_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA3", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))
```

### Plot 9
```{r, GA3 cor by dif windows 9}
ginmin = 40000
ginmax = 45000
suppressMessages(print(hist_cors_by_gen_col_rep(GA3_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA3", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))
```

### Plot 10
```{r, GA3 cor by dif windows 10}
ginmin = 45000
ginmax = 50000
suppressMessages(print(hist_cors_by_gen_col_rep(GA3_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA3", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))
```

## {-}

What does it mean? Correlations seem to change a lot from time chunk to time chunk. They can go from positive to negative. Sometimes the trials seem to disagree. To get a better understanding of what might be going on in my simulation, I will plat the mean snake and newt phenotype and the spatial correlation over time.  

## Correlation across time {.tabset}

All of the correlations across time look very similar. Generally, mean newt and snake phenotypes (red and blue) go up overtime while the local correlation between the two fluctuates. Sometime one mean phenotype stays flat. The local correlations range from being very positive to being very negative. How can the correlation start to suddenly go up and then fall? It is hard to notice any differences between the GA combinations. For space I have chosen 3 random figures.


### Random 1
```{r, GA3 cor and pheno, results="hide"}
GA3_pattern <- unique(paste0(GA3_tall_tall_file$snake_mu_rate, "_", GA3_tall_tall_file$snake_mu_effect_sd,"_",GA3_tall_tall_file$newt_mu_rate, "_", GA3_tall_tall_file$newt_mu_effect_sd, "_", GA3_tall_tall_file$rep))

myrandomlist=sample.int(length(GA3_pattern), 3)

# for(i in myrandomlist){
#   myine<-cor_trends_by_gen(GA3_tall_tall_file, GA3_cor_tall_file, "test", "GA3", "newt/snake GAs&rep","other", "Cor", min_gen=100, max_gen=50000, pattern=GA3_pattern[i])
#   plot(myine)
# }

cor_trends_by_gen(GA3_tall_tall_file, GA3_cor_tall_file, "test", "GA3", "newt/snake GAs&rep","other", "Cor", min_gen=100, max_gen=50000, pattern=GA3_pattern[myrandomlist[1]])

```

### Random 2
```{r, random cor-pheno plot 2}

cor_trends_by_gen(GA3_tall_tall_file, GA3_cor_tall_file, "test", "GA3", "newt/snake GAs&rep","other", "Cor", min_gen=100, max_gen=50000, pattern=GA3_pattern[myrandomlist[2]])
```

### Random 3
```{r, random cor-pheno plot 3}

cor_trends_by_gen(GA3_tall_tall_file, GA3_cor_tall_file, "test", "GA3", "newt/snake GAs&rep","other", "Cor", min_gen=100, max_gen=50000, pattern=GA3_pattern[myrandomlist[3]])
```

## {-}

I still wonder why the correlation values go up and down, because the mean newt and snake phenotype keeps going up. I wonder if the individuals might be moving around too much. I wonder what would happen on a larger map?


## What happens over time (looking at the beginning, middle, and late part of my simulations) {.tabset}

This next section is just getting a glimpse at how newt & snake phenotype and population size differ over time. The populations start off with about 250 individuals each. Each individual has a different genetic background created from msprime.

### Pheno Beginning 

```{r, early plots}


min_gen=100
max_gen=5000


# for(i in 1:length(unique(GA3_tall_tall_file$rep))){
#   myine<-whale_gen(GA3_tall_tall_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA3_tall_tall_file$rep)[i])
#   plot(myine)
# 
# }
whale_gen(GA3_tall_tall_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA3_tall_tall_file$rep)[1])
```

### Pheno Middle 

```{r, middle plots}


min_gen=25000
max_gen=30000


# for(i in 1:length(unique(GA3_tall_tall_file$rep))){
#   myine<-whale_gen(GA3_tall_tall_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA3_tall_tall_file$rep)[i])
#   plot(myine)
# 
# }
whale_gen(GA3_tall_tall_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA3_tall_tall_file$rep)[1])
```

### Pheno End 

```{r, end plots}


min_gen=45000
max_gen=50000


# for(i in 1:length(unique(GA3_tall_tall_file$rep))){
#   myine<-whale_gen(GA3_tall_tall_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA3_tall_tall_file$rep)[i])
#   plot(myine)
# 
# }
whale_gen(GA3_tall_tall_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA3_tall_tall_file$rep)[1])
```

### Dif Beginning 
```{r, early plots 1a}


min_gen=100
max_gen=5000


# for(i in 1:length(unique(GA3_tall_tall_file$rep))){
#   myine<-two_hist(GA3_tall_tall_file, title="Snake-Newt Winning Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Phenotype (purple) & Snake-Newt Popsize/100 (green)",  min_gen=min_gen, max_gen=max_gen, rep=unique(GA3_tall_tall_file$rep)[i] )
#   suppressMessages(plot(myine))
# }

two_hist(GA3_tall_tall_file, title="Snake-Newt Winning Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Phenotype (purple) & Snake-Newt Popsize/100 (green)",  min_gen=min_gen, max_gen=max_gen, rep=unique(GA3_tall_tall_file$rep)[1] )

```

### Dif Middle 
```{r, early plots 2a}


min_gen=25000
max_gen=30000


# for(i in 1:length(unique(GA3_tall_tall_file$rep))){
#   myine<-two_hist(GA3_tall_tall_file, title="Snake-Newt Winning Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Phenotype (purple) & Snake-Newt Popsize/100 (green)",  min_gen=min_gen, max_gen=max_gen, rep=unique(GA3_tall_tall_file$rep)[i] )
#   suppressMessages(plot(myine))
# }

two_hist(GA3_tall_tall_file, title="Snake-Newt Winning Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Phenotype (purple) & Snake-Newt Popsize/100 (green)",  min_gen=min_gen, max_gen=max_gen, rep=unique(GA3_tall_tall_file$rep)[1] )

```

### Dif End 
```{r, early plots 3a}


min_gen=45000
max_gen=50000


# for(i in 1:length(unique(GA3_tall_tall_file$rep))){
#   myine<-two_hist(GA3_tall_tall_file, title="Snake-Newt Winning Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Phenotype (purple) & Snake-Newt Popsize/100 (green)",  min_gen=min_gen, max_gen=max_gen, rep=unique(GA3_tall_tall_file$rep)[i] )
#   suppressMessages(plot(myine))
# }

two_hist(GA3_tall_tall_file, title="Snake-Newt Winning Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Phenotype (purple) & Snake-Newt Popsize/100 (green)",  min_gen=min_gen, max_gen=max_gen, rep=unique(GA3_tall_tall_file$rep)[1] )

```

## {-}

In the beginning of the simulation you can see how the population size of newts and snakes rises. You can also see that for most of the GA combinations there is already one species that has a phenotypic advantage. Over time the population size figure becomes more of an oval. The color gets more intense in the middle and end figures. In the purple and green figures the difference in snake and newt phenotype gets more pronounce from the beginning to the middle of the simulation. The difference in population size fluctuates a bit, but there are no noticeable terns in these figures.

## Summary {.tabset}

In a previous simulation study (tall GA3) I saw a difference in population size and phenotype between the different GAs. I will try to see if these GA combination lead to differences in phenotypes and population sizes. We will compare newt population size to snake population size with each shape indicating newt GA and each color indicating snake GA. We will walk though the beginning, middle, and end of my simulation. We will also look at the snake population size by the difference between snake and newt phenotypes

### Early-Sim Population Size Summary 

```{r, early plots summary}

min_gen=100
max_gen=5000
GA_summary(GA3_tall_tall_file, min_gen=min_gen, max_gen=max_gen, x_line="Newt_pop_size", y_line="Snake_pop_size", title="Space: Newt VS Snake Population Size", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize")
```

### Mid-Sim Population Size Summary
```{r, plots summary 2}
# summary

min_gen=25000
max_gen=30000

# summary
GA_summary(GA3_tall_tall_file, min_gen=min_gen, max_gen=max_gen, x_line="Newt_pop_size", y_line="Snake_pop_size", title="Space: Newt VS Snake Population Size", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize")
```

### Late-Sim Population Size Summary
```{r, plots summary 3}
min_gen=45000
max_gen=50000

# summary
GA_summary(GA3_tall_tall_file, min_gen=min_gen, max_gen=max_gen, x_line="Newt_pop_size", y_line="Snake_pop_size", title="Space: Newt VS Snake Population Size", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize")

```

### Early Difference Summary
```{r, dif plots summary 1}

min_gen=100
max_gen=5000

GA_summary(GA3_tall_tall_file, min_gen=min_gen, max_gen=max_gen, x_line="dif", y_line="Snake_pop_size", title="Space: Dif VS Snake Population Size", subt="Gen 16sims", y_label="Snake Popsize", x_label="Dif")
```

### Mid Difference Summary
```{r, dif plots summary 2}
min_gen=25000
max_gen=30000


GA_summary(GA3_tall_tall_file, min_gen=min_gen, max_gen=max_gen, x_line="dif", y_line="Snake_pop_size", title="Space: Dif VS Snake Population Size", subt="Gen 16sims", y_label="Snake Popsize", x_label="Dif")

min_gen=45000
max_gen=50000
```

### Late Difference Summary
```{r, dif plots summary 3}
GA_summary(GA3_tall_tall_file, min_gen=min_gen, max_gen=max_gen, x_line="dif", y_line="Snake_pop_size", title="Space: Dif VS Snake Population Size", subt="Gen 16sims", y_label="Snake Popsize", x_label="Dif")


```

## {-}

After looking at the early population size summary, I noticed that at time when on the population size first spread out then started to gather in the center (into a diagonal line). There was no pattern or grouping between the shapes or colors. I saw the same thing in the difference summary. To confirm these finding I will now look at the heat maps.

## Heatmap {.tabset}

In this section I look at the heat maps for snake population size and mean phenotype difference for the beginning, middle, and end of my simulation. For all of these plots newt GA will be on the x-axis. The snake GA and simulation trial will be on the y-axis (each four can be read as a group). *This map y-axis is switched compared to all the other figures.* For the population size maps as the color goes from dark (purple) to light (yellow) the snake population size increases. For the difference phenotype maps the mean difference goes from blue to red, with blue indicating snakes have a higher phenotype and red indicating that newts have a higher phenotype.

### Population Size (Early) 

```{r, early plots Heatmap}

min_gen=100
max_gen=5000
#heatmap
build_heatmap(GA3_tall_tall_file, min_gen=min_gen, max_gen=max_gen, fill_line="Snake_pop_size", fill_line_text="Snake Population Size", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA", red_blue=F)
```

### Population Size (Mid)  
```{r, early plots Heatmap 2}
min_gen=25000
max_gen=30000
#heatmap
build_heatmap(GA3_tall_tall_file, min_gen=min_gen, max_gen=max_gen, fill_line="Snake_pop_size", fill_line_text="Snake Population Size", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA", red_blue=F)

```

### Population Size (Late) 
```{r, early plots Heatmap 3}
min_gen=45000
max_gen=50000
#heatmap
build_heatmap(GA3_tall_tall_file, min_gen=min_gen, max_gen=max_gen, fill_line="Snake_pop_size", fill_line_text="Snake Population Size", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA", red_blue=F)
```

### Phenotype (Early) 
```{r, early plots Heatmap pheno 1}
min_gen=100
max_gen=5000
build_heatmap(GA3_tall_tall_file, min_gen=min_gen, max_gen=max_gen, fill_line="dif", fill_line_text="Snake-Newt", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA",red_blue=T)
```

### Phenotype (Mid) 
```{r, early plots Heatmap pheno 2}

min_gen=25000
max_gen=30000
#heatmap

build_heatmap(GA3_tall_tall_file, min_gen=min_gen, max_gen=max_gen, fill_line="dif", fill_line_text="Snake-Newt", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA",red_blue=T)
```

### Phenotype (Late) 
```{r, early plots Heatmap pheno 3}
min_gen=45000
max_gen=50000
#heatmap

build_heatmap(GA3_tall_tall_file, min_gen=min_gen, max_gen=max_gen, fill_line="dif", fill_line_text="Snake-Newt", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA",red_blue=T)

```

## {-}

Again, I did not see a pattern between the GAs. I also did not see very good agreement between the trials. Results seemed very variable. 

## What is up with the correlations

This is the final section of this experiments' markdown. There are three examples shown below. In each example there will be a map like plot (x and y are locations) with snake (square) and newt (circle) phenotype and population size represented with color. Each example will have the mean phenotype, max phenotype, min phenotype, and population size. These examples will highlight a high positive, low, and high negative spatial correlation.


### High Correlation {.tabset}


#### Mean 
```{r, cor grid high cor mean}

#GA3_GA3_grid_tall_file


file_name="Snake_1e-10_0.05_Newt_1e-09_0.0158_1"
 #"Snake_1e-11_0.158_Newt_1e-10_0.05_0"

#Snake_1.0e-08_0.005_Newt_1.0e-11_0.158_0
spegen=30001

GA3<-GA3_GA3_grid_tall_file[which(GA3_GA3_grid_tall_file$snake_newt_rep==file_name & GA3_GA3_grid_tall_file$generation==spegen),]

GA3_mean = GA3[,grepl("generation|mean", names(GA3)) ]

data_long_mean <- gather(GA3_mean, condition, measurement, newt_mean_pheno_0:snake_mean_pheno_99, factor_key=TRUE)

data_long_mean[,c("species","type", "type2","location")]<- str_split_fixed(data_long_mean$condition, "_", 4)

data_long_mean_short<-data_long_mean

data_long_mean_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
data_long_mean_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

main_plot<-ggplot(data_long_mean_short)+
  labs(title = "Mean Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_mean_short[which(data_long_mean_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_mean_short[which(data_long_mean_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_mean_short[which(data_long_mean_short$species=="snake"),]
newt<-data_long_mean_short[which(data_long_mean_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")


newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("Mean Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)
```

#### SD 
```{r, cor grid high cor SD}

file_name="Snake_1e-10_0.05_Newt_1e-09_0.0158_1"
spegen=30001
# SD

GA3_sd = GA3[,grepl("generation|sd", names(GA3)) ]

data_long_sd <- gather(GA3_sd, condition, measurement, newt_sd_pheno_0:snake_sd_pheno_99, factor_key=TRUE)

data_long_sd[,c("species","type", "type2","location")]<- str_split_fixed(data_long_sd$condition, "_", 4)

data_long_sd_short<-data_long_sd

data_long_sd_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
data_long_sd_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

main_plot<-ggplot(data_long_sd_short)+
  labs(title = "SD Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_sd_short[which(data_long_sd_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_sd_short[which(data_long_sd_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_sd_short[which(data_long_sd_short$species=="snake"),]
newt<-data_long_sd_short[which(data_long_sd_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")


newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("SD Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)
```

#### Max Phenotype 
```{r, cor grid high cor max}

# max phenotype

GA3_max = GA3[,grepl("generation|max", names(GA3)) ]

data_long_max <- gather(GA3_max, condition, measurement, newt_max_pheno_0:snake_max_pheno_99, factor_key=TRUE)

data_long_max[,c("species","type", "type2","location")]<- str_split_fixed(data_long_max$condition, "_", 4)

data_long_max_short<-data_long_max

data_long_max_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
data_long_max_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

main_plot<-ggplot(data_long_max_short)+
  labs(title = "Max Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_max_short[which(data_long_max_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_max_short[which(data_long_max_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_max_short[which(data_long_max_short$species=="snake"),]
newt<-data_long_max_short[which(data_long_max_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")


newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("Max Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)
```

#### Min Phenotype 
```{r, cor grid high cor min}

# min phenotype

GA3_min = GA3[,grepl("generation|min", names(GA3)) ]

data_long_min <- gather(GA3_min, condition, measurement, newt_min_pheno_0:snake_min_pheno_99, factor_key=TRUE)

data_long_min[,c("species","type", "type2","location")]<- str_split_fixed(data_long_min$condition, "_", 4)

data_long_min_short<-data_long_min

data_long_min_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
data_long_min_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

main_plot<-ggplot(data_long_min_short)+
  labs(title = "Min Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_min_short[which(data_long_min_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_min_short[which(data_long_min_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_min_short[which(data_long_min_short$species=="snake"),]
newt<-data_long_min_short[which(data_long_min_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")


newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("Min Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)
```

#### Population Size
```{r, cor grid high cor popsize}

# popsize
#GA3_GA3_grid_tall_file population size

GA3_ind = GA3[,grepl("generation|num_ind", names(GA3)) ]

GA3_data_long_ind <- gather(GA3_ind, condition, measurement, newt_num_ind_0:snake_num_ind_99, factor_key=TRUE)

GA3_data_long_ind[,c("species","type", "type2","location")]<- str_split_fixed(GA3_data_long_ind$condition, "_", 4)

GA3_data_long_ind_short<-GA3_data_long_ind

GA3_data_long_ind_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
GA3_data_long_ind_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

GA3_data_long_ind_short$measurement[GA3_data_long_ind_short$measurement == 0]  <- NA

main_plot<-ggplot(GA3_data_long_ind_short)+
  labs(title = "Locations of Ind",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Number of Individuals")+
  geom_point(data = GA3_data_long_ind_short[which(GA3_data_long_ind_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = GA3_data_long_ind_short[which(GA3_data_long_ind_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c(option = "plasma")+
  theme_bw()+
  theme(legend.justification = "top")

snake<-GA3_data_long_ind_short[which(GA3_data_long_ind_short$species=="snake"),]
newt_GA3<-GA3_data_long_ind_short[which(GA3_data_long_ind_short$species=="newt"),]
newt_GA3$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt_GA3$measurement), use="complete.obs")



newt_GA3$info[newt_GA3$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
newt_GA3$info[newt_GA3$location %in% list(0, 19, 80, 99)] <- "corner"
newt_GA3$info[is.na(newt_GA3$info)]<- "middle"

extra_plot <- ggplot(newt_GA3)+
  ggtitle("Num of Ind") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)
    
```

### {-}

### Near Zero Correlation {.tabset}


#### Mean 
```{r, cor grid zerp cor mean}

file_name="Snake_1e-10_0.05_Newt_1e-09_0.0158_1"
spegen=20001
 #"Snake_1e-11_0.158_Newt_1e-10_0.05_0"

#Snake_1.0e-08_0.005_Newt_1.0e-11_0.158_0


GA3<-GA3_GA3_grid_tall_file[which(GA3_GA3_grid_tall_file$snake_newt_rep==file_name & GA3_GA3_grid_tall_file$generation==spegen),]

GA3_mean = GA3[,grepl("generation|mean", names(GA3)) ]

data_long_mean <- gather(GA3_mean, condition, measurement, newt_mean_pheno_0:snake_mean_pheno_99, factor_key=TRUE)

data_long_mean[,c("species","type", "type2","location")]<- str_split_fixed(data_long_mean$condition, "_", 4)

data_long_mean_short<-data_long_mean

data_long_mean_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
data_long_mean_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

main_plot<-ggplot(data_long_mean_short)+
  labs(title = "Mean Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_mean_short[which(data_long_mean_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_mean_short[which(data_long_mean_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_mean_short[which(data_long_mean_short$species=="snake"),]
newt<-data_long_mean_short[which(data_long_mean_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")


newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("Mean Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)
```

#### SD 
```{r, cor grid zero cor SD}

file_name="Snake_1e-10_0.05_Newt_1e-09_0.0158_1"
spegen=20001
# SD

GA3_sd = GA3[,grepl("generation|sd", names(GA3)) ]

data_long_sd <- gather(GA3_sd, condition, measurement, newt_sd_pheno_0:snake_sd_pheno_99, factor_key=TRUE)

data_long_sd[,c("species","type", "type2","location")]<- str_split_fixed(data_long_sd$condition, "_", 4)

data_long_sd_short<-data_long_sd

data_long_sd_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
data_long_sd_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

main_plot<-ggplot(data_long_sd_short)+
  labs(title = "SD Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_sd_short[which(data_long_sd_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_sd_short[which(data_long_sd_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_sd_short[which(data_long_sd_short$species=="snake"),]
newt<-data_long_sd_short[which(data_long_sd_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")


newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("SD Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)
```

#### Max Phenotype 
```{r, cor grid zero cor max}

# max phenotype
file_name="Snake_1e-10_0.05_Newt_1e-09_0.0158_1"
spegen=20001
GA3_max = GA3[,grepl("generation|max", names(GA3)) ]

data_long_max <- gather(GA3_max, condition, measurement, newt_max_pheno_0:snake_max_pheno_99, factor_key=TRUE)

data_long_max[,c("species","type", "type2","location")]<- str_split_fixed(data_long_max$condition, "_", 4)

data_long_max_short<-data_long_max

data_long_max_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
data_long_max_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

main_plot<-ggplot(data_long_max_short)+
  labs(title = "Max Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_max_short[which(data_long_max_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_max_short[which(data_long_max_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_max_short[which(data_long_max_short$species=="snake"),]
newt<-data_long_max_short[which(data_long_max_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")


newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("Max Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)
```

#### Min Phenotype 
```{r, cor grid zero cor min}

# min phenotype
file_name="Snake_1e-10_0.05_Newt_1e-09_0.0158_1"
spegen=20001
GA3_min = GA3[,grepl("generation|min", names(GA3)) ]

data_long_min <- gather(GA3_min, condition, measurement, newt_min_pheno_0:snake_min_pheno_99, factor_key=TRUE)

data_long_min[,c("species","type", "type2","location")]<- str_split_fixed(data_long_min$condition, "_", 4)

data_long_min_short<-data_long_min

data_long_min_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
data_long_min_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

main_plot<-ggplot(data_long_min_short)+
  labs(title = "Min Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_min_short[which(data_long_min_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_min_short[which(data_long_min_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_min_short[which(data_long_min_short$species=="snake"),]
newt<-data_long_min_short[which(data_long_min_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")


newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("Min Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)
```

#### Population Size
```{r, cor grid zer cor popsize}

# max phenotype
file_name="Snake_1e-10_0.05_Newt_1e-09_0.0158_1"
spegen=20001

GA3_ind = GA3[,grepl("generation|num_ind", names(GA3)) ]

GA3_data_long_ind <- gather(GA3_ind, condition, measurement, newt_num_ind_0:snake_num_ind_99, factor_key=TRUE)

GA3_data_long_ind[,c("species","type", "type2","location")]<- str_split_fixed(GA3_data_long_ind$condition, "_", 4)

GA3_data_long_ind_short<-GA3_data_long_ind

GA3_data_long_ind_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
GA3_data_long_ind_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

GA3_data_long_ind_short$measurement[GA3_data_long_ind_short$measurement == 0]  <- NA

main_plot<-ggplot(GA3_data_long_ind_short)+
  labs(title = "Locations of Ind",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Number of Individuals")+
  geom_point(data = GA3_data_long_ind_short[which(GA3_data_long_ind_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = GA3_data_long_ind_short[which(GA3_data_long_ind_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c(option = "plasma")+
  theme_bw()+
  theme(legend.justification = "top")

snake<-GA3_data_long_ind_short[which(GA3_data_long_ind_short$species=="snake"),]
newt_GA3<-GA3_data_long_ind_short[which(GA3_data_long_ind_short$species=="newt"),]
newt_GA3$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt_GA3$measurement), use="complete.obs")



newt_GA3$info[newt_GA3$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
newt_GA3$info[newt_GA3$location %in% list(0, 19, 80, 99)] <- "corner"
newt_GA3$info[is.na(newt_GA3$info)]<- "middle"

extra_plot <- ggplot(newt_GA3)+
  ggtitle("Num of Ind") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)
    
```

### {-}


### Negative Correlation {.tabset}


#### Mean 
```{r, cor grid neg cor mean}
file_name="Snake_1e-10_0.05_Newt_1e-09_0.0158_1"
spegen=48001
 #"Snake_1e-11_0.158_Newt_1e-10_0.05_0"
# file_name= "Snake_1e-08_0.005_Newt_1e-11_0.158_0"
# file_name= "Snake_1e-10_0.05_Newt_1e-11_0.158_3"
# file_name= "Snake_1e-08_0.005_Newt_1e-08_0.005_0"
# file_name= "Snake_1e-10_0.05_Newt_1e-09_0.0158_0"
#Snake_1.0e-08_0.005_Newt_1.0e-11_0.158_0


GA3<-GA3_GA3_grid_tall_file[which(GA3_GA3_grid_tall_file$snake_newt_rep==file_name & GA3_GA3_grid_tall_file$generation==spegen),]

GA3_mean = GA3[,grepl("generation|mean", names(GA3)) ]

data_long_mean <- gather(GA3_mean, condition, measurement, newt_mean_pheno_0:snake_mean_pheno_99, factor_key=TRUE)

data_long_mean[,c("species","type", "type2","location")]<- str_split_fixed(data_long_mean$condition, "_", 4)

data_long_mean_short<-data_long_mean

data_long_mean_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
data_long_mean_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

main_plot<-ggplot(data_long_mean_short)+
  labs(title = "Mean Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_mean_short[which(data_long_mean_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_mean_short[which(data_long_mean_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_mean_short[which(data_long_mean_short$species=="snake"),]
newt<-data_long_mean_short[which(data_long_mean_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")


newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("Mean Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)
```

#### SD 
```{r, cor grid neg cor SD}

file_name="Snake_1e-10_0.05_Newt_1e-09_0.0158_1"
spegen=48001
# SD

GA3_sd = GA3[,grepl("generation|sd", names(GA3)) ]

data_long_sd <- gather(GA3_sd, condition, measurement, newt_sd_pheno_0:snake_sd_pheno_99, factor_key=TRUE)

data_long_sd[,c("species","type", "type2","location")]<- str_split_fixed(data_long_sd$condition, "_", 4)

data_long_sd_short<-data_long_sd

data_long_sd_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
data_long_sd_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

main_plot<-ggplot(data_long_sd_short)+
  labs(title = "SD Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_sd_short[which(data_long_sd_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_sd_short[which(data_long_sd_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_sd_short[which(data_long_sd_short$species=="snake"),]
newt<-data_long_sd_short[which(data_long_sd_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")


newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("SD Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)
```

#### Max Phenotype 
```{r, cor grid neg cor max}

# max phenotype
file_name="Snake_1e-10_0.05_Newt_1e-09_0.0158_1"
spegen=48001

GA3_max = GA3[,grepl("generation|max", names(GA3)) ]

data_long_max <- gather(GA3_max, condition, measurement, newt_max_pheno_0:snake_max_pheno_99, factor_key=TRUE)

data_long_max[,c("species","type", "type2","location")]<- str_split_fixed(data_long_max$condition, "_", 4)

data_long_max_short<-data_long_max

data_long_max_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
data_long_max_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

main_plot<-ggplot(data_long_max_short)+
  labs(title = "Max Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_max_short[which(data_long_max_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_max_short[which(data_long_max_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_max_short[which(data_long_max_short$species=="snake"),]
newt<-data_long_max_short[which(data_long_max_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")


newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("Max Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)
```

#### Min Phenotype 
```{r, cor grid neg cor min}

# min phenotype
file_name="Snake_1e-10_0.05_Newt_1e-09_0.0158_1"
spegen=48001
GA3_min = GA3[,grepl("generation|min", names(GA3)) ]

data_long_min <- gather(GA3_min, condition, measurement, newt_min_pheno_0:snake_min_pheno_99, factor_key=TRUE)

data_long_min[,c("species","type", "type2","location")]<- str_split_fixed(data_long_min$condition, "_", 4)

data_long_min_short<-data_long_min

data_long_min_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
data_long_min_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

main_plot<-ggplot(data_long_min_short)+
  labs(title = "Min Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_min_short[which(data_long_min_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_min_short[which(data_long_min_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_min_short[which(data_long_min_short$species=="snake"),]
newt<-data_long_min_short[which(data_long_min_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")


newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("Min Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)
```

#### Population Size
```{r, cor grid neg cor popsize}

# max phenotype

file_name="Snake_1e-10_0.05_Newt_1e-09_0.0158_1"
spegen=48001
GA3_ind = GA3[,grepl("generation|num_ind", names(GA3)) ]

GA3_data_long_ind <- gather(GA3_ind, condition, measurement, newt_num_ind_0:snake_num_ind_99, factor_key=TRUE)

GA3_data_long_ind[,c("species","type", "type2","location")]<- str_split_fixed(GA3_data_long_ind$condition, "_", 4)

GA3_data_long_ind_short<-GA3_data_long_ind

GA3_data_long_ind_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
GA3_data_long_ind_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

GA3_data_long_ind_short$measurement[GA3_data_long_ind_short$measurement == 0]  <- NA

main_plot<-ggplot(GA3_data_long_ind_short)+
  labs(title = "Locations of Ind",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Number of Individuals")+
  geom_point(data = GA3_data_long_ind_short[which(GA3_data_long_ind_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = GA3_data_long_ind_short[which(GA3_data_long_ind_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c(option = "plasma")+
  theme_bw()+
  theme(legend.justification = "top")

snake<-GA3_data_long_ind_short[which(GA3_data_long_ind_short$species=="snake"),]
newt_GA3<-GA3_data_long_ind_short[which(GA3_data_long_ind_short$species=="newt"),]
newt_GA3$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt_GA3$measurement), use="complete.obs")



newt_GA3$info[newt_GA3$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
newt_GA3$info[newt_GA3$location %in% list(0, 19, 80, 99)] <- "corner"
newt_GA3$info[is.na(newt_GA3$info)]<- "middle"

extra_plot <- ggplot(newt_GA3)+
  ggtitle("Num of Ind") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)
    
```

### {-}











