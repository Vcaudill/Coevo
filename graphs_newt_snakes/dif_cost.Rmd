---
title: "Different Cost"
output: html_document
date: '2022-10-06'
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE,echo = FALSE) 

library(ggplot2)
library(viridis)
library(colorspace)
library(gridExtra)
library(tidyverse)
require(reshape2)
library(plyr)
library(gridGraphics)
library(grid)
library(knitr)
library(kableExtra)
library("reshape")
library(ggplot2)
library(ggpubr)
theme_set(theme_pubr())
library(stringr)
library(patchwork)
```

## Goal:

Think, explore, & write about what the co-evolutionary interaction between newts & snakes with different genetic architectures (GAs, combination of mutation rate & mutation effect size) under different cost settings. This markdown investigates the phenotype spatial correlation as the cost of a high phenotype changes (for both newts and snakes). I also plan on changing the interaction rate (but want to look at the math/ feasibility of it). 

### Questions:

How does cost size impact the spatial correlation of newt and snake phenotypes?

## Experiment

I created a simulation study to observe the co-evolutionary outcome of the newt-snake interaction with different genetic architectures (GAs) in a spatial setting. 

Landscape: A tall map!: 35*4 H, 35 W 

GA1 experiment values:

- 1e-8*(0.005)^2 = 2.5e-13
- 1e-9*(0.05)^2 = 2.5e-12
- 1e-10*(0.5)^2 = 2.5e-11
- 1e-11*(5.0)^2 = 2.5e-10


I tested different cost values:

  - 50
  - 100
  - 150
  - 200
  - 250

The higher a cost value the less impacting on the phenotype it is.

Each GA combination, trial, and cost has its own msprime simulation. There is only 1 trial per cost value.



```{bash, data file gathering}
#!/usr/bin/env bash

# Run these commands while in The the folder that contains the file you would like to condence
# Goal is to condense all the text files into one file 
# Requirements: need to have the same name and need to add additional columns
thepath=/Users/victoria/Desktop/
foldername=GA1_dif_cost
thefolder=${thepath}${foldername}/*

add_in_column=",rep,snake_mu_rate,snake_mu_effect_sd,newt_mu_rate,newt_mu_effect_sd,cost"

lit_head_file=$(find ${thepath}${foldername} -name "*_lit_*" | head -n 1)
lit_head=$(head -n 1 "${lit_head_file}")

cor_head_file=$(find ${thepath}${foldername} -name "*_cor_*" | head -n 1)
cor_head=$(head -n 1 "${cor_head_file}")

grid_head_file=$(find ${thepath}${foldername} -name "*_grid_*" | head -n 1)
grid_head=$(head -n 1 "${grid_head_file}")

if [[ -f ${thepath}${foldername}/all_lit.txt ]] && [[ -f ${thepath}${foldername}/all_grid.txt ]] && [[ -f ${thepath}${foldername}/all_cor.txt ]]
then
  echo "All cor, lit, and cost files exist!"
  echo "This program will now end!"
  exit 0
fi

#creating the files
echo ${lit_head}${add_in_column} > ${thepath}${foldername}/all_lit.txt
echo ${cost_head}${add_in_column} > ${thepath}${foldername}/all_grid.txt
echo ${cor_head}${add_in_column} > ${thepath}${foldername}/all_cor.txt


for filename in $thefolder*.text;
  do 
#getting the variables 

my_type=$(echo ${filename} |sed 's/.*GA205_//; s/_.*//')
snake_mu_rate=$(echo ${filename} |sed 's/.*snake_mu_rate_//; s/_.*//')
snake_mu_effect_sd=$(echo ${filename} |sed 's/.*snake_mu_effect_sd_//; s/_.*//')
newt_mu_rate=$(echo ${filename} |sed 's/.*newt_mu_rate_//; s/_.*//')
newt_mu_effect_sd=$(echo ${filename} |sed 's/.*newt_mu_effect_sd_//; s/_.*//')
cost=$(echo ${filename} |sed 's/.*_cost_//; s/_.*//')
rep=$(echo ${filename} | sed "s/.*rep_//; s/_.*//")
#echo ${newt_mu_rate}	
# echo $my_type
# echo $my_other_type
# these new columns adding them to the data
sed -i '' -e 's/$/,'${rep}'/' $filename
sed -i '' -e 's/$/,'${snake_mu_rate}'/' $filename
sed -i '' -e 's/$/,'${snake_mu_effect_sd}'/' $filename
sed -i '' -e 's/$/,'${newt_mu_rate}'/' $filename
sed -i '' -e 's/$/,'${newt_mu_effect_sd}'/' $filename
sed -i '' -e 's/$/,'${cost}'/' $filename
#infile >outfile
if [[ $my_type == "lit" ]]
then
    tail -n +2 -q $filename >> ${thepath}${foldername}/all_lit.txt
fi

if [[ $my_type == "grid" ]]
then
    tail -n +2 -q $filename >> ${thepath}${foldername}/all_grid.txt
fi

if [[ $my_type == "cor" ]]
then
    tail -n +2 -q $filename >> ${thepath}${foldername}/all_cor.txt
fi

done

```


```{r, read in the files}
snewt <- read.csv("~/Desktop/snake_newt_real_data.csv", header = TRUE)

GA1_lit_cost_file<- read.csv("~/Desktop/GA1_dif_cost/all_lit.txt" , header = TRUE)
GA1_lit_cost_file$group_rep <- paste0(GA1_lit_cost_file$snake_mu_rate, "_", GA1_lit_cost_file$snake_mu_effect_sd,"_",GA1_lit_cost_file$newt_mu_rate, "_", GA1_lit_cost_file$newt_mu_effect_sd, "_", GA1_lit_cost_file$rep)
GA1_lit_cost_file$group <- paste0(GA1_lit_cost_file$snake_mu_rate, "_", GA1_lit_cost_file$snake_mu_effect_sd,"_",GA1_lit_cost_file$newt_mu_rate, "_", GA1_lit_cost_file$newt_mu_effect_sd)
GA1_lit_cost_file$sim=LETTERS[factor(GA1_lit_cost_file$group)]
GA1_lit_cost_file$dif=as.numeric(GA1_lit_cost_file$Snake_mean_Pheno)-as.numeric(GA1_lit_cost_file$Newt_mean_Pheno)

GA1_lit_cost_file$Snake_mean_Pheno<-as.numeric(GA1_lit_cost_file$Snake_mean_Pheno)
GA1_lit_cost_file$generation<-as.numeric(GA1_lit_cost_file$generation)
GA1_lit_cost_file$Newt_mean_Pheno<-as.numeric(GA1_lit_cost_file$Newt_mean_Pheno)

GA1_cor_cost_file<- read.csv("~/Desktop/GA1_dif_cost/all_cor.txt" , header = TRUE)
GA1_cor_cost_file$group_rep <- paste0(GA1_cor_cost_file$snake_mu_rate, "_", GA1_cor_cost_file$snake_mu_effect_sd,"_",GA1_cor_cost_file$newt_mu_rate, "_", GA1_cor_cost_file$newt_mu_effect_sd, "_", GA1_cor_cost_file$rep)
GA1_cor_cost_file$group <- paste0(GA1_cor_cost_file$snake_mu_rate, "_", GA1_cor_cost_file$snake_mu_effect_sd,"_",GA1_cor_cost_file$newt_mu_rate, "_", GA1_cor_cost_file$newt_mu_effect_sd)
GA1_cor_cost_file$sim=LETTERS[factor(GA1_cor_cost_file$group)]

#GA1_lit_cost_file<-GA1_lit_cost_file[-c(115502), ] 
# GA1_grid_cost_file<- read.csv("~/Desktop/GA1_dif_cost/all_grid.txt" , header = TRUE)
# GA1_grid_cost_file$group_rep <- paste0(GA1_grid_cost_file$snake_mu_rate, "_", GA1_grid_cost_file$snake_mu_effect_sd,"_",GA1_grid_cost_file$newt_mu_rate, "_", GA1_grid_cost_file$newt_mu_effect_sd, "_", GA1_grid_cost_file$rep)
# GA1_grid_cost_file$group <- paste0(GA1_grid_cost_file$snake_mu_rate, "_", GA1_grid_cost_file$snake_mu_effect_sd,"_",GA1_grid_cost_file$newt_mu_rate, "_", GA1_grid_cost_file$newt_mu_effect_sd)
# GA1_grid_cost_file$sim=LETTERS[factor(GA1_grid_cost_file$group)]


```

```{r, cor box set up}

boxplot_cors_by_gen <- function(file, title, subt, x_label, y_label, min_gen, max_gen){
 snewt$mean_res = snewt$mean_toxin+snewt$dif
  real_snewt_cor = cor(snewt$mean_toxin, snewt$mean_res)
  file$snake_newt <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  #unique(file$sim)
  plot <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen),]) +
  ylim(-1.1, 1.1)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen"))+
  xlab(x_label) + ylab(y_label)+
  geom_boxplot(aes(x=factor(cost), y=as.numeric(mean_newt_pheno_By_mean_snake_pheno), color = factor(cost)))+
  geom_hline(yintercept=real_snewt_cor, linetype="dashed")+
    geom_hline(yintercept=0, linetype="solid")+
  #geom_boxplot(aes(x=factor("CB"), y=as.numeric(num_newts_By_num_snakes), color = "CB"))+
  #geom_boxplot(aes(x=factor("CC"), y=as.numeric(sum_newt_pheno_By_num_snake), color = "CC"))+
  #geom_boxplot(aes(x=factor("CD"), y=as.numeric(sum_snake_pheno_By_num_newt), color = "CD"))+
  theme(plot.title = element_text(size=5)) +
  facet_wrap(~sim)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank())


  return(plot)
}

boxplot_cor_grid_by_gen <- function(file, title, subt, x_label, y_label, min_gen, max_gen){
 snewt$mean_res = snewt$mean_toxin+snewt$dif
  real_snewt_cor = cor(snewt$mean_toxin, snewt$mean_res)
  file$snake_newt <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  unique(file$sim)
  plot <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen),]) +
  ylim(-1.1, 1.1)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen"))+
  xlab(x_label) + ylab(y_label)+
  geom_boxplot(aes(x=factor(grid_num), y=as.numeric(mean_newt_pheno_By_mean_snake_pheno), color = factor(grid_num)))+
  geom_hline(yintercept=real_snewt_cor, linetype="dashed")+
    geom_hline(yintercept=0, linetype="solid")+
  #geom_boxplot(aes(x=factor("CB"), y=as.numeric(num_newts_By_num_snakes), color = "CB"))+
  #geom_boxplot(aes(x=factor("CC"), y=as.numeric(sum_newt_pheno_By_num_snake), color = "CC"))+
  #geom_boxplot(aes(x=factor("CD"), y=as.numeric(sum_snake_pheno_By_num_newt), color = "CD"))+
  theme(plot.title = element_text(size=5)) +
  facet_wrap(~sim)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank())


  return(plot)
}


hist_cors_by_gen_col_rep <- function(file, title, subt, x_label, y_label, min_gen, max_gen){
 snewt$mean_res = snewt$mean_toxin+snewt$dif
  real_snewt_cor = cor(snewt$mean_toxin, snewt$mean_res)
   file$snake_newt <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  #unique(file$sim)
  plot <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen),]) +
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen"))+
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(x=as.numeric(mean_newt_pheno_By_mean_snake_pheno),fill=factor(rep)))+
  geom_vline(xintercept=real_snewt_cor, linetype="dashed")+
  geom_vline(xintercept=0, linetype="solid")+
  #geom_boxplot(aes(x=factor("CB"), y=as.numeric(num_newts_By_num_snakes), color = "CB"))+
  #geom_boxplot(aes(x=factor("CC"), y=as.numeric(sum_newt_pheno_By_num_snake), color = "CC"))+
  #geom_boxplot(aes(x=factor("CD"), y=as.numeric(sum_snake_pheno_By_num_newt), color = "CD"))+
  theme(plot.title = element_text(size=5)) +
  xlim(-1.1, 1.1)+
  facet_wrap(~sim)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank())


  return(plot)
}

hist_cors_by_gen_col_rep_nofill <- function(file, title, subt, x_label, y_label, min_gen, max_gen){
 snewt$mean_res = snewt$mean_toxin+snewt$dif
  real_snewt_cor = cor(snewt$mean_toxin, snewt$mean_res)
  file$snake_newt <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  unique(file$sim)
  plot <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen),]) +
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen"))+
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(x=as.numeric(mean_newt_pheno_By_mean_snake_pheno)))+
  geom_vline(xintercept=real_snewt_cor, linetype="dashed")+
  geom_vline(xintercept=0, linetype="solid")+
  #geom_boxplot(aes(x=factor("CB"), y=as.numeric(num_newts_By_num_snakes), color = "CB"))+
  #geom_boxplot(aes(x=factor("CC"), y=as.numeric(sum_newt_pheno_By_num_snake), color = "CC"))+
  #geom_boxplot(aes(x=factor("CD"), y=as.numeric(sum_snake_pheno_By_num_newt), color = "CD"))+
  theme(plot.title = element_text(size=5)) +
  #stat_bin(bins=30)+
  facet_wrap(~sim)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank())

suppressMessages(print(plot))

  return(plot)
}


var_cor <- function(file, cfile, title, subt, x_label, y_label, min_gen, max_gen){
  real_snewt_cor = cor(snewt$mean_toxin, snewt$mean_res)
  real_snewt_var = var(snewt$dif)
  var_cor_table=data.frame()

  
  for(i in 1:length(unique(file$snake_newt_rep))){
    pattern<-unique(file$snake_newt_rep)[i]
    temp_file<-file[which(file$gen>=min_gen & file$gen<=max_gen & file$snake_newt_rep==pattern),]
    temp_cor_file<-cfile[which(cfile$gen>=min_gen & cfile$gen<=max_gen & cfile$snake_newt_rep==pattern),]
    
    var_cor_table_temp<- data.frame("pattern"=pattern, "var"= var(temp_file$dif),"cor" = cor(temp_file$newt_toxin, temp_file$snake_res), "mean_corr" = mean(temp_cor_file$mean_newt_pheno_By_mean_snake_pheno))
    var_cor_table <- rbind(var_cor_table, var_cor_table_temp)
  }
 
  var_cor_table_temp<- data.frame("pattern"="real", "var"= real_snewt_var, "cor" = real_snewt_cor, "mean_corr" = real_snewt_cor)
  var_cor_table <- rbind(var_cor_table, var_cor_table_temp)
  
  plot <- ggplot(var_cor_table) +
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen"))+
  xlab(x_label) + ylab(y_label)+
  geom_point(aes(x=as.numeric(var), y=as.numeric(cor), color = pattern), shape=17, size=3)+
  geom_point(aes(x=as.numeric(var), y=as.numeric(mean_corr), color = pattern), size=3)+
  theme(plot.title = element_text(size=5)) +
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))


  return(plot)
}



cor_trends_by_gen <- function(file, cfile, title, subt, x_label, x_label_cor, y_label, min_gen, max_gen, pattern){
#file=GA1_lit_cost_file
#cfile=GA1_cor_cost_file 
 # pattern="1e-11_5_1e-11_5_0"
 # pattern="1e-11_5_1e-11_5_0"  
 file$snake_newt_rep <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd,"_", file$rep)
 last_point=file[ which(file$generation==max(file$generation) & file$snake_newt_rep==pattern),]
  
  cfile$snake_newt_rep <- paste0(cfile$snake_mu_rate, "_", cfile$snake_mu_effect_sd, "_", cfile$newt_mu_rate, "_", cfile$newt_mu_effect_sd, "_", cfile$rep)
  
  plot_1 <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen & file$snake_newt_rep==pattern),]) +
    #geom_line(aes(generation, dif, group=rep, col="dif"))+
    ggtitle(title, subtitle = paste0(subt," pattern ", pattern, " From ", min_gen, " gen to ", max_gen, " gen"))+
    geom_line(aes(generation, Snake_mean_Pheno, group=cost, color="Snake_mean_Pheno"),)+
    geom_line(aes(generation, Newt_mean_Pheno, group=cost, color="Newt_mean_Pheno"))+
    geom_point(data=last_point, aes(generation, Snake_mean_Pheno, color="Snake_mean_Pheno", shape=factor(cost)))+ 

    geom_point(data=last_point, aes(generation, Newt_mean_Pheno, color="Newt_mean_Pheno", shape=factor(cost)))+ 
    #ylim(0,10)+
    #xlab(x_label) + ylab(y_label)+
    scale_color_manual(name = "Type",
values = c( "Snake_mean_Pheno" = "steelblue", "Newt_mean_Pheno" = "darkred"),
labels = c("Snake", "Newt"),
guide = "none")+
    theme_bw() +theme(legend.position="right",
                      legend.title=element_text(size=7), 
                      legend.text=element_text(size=6),
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank(), axis.ticks.x = element_blank(), axis.text.x = element_blank(),
                      plot.margin=unit(c(1,1,+0.3,1), "cm"))
cor_plot <- ggplot(cfile[which(cfile$gen>=min_gen & cfile$gen<=max_gen & cfile$snake_newt_rep==pattern),]) +
    geom_line(aes(generation, mean_newt_pheno_By_mean_snake_pheno, col=factor(cost)))+
    #ggtitle(title, subtitle = subt) +
    ylim(-1.1, 1.1)+
    #xlab(x_label_cor) + ylab(y_label)+
    theme_bw() +theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="right",
                      legend.title=element_text(size=7), 
                      legend.text=element_text(size=6),
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank(),
                      plot.margin=unit(c(-0.5,1,1,1), "cm"))
  
  figure <- ggarrange(plot_1, cor_plot + font("x.text", size = 10),heights = c(2, 1.5),ncol = 1, nrow = 2, align = "v")

  return(figure)
}


pop_size_trends_by_gen <- function(file, cfile, title, subt, x_label, x_label_cor, y_label, min_gen, max_gen, pattern){
#file=GA1_lit_cost_file
#cfile=GA1_cor_cost_file 
 # pattern="1e-11_5_1e-11_5_0"
 # pattern="1e-11_5_1e-11_5_0"  
 file$snake_newt_rep <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd,"_", file$rep)
  last_point=file[ which(file$generation==max(file$generation) & file$snake_newt_rep==pattern),]

  cfile$snake_newt_rep <- paste0(cfile$snake_mu_rate, "_", cfile$snake_mu_effect_sd, "_", cfile$newt_mu_rate, "_", cfile$newt_mu_effect_sd, "_", cfile$rep)
  
  plot_1 <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen & file$snake_newt_rep==pattern),]) +
    #geom_line(aes(generation, dif, group=rep, col="dif"))+
    ggtitle(title, subtitle = paste0(subt," pattern ", pattern, " From ", min_gen, " gen to ", max_gen, " gen"))+
    geom_line(aes(generation, Snake_pop_size, group=cost, color="Snake"),)+
    geom_line(aes(generation, Newt_pop_size, group=cost, color="Newt"))+
    geom_point(data=last_point, aes(generation, Snake_pop_size, color="Snake", shape=factor(cost)))+ 

    geom_point(data=last_point, aes(generation, Newt_pop_size, color="Newt", shape=factor(cost)))+
    #ylim(0,10)+
    #xlab(x_label) + ylab(y_label)+
    scale_color_manual(name = "Type",
values = c( "Snake" = "steelblue", "Newt" = "darkred"),
labels = c("Snake", "Newt"),
guide = "none")+
    theme_bw() +theme(legend.position="right",
                      legend.title=element_text(size=7), 
                      legend.text=element_text(size=6),
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank(), axis.ticks.x = element_blank(), axis.text.x = element_blank(),
                      plot.margin=unit(c(1,1,+0.3,1), "cm"))
cor_plot <- ggplot(cfile[which(cfile$gen>=min_gen & cfile$gen<=max_gen & cfile$snake_newt_rep==pattern),]) +
    geom_line(aes(generation, num_newts_By_num_snakes, col=factor(cost)))+
    #ggtitle(title, subtitle = subt) +
    ylim(-1.1, 1.1)+
    #xlab(x_label_cor) + ylab(y_label)+
    theme_bw() +theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="right",
                      legend.title=element_text(size=7), 
                      legend.text=element_text(size=6),
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank(),
                      plot.margin=unit(c(-0.5,1,1,1), "cm"))
  
  figure <- ggarrange(plot_1, cor_plot + font("x.text", size = 10),heights = c(2, 1.5),ncol = 1, nrow = 2, align = "v")

  return(figure)
}



```

```{r, general file and graph making}

#the functions to make the params file and the summary and heatmap figures 

create_parm_file <- function(file, min_gen, max_gen, cost){
params <- data_frame()

for(i in 1:length(unique(file$snake_newt_rep))){

  pattern=unique(file$snake_newt_rep)[i]
  sumitup <- file[which(file$gen>=min_gen & file$gen<=max_gen & file$snake_newt_rep ==pattern & file$cost==cost),]
 
  params_temp<- data_frame(Newt_mean_Pheno=mean(sumitup$Newt_mean_Pheno),
                           Snake_mean_Pheno=mean(sumitup$Snake_mean_Pheno), 
                           Newt_mean_Pheno_sd=sd(sumitup$Newt_mean_Pheno),
                           Snake_mean_Pheno_sd=sd(sumitup$Snake_mean_Pheno),
                           Newt_pop_size=mean(sumitup$Newt_pop_size),
                           Snake_pop_size=mean(sumitup$Snake_pop_size),
                           dif=mean(sumitup$dif),
                           snake_mu_rate=sumitup$snake_mu_rate[1],
                           newt_mu_rate=sumitup$newt_mu_rate[1],
                           snake_mu_effect_sd=sumitup$snake_mu_effect_sd[1],
                           newt_mu_effect_sd=sumitup$newt_mu_effect_sd[1],
                           rep=sumitup$rep[1])
  
  
  params <- rbind(params, params_temp)
}

params$snake <- paste0(params$snake_mu_rate, "_",params$snake_mu_effect_sd)
params$newt <- paste0(params$newt_mu_rate, "_",params$newt_mu_effect_sd)
params$snake_newt <- paste0(params$snake, "_", params$newt)
return(params)
}


 create_parm_file_nc <- function(file, min_gen, max_gen){
   
   file$test_factor <- paste0(file$cost, "_", file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd, "_", file$rep)
   
params <- data_frame()

for(i in 1:length(unique(file$test_factor))){

  pattern=unique(file$test_factor)[i]
  sumitup <- file[which(file$gen>=min_gen & file$gen<=max_gen & file$test_factor ==pattern),]
 
  params_temp<- data_frame(Newt_mean_Pheno=mean(sumitup$Newt_mean_Pheno),
                           Snake_mean_Pheno=mean(sumitup$Snake_mean_Pheno), 
                           Newt_mean_Pheno_sd=sd(sumitup$Newt_mean_Pheno),
                           Snake_mean_Pheno_sd=sd(sumitup$Snake_mean_Pheno),
                           Newt_pop_size=mean(sumitup$Newt_pop_size),
                           Snake_pop_size=mean(sumitup$Snake_pop_size),
                           dif=mean(sumitup$dif),
                           snake_mu_rate=sumitup$snake_mu_rate[1],
                           newt_mu_rate=sumitup$newt_mu_rate[1],
                           snake_mu_effect_sd=sumitup$snake_mu_effect_sd[1],
                           newt_mu_effect_sd=sumitup$newt_mu_effect_sd[1],
                           rep=sumitup$rep[1],
                           cost=sumitup$cost[1])
  
  
  params <- rbind(params, params_temp)
}

params$snake <- paste0(params$snake_mu_rate, "_",params$snake_mu_effect_sd)
params$newt <- paste0(params$newt_mu_rate, "_",params$newt_mu_effect_sd)
params$snake_newt <- paste0(params$snake, "_", params$newt)
return(params)
}


GA_summary <- function(file, min_gen, max_gen, x_line, y_line, title, subt, y_label, x_label){

file$snake_newt_rep <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd, "_", file$rep)

params<-create_parm_file_nc(file, min_gen, max_gen)

my_plot <- ggplot(params) +
  #xlim(0, 1000)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
  xlab(x_label) + ylab(y_label)+
  geom_point(aes(x=as.numeric(get(x_line)), y=as.numeric(get(y_line)), color = factor(snake), shape=factor(newt), size=factor(cost)))+
#  geom_point(aes(x=as.numeric(Newt_pop_size_20), y=as.numeric(Snake_pop_size_20), color = factor(snake), shape=factor(newt)))+
  theme(plot.title = element_text(size=5)) +
  #scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  #facet_wrap(~sim)+
  theme_bw() +  theme(axis.text.x = element_text( hjust=1, size = 8))

return(my_plot)
}

build_heatmap <- function(file, min_gen, max_gen, fill_line, fill_line_text, title, subt, y_label, x_label, red_blue=F){

    params<-create_parm_file_nc(file, min_gen, max_gen)
  
  
 my_plot <- ggplot(params, aes(newt, paste0(snake, "_", cost))) +    # Create heatmap with ggplot2
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
  xlab(x_label) + ylab(y_label)+
  geom_tile(aes(fill = get(fill_line)))+theme(axis.text.x = element_text(angle = 45, hjust=1, size = 10), axis.text.y = element_text(size = 10))
 
 if(red_blue==FALSE){
  my_plot<- my_plot + scale_fill_viridis_c(name = fill_line_text) + theme(legend.text=element_text(angle = 45, hjust=1, size=10))
  }
 if(red_blue==TRUE){
  my_plot<- my_plot + scale_fill_gradient2(low = "red",mid = "beige", high = "blue", name = fill_line_text) + theme(legend.text=element_text(size=5))
 }
 
  return(my_plot)
}

trends_by_gen <- function(file, title, subt, x_label, y_label, min_gen, max_gen, rep){
 file$generation<-as.numeric(file$generation)
 file$Snake_mean_Pheno<-as.numeric(file$Snake_mean_Pheno)
 file$Newt_mean_Pheno<-as.numeric(file$Newt_mean_Pheno)
 last_point=file[ which(file$generation==max(file$generation)),]
  plot <- ggplot(file[ which(file$generation>=min_gen & file$generation<=max_gen),]) +
    facet_wrap(~sim)+
    geom_line(aes(generation, as.numeric(dif), group=cost, col="dif"))+
    geom_point(data=last_point, aes(generation, Snake_mean_Pheno, color="Snake_mean_Pheno", shape=factor(cost)))+ #, shape=cost, col="dif"

    geom_point(data=last_point, aes(generation, Newt_mean_Pheno, color="Newt_mean_Pheno", shape=factor(cost)))+ #, shape=cost, col="dif"
    #ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
    geom_line(aes(generation, Snake_mean_Pheno, group=cost, color="Snake_mean_Pheno"),)+
    geom_line(aes(generation, Newt_mean_Pheno, group=cost, color="Newt_mean_Pheno"))+
    geom_hline(yintercept=0, linetype="dashed", color="gray54")+
    #ylim(-1.,2.5)+
    xlab(x_label) + ylab(y_label)+
    scale_color_manual(name = "Type",
values = c( "Snake_mean_Pheno" = "steelblue", "Newt_mean_Pheno" = "darkred", "dif" = "black"),
labels = c("Snake", "Newt", "Dif"))+
    theme_bw() + theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="right",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank())
  return(plot)
}


whale_gen <- function(file, title, subt, x_label, y_label,min_gen, max_gen, rep){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
dif <- ggplot(file[ which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep),]) +
  #xlim(0, 1000)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen, rep ",rep)) +
  xlab(x_label) + ylab(y_label)+
  geom_point(aes(x=as.numeric(Newt_pop_size), y=as.numeric(Snake_pop_size), color = dif, shape=factor(cost)))+
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      # strip.background = element_blank(), 
                      # strip.text.x = element_blank(), 
                      # panel.grid.major = element_blank(), 
                      # panel.grid.minor = element_blank(),
                      # panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}

whale_gen_by_cost <- function(file, title, subt, x_label, y_label,min_gen, max_gen, rep, cost){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
dif <- ggplot(file[ which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep & file$cost==cost),]) +
  #xlim(0, 1000)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen, rep ",rep, " cost ", cost)) +
  xlab(x_label) + ylab(y_label)+
  geom_point(aes(x=as.numeric(Newt_pop_size), y=as.numeric(Snake_pop_size), color = dif))+
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      # strip.background = element_blank(), 
                      # strip.text.x = element_blank(), 
                      # panel.grid.major = element_blank(), 
                      # panel.grid.minor = element_blank(),
                      # panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}

pop_size_hist <- function(file, title, subt, x_label, y_label,min_gen, max_gen, rep){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  file<-file[ which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep),]
  themin <- min(file$Snake_pop_size-file$Newt_pop_size) 
  themax <- max(file$Snake_pop_size-file$Newt_pop_size)
  true_max <- max(abs(themin), abs(themax))
dif <- ggplot(file) +
  #xlim(0, 1000)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(Snake_pop_size-Newt_pop_size), fill="darkolivegreen4")+
  xlim((-1*themax)-5, themax+5)+
  theme(plot.title = element_text(size=5)) +
  facet_wrap(~sim)+
  geom_vline(xintercept = 0)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      # strip.background = element_blank(), 
                      # strip.text.x = element_blank(), 
                      # panel.grid.major = element_blank(), 
                      # panel.grid.minor = element_blank(),
                      # panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)
}

pheno_dif_hist <- function(file, title, subt, x_label, y_label,min_gen, max_gen, rep){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  file<-file[ which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep),]
  
  themin <- min(file$dif) 
  themax <- max(file$dif)
  true_max <- max(abs(themin), abs(themax))
dif <- ggplot(file) +
  #xlim(0, 1000)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen, rep ",rep)) +
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(dif), fill="aquamarine4")+
  xlim((-1*true_max)-1, true_max+1)+

  # y=as.numeric(Snake_pop_size-Newt_pop_size), color = snake_GA, shape = factor(newt_GA)
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  #scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  geom_vline(xintercept = 0)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      # strip.background = element_blank(), 
                      # strip.text.x = element_blank(), 
                      # panel.grid.major = element_blank(), 
                      # panel.grid.minor = element_blank(),
                      # panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}




two_hist <- function(file, title, subt, x_label, y_label,min_gen, max_gen, rep){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  
  file<-file[ which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep),]
  
  thepopmin <- min(file$Snake_pop_size-file$Newt_pop_size)/100 
  thepopmax <- max(file$Snake_pop_size-file$Newt_pop_size)/100
  thedifmin <- min(file$dif) 
  thedifmax <- max(file$dif)
  true_max <- max(abs(thepopmin), abs(thepopmax),abs(thedifmin), abs(thedifmax))

  data_points <- nrow(file[which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep &  file$snake_GA==file$snake_GA[1] &  file$newt_GA==file$newt_GA[1]),])
dif <- ggplot(file) +
  
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen, rep ",rep)) +
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(x=dif, y=..count../data_points), fill="#8B008B",  alpha = 0.65)+
  geom_histogram(aes(x=(Snake_pop_size-Newt_pop_size)/100, y=..count../data_points), fill="#008B00",  alpha = 0.65)+
  scale_y_continuous(labels = scales::percent)+
  xlim((-1*true_max)-1, true_max+1)+
  # y=as.numeric(Snake_pop_size-Newt_pop_size), color = snake_GA, shape = factor(newt_GA)
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  #scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  geom_vline(xintercept = 0)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      # strip.background = element_blank(), 
                      # strip.text.x = element_blank(), 
                      # panel.grid.major = element_blank(), 
                      # panel.grid.minor = element_blank(),
                      # panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}

two_hist_all_rep <- function(file, title, subt, x_label, y_label,min_gen, max_gen){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  
  file<-file[ which(file$generation>=min_gen & file$generation<=max_gen),]
  
  thepopmin <- min(file$Snake_pop_size-file$Newt_pop_size)/100 
  thepopmax <- max(file$Snake_pop_size-file$Newt_pop_size)/100
  thedifmin <- min(file$dif) 
  thedifmax <- max(file$dif)
  true_max <- max(abs(thepopmin), abs(thepopmax),abs(thedifmin), abs(thedifmax))

  data_points <- nrow(file[which(file$generation>=min_gen & file$generation<=max_gen  &  file$snake_GA==file$snake_GA[1] &  file$newt_GA==file$newt_GA[1]),])
  
dif <- ggplot(file) +
  
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(x=dif, y=..count../data_points), fill="#8B008B",  alpha = 0.65, bins = 20)+ #purple
  geom_histogram(aes(x=(Snake_pop_size-Newt_pop_size)/100, y=..count../data_points), fill="#008B00",  alpha = 0.65, bins = 20)+ #green
  scale_y_continuous(labels = scales::percent)+
  xlim((-1*true_max)-1, true_max+1)+
  # y=as.numeric(Snake_pop_size-Newt_pop_size), color = snake_GA, shape = factor(newt_GA)
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  #scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  geom_vline(xintercept = 0)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      #strip.background = element_blank(), 
                      strip.text.x = element_blank(), 
                      #panel.grid.major = element_blank(), 
                      #panel.grid.minor = element_blank(),
                      #panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}

two_hist_death_all_rep <- function(file, title, subt, x_label, y_label,min_gen, max_gen){
  #file=GA1_lit_cost_file
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  
  file<-file[ which(file$generation>=min_gen & file$generation<=max_gen),]
  
  thepopmin <- min(file$newt_deaths)
  thepopmax <- max(file$newt_deaths)
  thedifmin <- min(file$snake_deaths) 
  thedifmax <- max(file$snake_deaths)
  true_max <- max(abs(thepopmin), abs(thepopmax),abs(thedifmin), abs(thedifmax))

  data_points <- nrow(file[which(file$generation>=min_gen & file$generation<=max_gen  &  file$snake_GA==file$snake_GA[1] &  file$newt_GA==file$newt_GA[1]),])
  
dif <- ggplot(file) +
  
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(x=newt_deaths), fill="red",  alpha = 0.65, bins = 20)+
  geom_histogram(aes(x=snake_deaths), fill="blue",  alpha = 0.65, bins = 20)+
  #scale_y_continuous(labels = scales::percent)+
  #xlim((-1*true_max)-1, true_max+1)+
  # y=as.numeric(Snake_pop_size-Newt_pop_size), color = snake_GA, shape = factor(newt_GA)
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  #scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  #geom_vline(xintercept = 0)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      #strip.background = element_blank(), 
                      strip.text.x = element_blank(), 
                      #panel.grid.major = element_blank(), 
                      #panel.grid.minor = element_blank(),
                      #panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}

grid_plot<- function(file_name, spegen, file, type, row_num, col_num, cost){
file$snake_newt_rep <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd,"_",file$newt_mu_rate, "_", file$newt_mu_effect_sd, "_", file$rep)

GA1<-file[which(file$snake_newt_rep==file_name & file$generation==spegen & file$cost==cost),]
GA1_type = paste0("generation|", type)  

GA1_type = GA1[,grepl(GA1_type, names(GA1)) ]
GA1_type <- GA1_type[-1]

data_long_type_comp <- gather(GA1_type, condition, measurement, factor_key=TRUE)
data_long_type_comp[,c("species","type", "type2","location")]<- str_split_fixed(data_long_type_comp$condition, "_", 4)

data_long_type_comp$y_loc<- rep(sort(c(rep.int(row_num:1, 2)), decreasing = TRUE),col_num)

data_long_type_comp$x_loc<- sort(rep.int(1:col_num, row_num*2))
  
main_plot<-ggplot(data_long_type_comp)+
  
  geom_point(data = data_long_type_comp[which(data_long_type_comp$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_type_comp[which(data_long_type_comp$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  #ylim(0, row_num)+
  #xlim(0, col_num)+
  theme_bw()+
  theme(legend.justification = "top")

if(type != "num_ind"){
main_plot<- main_plot + labs(title = paste0(str_to_title(type)," Phenotype of Locations"),
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
 scale_fill_viridis_c()
}
if(type == "num_ind"){
main_plot<- main_plot + labs(title = paste0(str_to_title(type)," Phenotype of Locations"),
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Newt/Snake Phenotype")+
scale_fill_viridis_c(option = "plasma")
} 
  

snake<-data_long_type_comp[which(data_long_type_comp$species=="snake"),]
newt<-data_long_type_comp[which(data_long_type_comp$species=="newt"),]
newt$snake_value <- snake$measurement
print(cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs"))

newt$info <- "middle"
#need to look into, coloring problem
newt$info[newt$location %in% c(0, row_num-1, col_num*row_num-1-row_num, col_num*row_num-1)] <- "corner"

newt$info[newt$location %in% c(c(1:(row_num-2)), seq(row_num, (col_num*row_num-row_num-2), row_num), seq((row_num-1+row_num), (col_num*row_num-1-row_num-row_num), row_num),  c((col_num*row_num-row_num):(col_num*row_num-2)))]   <- "edge"


extra_plot <- ggplot(newt)+
  ggtitle("Mean Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))



final_plot <- main_plot +  inset_element(extra_plot, left = 1., bottom = -0.10, right = 1.35, top = 0.5)
return(final_plot)}


```


## Mean Newt and Snke Phenotype by Generation

In this first section I look at the entire populations mean phenotype for both snakes (blue) and newts (red). The difference between mean snake and mean newt phenotype is shown on the black line. For each GA combination there are 5 sets of lines (5 red, blue, $ black). Each shape at the set of lines corresponds to the cost value, which 50 = circle, 100 = triangle, 150 = square, 200 = plus, and 250 = square with an x. The higher the cost values the less costly a high phenotype for the species is. The cost values range from 50 (more costly) to 250 (less costly). 

```{r, graphing by gen}


trends_by_gen(GA1_lit_cost_file, title="Space Tall: Newt VS Snake Population Size GA1", subt="Gen 16sims", y_label="Mean Phenotype", x_label="Generations", 100, 30000, rep=0)

```

The first things that I saw was how high the phenotypes got when the cost value when up. The phenotype seems to reach an optimum spot (an equilibrium) depending on what the cost value is for most of the GA combinations. For GA combinations that had one species with a low mutational variance the mean phenotype of the population did not get very high. It might take the simulation a bit more time to reach an equilibrium mean phenotype. When there is room for the phenotype to change newts and snakes mean phenotype costly follow each other. 

## Interaction of Population size and Phenotype

Nest, I observe the interaction between the population size of newts and snakes and the mean phenotype difference (snakes-newts). Here, newt population size is on the x-axis while snake population size is on the y-axis. Blue points occur when the mean snake phenotype is higher and red points occur when the newt mean phenotype is larger. I added the cost values as shapes. 

```{r, whale}
min_gen=5000
max_gen=10000
rep=0


whale_gen(GA1_lit_cost_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Phenotype", min_gen=min_gen, max_gen=max_gen, rep=rep )
```

It seems like each cost value clusters together with some overlapping other cost values or completely different form others. For example when the GA combination has a high mutational variance for both newts and snakes (K, L, O, P) the cost values all overlap. When at least one of the species has a lower mutational variance there is more of a range in the results (different population sizes & mean phenotype).

## Phenotype Spatial Correlation of 30,000 Generations


Phenotype Spatial Correlation of 30,000 Generations

This  section examines the spatial correlation of newts and snakes local phenotype for the different cost values. Each cost values has its own boxplot color. There are five boxplots per GA combination. This figure contains the correlation results for the entire length of the simulations.

```{r, combo myplots}


ginmin = 0
ginmax = 30000
#thecolors=c("#F8766D", "#B79F00", "#00BA38", "#00BFC4", "#619CFF", "#F564E3")

boxplot_cors_by_gen(GA1_cor_cost_file, "Cost: Simulation Correlation By Grid Number Comparied to Real Correlation Trials", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)

```

There is no spatial phenotype correlation pattern between the cost value and the GA combination. Each of these boxplots are an identical simulation so there is some randomness between the differ cost values within the GA combination. The spatial phenotype correlation seems very random. The only GA where it might not be random is when both newts and snakes have a low mutational variance (the correlation seems to be decreasing). 

## Correlations in Time-slices  {.tabset}

In order to understand how spatial correlations are changing with time, I took 5,000 generation time slices to look at the correlation values of all five cost values. Each color is a different cost value per GA combination. 

### Plot 1
```{r, GA1 cor by dif windows}
ginmin = 0
ginmax = 5000
boxplot_cors_by_gen(GA1_cor_cost_file, "Cost: Simulation Correlation By Grid Number Comparied to Real Correlation Trials", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)
```

### Plot 2

```{r, GA1 cor by dif windows 2}
ginmin = 5000
ginmax = 10000
boxplot_cors_by_gen(GA1_cor_cost_file, "Cost: Simulation Correlation By Grid Number Comparied to Real Correlation Trials", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)
```

### Plot 3
```{r, GA1 cor by dif windows 3}
ginmin = 10000
ginmax = 15000
boxplot_cors_by_gen(GA1_cor_cost_file, "Cost: Simulation Correlation By Grid Number Comparied to Real Correlation Trials", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)
```

### Plot 4
```{r, GA1 cor by dif windows 4}
ginmin = 15000
ginmax = 20000
boxplot_cors_by_gen(GA1_cor_cost_file, "Cost: Simulation Correlation By Grid Number Comparied to Real Correlation Trials", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)
```

### Plot 5
```{r, GA1 cor by dif windows 5}
ginmin = 20000
ginmax = 25000
boxplot_cors_by_gen(GA1_cor_cost_file, "Cost: Simulation Correlation By Grid Number Comparied to Real Correlation Trials", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)
```

### Plot 6
```{r, GA1 cor by dif windows 6}
ginmin = 25000
ginmax = 30000
boxplot_cors_by_gen(GA1_cor_cost_file, "Cost: Simulation Correlation By Grid Number Comparied to Real Correlation Trials", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)
```

## {-}

The spatial phenotype correlation between newts and snakes seems to jump around between time slices. There is no clear direction the boxplots are moving in. Sometimes the correlation is negative, near zero or positive. The spatial correlation seems random.  





## Phenotype Correlation across time {.tabset}

Next, we will examine three randomly chosen GA combinations with all of the different cost values from this experiment. Time (in generations) in on the x-axis and both mean phenotype and phenotype spatial correlation in on the y-axis (with cost values indicated by shape and color). Newt whole population mean phenotype is red, while snake mean phenotype is blue. The multi-colored lines are the phenotype spatial correlation for a specific cost value.  


### Random 1 
```{r, GA1 cor and pheno}
GA1_pattern <- unique(paste0(GA1_lit_cost_file$snake_mu_rate, "_", GA1_lit_cost_file$snake_mu_effect_sd,"_",GA1_lit_cost_file$newt_mu_rate, "_", GA1_lit_cost_file$newt_mu_effect_sd, "_", GA1_lit_cost_file$rep))

myrandomlist=sample.int(length(GA1_pattern), 3)


cor_trends_by_gen(GA1_lit_cost_file, GA1_cor_cost_file, "test", "GA1", "newt/snake GAs&rep","other", "Cor", min_gen=100, max_gen=30000, pattern=GA1_pattern[myrandomlist[1]])

```

### Random 2 
```{r, random cor-pheno plot 2}

cor_trends_by_gen(GA1_lit_cost_file, GA1_cor_cost_file, "test", "GA1", "newt/snake GAs&rep","other", "Cor", min_gen=100, max_gen=50000, pattern=GA1_pattern[myrandomlist[2]])
```

### Random 3 
```{r, random cor-pheno plot 3}

cor_trends_by_gen(GA1_lit_cost_file, GA1_cor_cost_file, "test", "GA1", "newt/snake GAs&rep","other", "Cor", min_gen=100, max_gen=50000, pattern=GA1_pattern[myrandomlist[3]])
```

## {-}

Again, the spatial correlation of newt and snake phenotypes seems very random. Even when both newt and snake mean phenotypes are going up the spatial correlation fluctuates from positive to negative. No one cost value makes the spatial correlation larger or smaller (all cost values have correlations that overlap with none having a significant greater variance).   


## Population Size Correlation across time {.tabset}

Next, we will examine three randomly chosen GA combinations with all of the different cost values from this experiment. Time (in generations) in on the x-axis and both population size and population size spatial correlation in on the y-axis (with cost values indicated by shape and color). Newt whole population  population size is red, while snake  population size is blue. The multi-colored lines are the population size spatial correlation for a specific cost value.  


### Random 1 
```{r, GA1 pop size 1}
pop_size_trends_by_gen(GA1_lit_cost_file, GA1_cor_cost_file, "test", "GA1", "newt/snake GAs&rep","other", "Cor", min_gen=100, max_gen=50000, pattern=GA1_pattern[myrandomlist[1]])

```

### Random 2 
```{r, random pop size plot 2}

pop_size_trends_by_gen(GA1_lit_cost_file, GA1_cor_cost_file, "test", "GA1", "newt/snake GAs&rep","other", "Cor", min_gen=100, max_gen=50000, pattern=GA1_pattern[myrandomlist[2]])
```

### Random 3 
```{r, random pop size plot 3}

pop_size_trends_by_gen(GA1_lit_cost_file, GA1_cor_cost_file, "test", "GA1", "newt/snake GAs&rep","other", "Cor", min_gen=100, max_gen=50000, pattern=GA1_pattern[myrandomlist[3]])
```

## {-}

There might be a relationship between cost and spatial population size correlations. First, I would like to note that these values should be negatively correlated, but sense I did not set the per-area true the edges and corners are smaller throwing my correlation values off. I think that the higher the cost value the more negatively correlated the population size between newts and snakes. If one species has a higher phenotype there would be less of the other species. This would be occurring in different areas of my simulation creating a stronger negative correlation. Or there is something else occurring that I am not currently taking into account.       

## What happens over time (looking at the beginning and late part of my simulations) {.tabset}

Now, I will take a glace at the how the population size of newts and snakes as well as the mean phenotype difference between snake and newts changed between the different cost values. I will look at my simulation results from the beginning and end of the simulation. Color indicate the mean phenotype difference (blue = snakes have a higher mean phenotype, red = newts have a higher mean phenotype). 

### Pheno Beginning 50

```{r, early 50 plots}


min_gen=100
max_gen=5000
cost=50

whale_gen_by_cost(GA1_lit_cost_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_lit_cost_file$rep)[1], cost)
```

### Pheno Beginning 100

```{r, early 100 plots}


min_gen=100
max_gen=5000
cost=100

whale_gen_by_cost(GA1_lit_cost_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_lit_cost_file$rep)[1], cost)
```



### Pheno Beginning 150

```{r, early 150 plots}


min_gen=100
max_gen=5000
cost=150

whale_gen_by_cost(GA1_lit_cost_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_lit_cost_file$rep)[1], cost)
```

### Pheno Beginning 200

```{r, early 200 plots}


min_gen=100
max_gen=5000
cost=200

whale_gen_by_cost(GA1_lit_cost_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_lit_cost_file$rep)[1], cost)
```


### Pheno Beginning 250

```{r, early 250 plots}


min_gen=100
max_gen=5000
cost=250

whale_gen_by_cost(GA1_lit_cost_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_lit_cost_file$rep)[1], cost)
```


### Pheno End 50

```{r, late 50 plots}


min_gen=25000
max_gen=30000
cost=50

whale_gen_by_cost(GA1_lit_cost_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_lit_cost_file$rep)[1], cost)
``` 

### Pheno End 100

```{r, late 100 plots}


min_gen=25000
max_gen=30000
cost=100

whale_gen_by_cost(GA1_lit_cost_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_lit_cost_file$rep)[1], cost)
``` 


### Pheno End 150

```{r, late 150 plots}


min_gen=25000
max_gen=30000
cost=150

whale_gen_by_cost(GA1_lit_cost_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_lit_cost_file$rep)[1], cost)
``` 


### Pheno End 200

```{r, late 200 plots}


min_gen=25000
max_gen=30000
cost=200

whale_gen_by_cost(GA1_lit_cost_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_lit_cost_file$rep)[1], cost)
``` 

### Pheno End 250

```{r, late 250 plots}


min_gen=25000
max_gen=30000
cost=250

whale_gen_by_cost(GA1_lit_cost_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_lit_cost_file$rep)[1], cost)
``` 

## {-}

All of the beginning figures look very similar. The population size of newts and snakes starts out small and then grows. Sometimes the snake population size and mean phenotype gets larger and other times the newt population size nd mean phenotype gets larger. Near the end of the simulation (last 5,000 generations) there are differences between the different cost values. I found as you increase the cost the larger the difference in newt and snake population size becomes between the different GA combinations. I can see this by witnessing the clusters getting smaller, but really the x & y axis are really just getting larger. When the cost value was low the population sizes and the difference between mean phenotype between GA combinations were close. As the cost value went up, the difference between snake and newt mean phenotype increased. 


## Summary {.tabset}

In the summary section, I try to come up with a way to show how different GA combinations can change the simulations results. In all of these plots snakes GA is represented by color and newt GA is represented by shape. Shape size represents the cost value (the larger the cost value the larger the shape). There 16 color-shape combinations (with 4 repeats for trials). There are two sets of plots: 1) newt by snake population size, 2) phenotype difference by snake population size. These are whole population calculations and are done for the least 5,000 generations. 



### Cost: Late-Sim Population Size Summary 
```{r, 50 plots summary 2}
# summary

min_gen=25000
max_gen=30000

# summary
GA_summary(GA1_lit_cost_file, min_gen=min_gen, max_gen=max_gen, x_line="Newt_pop_size", y_line="Snake_pop_size", title="Space: Newt VS Snake Population Size", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize")
```


### Cost: Late Difference Summary
```{r, 50 dif plots summary 2}
min_gen=25000
max_gen=30000

GA_summary(GA1_lit_cost_file, min_gen=min_gen, max_gen=max_gen, x_line="dif", y_line="Snake_pop_size", title="Space: Dif VS Snake Population Size", subt="Gen 16sims", y_label="Snake Popsize", x_label="Dif")

```

## {-}

There seems to be some pattern between the different GA combinations and cost values. Previously I noted, that there is both shape and color separation, and that intermediate GA do better (1e-09_0.05 & 1e-10_0.5) in a co-evolutionary arms race. Here that is still true but it is more difficult to see when I change the cost values. A higher cost value increases the difference in population size and phenotype difference, it exaggerates the difference. When the cost values and the mutational variance of at lease one of the species are high they cluster (both newts and snakes have close phenotypes and population sizes, snakes tend to always have a slightly larger population size and newts are slightly more toxic). If given more time, I think there would be greater separation of colors, shapes, and cost values.

## Heatmap {.tabset}

In the heatmap plots each GA combination and cost is presented by combining newt GA in the x-axis to snake GA and cost value in the y-axis. There are two types of heatmap plots shown below. One shows the average snake population size for a time chunk with darker colors indicating a smaller snake population and lighter colors indicating a larger snake population. The other heatmap shows the average difference between snake and newt mean phenotype (red=newts had a higher phenotype, blue=snakes had a higher phenotype). I fist look at early and then late simulation data.

### Cost: Population Size (Early)  
```{r, cost earlyplots Heatmap}
min_gen=0
max_gen=5000

build_heatmap(GA1_lit_cost_file, min_gen=min_gen, max_gen=max_gen, fill_line="Snake_pop_size", fill_line_text="Snake Population Size", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA", red_blue=F)

```

### Cost: Population Size (Late)  
```{r, cost plots Heatmap}
min_gen=25000
max_gen=30000

build_heatmap(GA1_lit_cost_file, min_gen=min_gen, max_gen=max_gen, fill_line="Snake_pop_size", fill_line_text="Snake Population Size", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA", red_blue=F)

```


### Cost: Phenotype (Early) 
```{r, cost earlyplots Heatmap pheno}

min_gen=0
max_gen=5000

build_heatmap(GA1_lit_cost_file, min_gen=min_gen, max_gen=max_gen, fill_line="dif", fill_line_text="Snake-Newt", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA",red_blue=T)
```

### Cost: Phenotype (Late) 
```{r, cost plots Heatmap pheno}

min_gen=25000
max_gen=30000

build_heatmap(GA1_lit_cost_file, min_gen=min_gen, max_gen=max_gen, fill_line="dif", fill_line_text="Snake-Newt", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA",red_blue=T)
```

## {-}

There is some cool population size and phenotype variation between different cost values within the same GA combination. The lowest cost value was always more neutral. As the cost value increased both the snake population size and mean phenotype diverged to either end. Sometimes it was not the highest cost values that resulted in the most dramatic out come. I saw more dramatic outcomes when the mutation variance was lower. My summary for this experiment is that increasing the cost value will only highlight the differences caused by the GA combinations. The ending results will remain the same, but may take longer to reach.




```{r, red in grid files}
require(readr)
GA1_grid_cost_file<- read.csv("~/Desktop/GA1_dif_cost/all_grid.txt" , header = TRUE) %>%  filter(between(generation, 9000, 10000))
GA1_grid_cost_file$group_rep <- paste0(GA1_grid_cost_file$snake_mu_rate, "_", GA1_grid_cost_file$snake_mu_effect_sd,"_",GA1_grid_cost_file$newt_mu_rate, "_", GA1_grid_cost_file$newt_mu_effect_sd, "_", GA1_grid_cost_file$rep)
GA1_grid_cost_file$group <- paste0(GA1_grid_cost_file$snake_mu_rate, "_", GA1_grid_cost_file$snake_mu_effect_sd,"_",GA1_grid_cost_file$newt_mu_rate, "_", GA1_grid_cost_file$newt_mu_effect_sd)
GA1_grid_cost_file$sim=LETTERS[factor(GA1_grid_cost_file$group)]
GA1_grid_cost_file$grid_num = 5



```


## Grid Figs {.tabset}

This last section looks at the local population phenotype for newts and snakes (circles and squares). I plot the results from generation 9981 for the GA combination 1e-10_0.5_1e-10_0.5_0. Color represents both toxicity and resistance. The sub plot is the phenotype for the newt by the phenotype for the snake, color indicates the location on the map (red=corner, green=edge, blue=middle).  

### 50
```{r, cor grid 2 high cor mean}

file=GA1_grid_cost_file
file_name="1e-10_0.5_1e-10_0.5_0"
spegen=9981
type="mean"
col_num=5
row_num=col_num*4
cost=50

grid_plot(file_name, spegen, file, type, row_num, col_num, cost)
```

### 100
```{r, cost 100 high cor mean}

file=GA1_grid_cost_file
file_name="1e-10_0.5_1e-10_0.5_0"
spegen=9981
type="mean"
col_num=5
row_num=col_num*4
cost=100

grid_plot(file_name, spegen, file, type, row_num, col_num, cost)
```


### 150
```{r, cost 150 high cor mean}

file=GA1_grid_cost_file
file_name="1e-10_0.5_1e-10_0.5_0"
spegen=9981
type="mean"
col_num=5
row_num=col_num*4
cost=150

grid_plot(file_name, spegen, file, type, row_num, col_num, cost)
```

### 200
```{r, cost 200 high cor mean}

file=GA1_grid_cost_file
file_name="1e-10_0.5_1e-10_0.5_0"
spegen=9981
type="mean"
col_num=5
row_num=col_num*4
cost=200

grid_plot(file_name, spegen, file, type, row_num, col_num, cost)
```

### 250
```{r, cost 250 high cor mean}

file=GA1_grid_cost_file
file_name="1e-10_0.5_1e-10_0.5_0"
spegen=9981
type="mean"
col_num=5
row_num=col_num*4
cost=250

grid_plot(file_name, spegen, file, type, row_num, col_num, cost)
```

## {-}


