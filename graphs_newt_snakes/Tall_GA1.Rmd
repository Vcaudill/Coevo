---
title: "Tall"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE,echo = FALSE) 

library(ggplot2)
library(viridis)
library(colorspace)
library(gridExtra)
library(tidyverse)
require(reshape2)
library(plyr)
library(gridGraphics)
library(grid)
library(knitr)
library(kableExtra)
library("reshape")
library(ggplot2)
library(ggpubr)
theme_set(theme_pubr())
library(stringr)
library(patchwork)
```

## Goal:

Think, explore, & write about what the co-evolutionary interaction between newts & snakes with different genetic architectures (GAs, combination of mutation rate & mutation effect size) can lead to. 

### Questions:

Can I find a certain GA or set of GAs that are similar to the correlation between real newts and snake phenotypes across different locations in space? I.E. is there spacial correlation between newt and snake phenotype? If so when/why? 

Why does mutational variance matter?

## Background

Evolution textbooks often highlight the interaction of toxic newts with resistant snakes as a model example of co-evolution. As newts become more toxic, snakes become more resistant, leading to their phenotypes being highly correlated across space. There are about 3-4 mutations discovered, that make a snakes resistant to toxin. One-two of these mutations have a large effect leading to high toxin resistance. However, these mutations break an ion-channel leading to a decrease in crawling speed (potentially making a snake more venerable to predators). This suggests that the genetic architecture (GA) for resistance within snakes has a low mutation rate with a large effect size. In newts, the mutations that allow them to be toxic (or at least resistant to their own toxin) have yet to be determined (2022). Thus we may ask, are there many or only a few mutations that lead to newt toxicity? Do these mutations have a large or small effect?  

## Experiment

I created a simulation study to observe the co-evolutionary outcome of the newt-snake interaction with different genetic architectures (GAs) in a spatial setting. I hypothesized that we would see an interaction (co-evolutionary arms race) between newt and snake phenotype under some GA combinations when newts and snakes were evolving over geographical space. Each GA is paired with another GA creating 16 combinations.

GA1 experiment values:

- 1e-8*(0.005)^2 = 2.5e-13
- 1e-9*(0.05)^2 = 2.5e-12
- 1e-10*(0.5)^2 = 2.5e-11
- 1e-11*(5.0)^2 = 2.5e-10

Landscape: 20 by 5 grid. A tall map!

Observations to make:

- How do phenotypes change over time?
- What are the phenotypes of newts and snakes spatially? And are they correlated? 
- Are newts and snakes interacting, in other words are there spatial locations overlapping?
- Is there a noticeable difference between the GA combinations?


### The data

I gather text file data from different files and have to do some table wrangling to get it into a format I can graph. I use information gathered from the entire population; data containing a mean value for the entire map (lit), correlation data based off of local populations that were divided into grids (cor) and data collected from grid based populations (grid). These simulations have a msprime (coalescent/burn in/random genetic variation) and then run for 50,000 generations in SLiM (co-evolution) (all with the same GA values). I ran four trials for each GA combination.

```{r, data gathering}

snewt <- read.csv("~/Desktop/snake_newt_real_data.csv", header = TRUE)

GA1_tall <- list.files(path="~/Desktop/tall_map", pattern="_lit_", full.names=TRUE, recursive=FALSE)
GA1_tall_cor_files <- list.files(path="~/Desktop/tall_map", pattern="_cor_", full.names=TRUE, recursive=FALSE)
grid_tall_files <- list.files(path="~/Desktop/tall_map", pattern="_grid_", full.names=TRUE, recursive=FALSE)


GA1_tall_tall_file<- data.frame()
GA1_cor_tall_file<- data.frame()
grid_tall_file<-data.frame()

oldstand=0
letter=0
newt_unique=0
newt_numb = 0
for(i in seq(1, length(GA1_tall), 1)){
  stand <- unlist(str_split(unlist(str_split(GA1_tall[i],"newt_mu_rate_"))[2], "_"))[1]
  up <- unlist(str_split(unlist(str_split(GA1_tall[i],"newt_mu_effect_sd_"))[2], "_"))[1]
  phrase = paste0(stand, "_", up)
  if (stand!=oldstand){
    oldstand=stand
    letter = letter + 1
  }

    if (phrase=="1.0e-08_0.05" ){
    newt_numb =  1
   }
    if (phrase=="1.0e-09_0.158114"){
    newt_numb =  2
   }
      if (phrase=="1.0e-10_0.5"){
    newt_numb =  3
   }
    if (phrase=="1.0e-11_1.58114"){
    newt_numb =  4
   }
  
      if (phrase=="1.0e-12_5.0"){
    newt_numb =  5
   }
  print(newt_numb)
  if (i<=length(GA1_tall)){

  stand <- unlist(str_split(unlist(str_split(GA1_tall[i],"newt_mu_rate_"))[2], "_"))[1]
  up <- unlist(str_split(unlist(str_split(GA1_tall[i],"newt_mu_effect_sd_"))[2], "_"))[1]
  phrase = paste0(stand, "_", up)

   if (phrase=="1.0e-08_0.005"){
    newt_numb =  1
   }
    if (phrase=="1.0e-09_0.05"){
    newt_numb =  2
   }
      if (phrase=="1.0e-10_0.5"){
    newt_numb =  3
   }
    if (phrase=="1.0e-11_5.0"){
    newt_numb =  4
   }
   
  GA1_temp_file <- read.csv(GA1_tall[i], header = TRUE)
  GA1_temp_file$sim <-LETTERS[letter]
  GA1_temp_file$size <-newt_numb
  GA1_temp_file$rep <-unlist(str_split(unlist(str_split(GA1_tall[i],"rep_"))[3], "_"))[1]
  GA1_temp_file$snake_mu_rate <- unlist(str_split(unlist(str_split(GA1_tall[i],"snake_mu_rate_"))[2], "_"))[1]
  GA1_temp_file$newt_mu_rate <- unlist(str_split(unlist(str_split(GA1_tall[i],"newt_mu_rate_"))[2], "_"))[1]
  GA1_temp_file$snake_mu_effect_sd <- unlist(str_split(unlist(str_split(GA1_tall[i],"snake_mu_effect_sd_"))[2], "_"))[1]
  GA1_temp_file$newt_mu_effect_sd <- unlist(str_split(unlist(str_split(GA1_tall[i],"newt_mu_effect_sd_"))[2], "_"))[1]
  GA1_tall_tall_file <- rbind(GA1_tall_tall_file, GA1_temp_file)
  
  cor_temp_file <- read.csv(GA1_tall_cor_files[i], header = TRUE)
  cor_temp_file$sim <-LETTERS[letter]
  cor_temp_file$size <-newt_numb
  cor_temp_file$rep <-unlist(str_split(unlist(str_split(GA1_tall_cor_files[i],"rep_"))[3], "_"))[1]
  cor_temp_file$snake_mu_rate <- unlist(str_split(unlist(str_split(GA1_tall_cor_files[i],"snake_mu_rate_"))[2], "_"))[1]
  cor_temp_file$newt_mu_rate <- unlist(str_split(unlist(str_split(GA1_tall_cor_files[i],"newt_mu_rate_"))[2], "_"))[1]
  cor_temp_file$snake_mu_effect_sd <- unlist(str_split(unlist(str_split(GA1_tall_cor_files[i],"snake_mu_effect_sd_"))[2], "_"))[1]
  cor_temp_file$newt_mu_effect_sd <- unlist(str_split(unlist(str_split(GA1_tall_cor_files[i],"newt_mu_effect_sd_"))[2], "_"))[1]
  GA1_cor_tall_file <- rbind(GA1_cor_tall_file, cor_temp_file)
  
  grid_temp_file <- read.csv(grid_tall_files[i], header = TRUE)
  grid_temp_file$sim <-LETTERS[letter]
  grid_temp_file$size <-newt_numb
  grid_temp_file$rep <-unlist(str_split(unlist(str_split(grid_tall_files[i],"rep_"))[3], "_"))[1]
  grid_temp_file$snake_mu_rate <- unlist(str_split(unlist(str_split(grid_tall_files[i],"snake_mu_rate_"))[2], "_"))[1]
  grid_temp_file$newt_mu_rate <- unlist(str_split(unlist(str_split(grid_tall_files[i],"newt_mu_rate_"))[2], "_"))[1]
  grid_temp_file$snake_mu_effect_sd <- unlist(str_split(unlist(str_split(grid_tall_files[i],"snake_mu_effect_sd_"))[2], "_"))[1]
  grid_temp_file$newt_mu_effect_sd <- unlist(str_split(unlist(str_split(grid_tall_files[i],"newt_mu_effect_sd_"))[2], "_"))[1]
  grid_tall_file <- rbind(grid_tall_file, grid_temp_file)
  

  }
  
}

GA1_tall_tall_file$dif <- GA1_tall_tall_file$Snake_mean_Pheno-GA1_tall_tall_file$Newt_mean_Pheno

GA1_tall_tall_file$group_rep <- paste0(GA1_tall_tall_file$snake_mu_rate, "_", GA1_tall_tall_file$snake_mu_effect_sd,"_",GA1_tall_tall_file$newt_mu_rate, "_", GA1_tall_tall_file$newt_mu_effect_sd, "_", GA1_tall_tall_file$rep)

GA1_tall_tall_file$group <- paste0(GA1_tall_tall_file$snake_mu_rate, "_", GA1_tall_tall_file$snake_mu_effect_sd,"_",GA1_tall_tall_file$newt_mu_rate, "_", GA1_tall_tall_file$newt_mu_effect_sd)

grid_tall_file$snake_newt_rep <- paste0("Snake_",grid_tall_file$snake_mu_rate, "_", grid_tall_file$snake_mu_effect_sd, "_Newt_",grid_tall_file$newt_mu_rate, "_", grid_tall_file$newt_mu_effect_sd, "_", grid_tall_file$rep)
```

```{r, cor box set up}

boxplot_cors_by_gen <- function(file, title, subt, x_label, y_label, min_gen, max_gen){
 snewt$mean_res = snewt$mean_toxin+snewt$dif
  real_snewt_cor = cor(snewt$mean_toxin, snewt$mean_res)
  file$newt_snake_rep <- paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd, "_", file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$rep)
  file$newt_snake <- paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd, "_", file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  unique(file$sim)
  plot <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen),]) +
  ylim(-1.1, 1.1)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen"))+
  xlab(x_label) + ylab(y_label)+
  geom_boxplot(aes(x=factor(rep), y=as.numeric(mean_newt_pheno_By_mean_snake_pheno), color = "CA"))+
  geom_hline(yintercept=real_snewt_cor, linetype="dashed")+
    geom_hline(yintercept=0, linetype="solid")+
  #geom_boxplot(aes(x=factor("CB"), y=as.numeric(num_newts_By_num_snakes), color = "CB"))+
  #geom_boxplot(aes(x=factor("CC"), y=as.numeric(sum_newt_pheno_By_num_snake), color = "CC"))+
  #geom_boxplot(aes(x=factor("CD"), y=as.numeric(sum_snake_pheno_By_num_newt), color = "CD"))+
  theme(plot.title = element_text(size=5)) +
  facet_wrap(~newt_snake)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank())


  return(plot)
}

hist_cors_by_gen_col_rep <- function(file, title, subt, x_label, y_label, min_gen, max_gen){
 snewt$mean_res = snewt$mean_toxin+snewt$dif
  real_snewt_cor = cor(snewt$mean_toxin, snewt$mean_res)
  file$newt_snake_rep <- paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd, "_", file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$rep)
  file$newt_snake <- paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd, "_", file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  unique(file$sim)
  plot <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen),]) +
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen"))+
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(x=as.numeric(mean_newt_pheno_By_mean_snake_pheno),fill=rep))+
  geom_vline(xintercept=real_snewt_cor, linetype="dashed")+
  geom_vline(xintercept=0, linetype="solid")+
  #geom_boxplot(aes(x=factor("CB"), y=as.numeric(num_newts_By_num_snakes), color = "CB"))+
  #geom_boxplot(aes(x=factor("CC"), y=as.numeric(sum_newt_pheno_By_num_snake), color = "CC"))+
  #geom_boxplot(aes(x=factor("CD"), y=as.numeric(sum_snake_pheno_By_num_newt), color = "CD"))+
  theme(plot.title = element_text(size=5)) +
  xlim(-1.1, 1.1)+
  facet_wrap(~newt_snake)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank())


  return(plot)
}

hist_cors_by_gen_col_rep_nofill <- function(file, title, subt, x_label, y_label, min_gen, max_gen){
 snewt$mean_res = snewt$mean_toxin+snewt$dif
  real_snewt_cor = cor(snewt$mean_toxin, snewt$mean_res)
  file$newt_snake_rep <- paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd, "_", file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$rep)
  file$newt_snake <- paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd, "_", file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  unique(file$sim)
  plot <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen),]) +
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen"))+
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(x=as.numeric(mean_newt_pheno_By_mean_snake_pheno)))+
  geom_vline(xintercept=real_snewt_cor, linetype="dashed")+
  geom_vline(xintercept=0, linetype="solid")+
  #geom_boxplot(aes(x=factor("CB"), y=as.numeric(num_newts_By_num_snakes), color = "CB"))+
  #geom_boxplot(aes(x=factor("CC"), y=as.numeric(sum_newt_pheno_By_num_snake), color = "CC"))+
  #geom_boxplot(aes(x=factor("CD"), y=as.numeric(sum_snake_pheno_By_num_newt), color = "CD"))+
  theme(plot.title = element_text(size=5)) +
  #stat_bin(bins=30)+
  facet_wrap(~newt_snake)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank())

suppressMessages(print(plot))

  return(plot)
}


var_cor <- function(file, cfile, title, subt, x_label, y_label, min_gen, max_gen){
  real_snewt_cor = cor(snewt$mean_toxin, snewt$mean_res)
  real_snewt_var = var(snewt$dif)
  cfile$newt_snake_rep <- paste0("Newt_", cfile$newt_mu_rate, "_", cfile$newt_mu_effect_sd, "_Snake_", cfile$snake_mu_rate, "_", cfile$snake_mu_effect_sd, "_", cfile$rep)
  var_cor_table=data.frame()

  
  for(i in 1:length(unique(file$newt_snake_rep))){
    pattern<-unique(file$newt_snake_rep)[i]
    temp_file<-file[which(file$gen>=min_gen & file$gen<=max_gen & file$newt_snake_rep==pattern),]
    temp_cor_file<-cfile[which(cfile$gen>=min_gen & cfile$gen<=max_gen & cfile$newt_snake_rep==pattern),]
    
    var_cor_table_temp<- data.frame("pattern"=pattern, "var"= var(temp_file$dif),"cor" = cor(temp_file$newt_toxin, temp_file$snake_res), "mean_corr" = mean(temp_cor_file$mean_newt_pheno_By_mean_snake_pheno))
    var_cor_table <- rbind(var_cor_table, var_cor_table_temp)
  }
 
  var_cor_table_temp<- data.frame("pattern"="real", "var"= real_snewt_var, "cor" = real_snewt_cor, "mean_corr" = real_snewt_cor)
  var_cor_table <- rbind(var_cor_table, var_cor_table_temp)
  
  plot <- ggplot(var_cor_table) +
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen"))+
  xlab(x_label) + ylab(y_label)+
  geom_point(aes(x=as.numeric(var), y=as.numeric(cor), color = pattern), shape=17, size=3)+
  geom_point(aes(x=as.numeric(var), y=as.numeric(mean_corr), color = pattern), size=3)+
  theme(plot.title = element_text(size=5)) +
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8))


  return(plot)
}



cor_trends_by_gen <- function(file, cfile, title, subt, x_label, x_label_cor, y_label, min_gen, max_gen, pattern){
 file$snake_newt_rep <- paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$newt_mu_rate, "_", file$newt_mu_effect_sd,"_", file$rep)
  cfile$snake_newt_rep <- paste0(cfile$newt_mu_rate, "_", cfile$newt_mu_effect_sd, "_", cfile$snake_mu_rate, "_", cfile$snake_mu_effect_sd, "_", cfile$rep)
  plot <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen & file$snake_newt_rep==pattern),]) +
    #geom_line(aes(generation, dif, group=rep, col="dif"))+
      ggtitle(title, subtitle = paste0(subt," pattern ", pattern, " From ", min_gen, " gen to ", max_gen, " gen"))+
    geom_line(aes(generation, Snake_mean_Pheno, group=rep, color="Snake_mean_Pheno"),)+
    geom_line(aes(generation, Newt_mean_Pheno, group=rep, color="Newt_mean_Pheno"))+
    #ylim(0,10)+
    #xlab(x_label) + ylab(y_label)+
    scale_color_manual(name = "Type",
values = c( "Snake_mean_Pheno" = "steelblue", "Newt_mean_Pheno" = "darkred"),
labels = c("Snake", "Newt"))+
    theme_bw() +theme(legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank(), axis.ticks.x = element_blank(), axis.text.x = element_blank(),
                      plot.margin=unit(c(1,1,+0.3,1), "cm"))
  
  cor_plot <- ggplot(cfile[which(cfile$gen>=min_gen & cfile$gen<=max_gen & cfile$snake_newt_rep==pattern),]) +
    geom_line(aes(generation, mean_newt_pheno_By_mean_snake_pheno, col="CA"))+
    #ggtitle(title, subtitle = subt) +
    ylim(-1.1, 1.1)+
    #xlab(x_label_cor) + ylab(y_label)+
    theme_bw() +theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank(),
                      plot.margin=unit(c(-0.5,1,1,1), "cm"))
  
  file<-file[which(file$gen>=min_gen & file$gen<=max_gen & file$snake_newt_rep==pattern),]
  cfile<-cfile[which(cfile$gen>=min_gen & cfile$gen<=max_gen & cfile$snake_newt_rep==pattern),]
  toDelete <- seq(0, nrow(cfile), 2)
  cfile_short <-  cfile[-toDelete, ]
  figure <- ggarrange(plot, cor_plot + font("x.text", size = 10),heights = c(2, 1.5),ncol = 1, nrow = 2, align = "v")
    print(paste0("pattern ", pattern))
  print(paste0("Cor between average snake pheno and local cor ", cor(file$Snake_mean_Pheno, cfile_short$mean_newt_pheno_By_mean_snake_pheno)))
  print(paste0("Cor between average newt pheno and local cor ", cor(file$Newt_mean_Pheno, cfile_short$mean_newt_pheno_By_mean_snake_pheno)))
  print(paste0("Cor between average dif pheno and local cor ", cor(file$dif, cfile_short$mean_newt_pheno_By_mean_snake_pheno)))
  print(paste0("Cor between newt pheno and snake ", cor(file$Newt_mean_Pheno, file$Snake_mean_Pheno)))
  return(figure)
}


four_types_boxplot_cors_by_gen <- function(file,title, subt, x_label, y_label, min_gen, max_gen){
  file$newt_snake <- paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd, "_", file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  plot <- ggplot(file[which(file$gen>=min_gen & file$gen<=max_gen),]) +
  ylim(-1.1, 1.1)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen"))+
  xlab(x_label) + ylab(y_label)+
  geom_boxplot(aes(x=factor("CA"), y=as.numeric(mean_newt_pheno_By_mean_snake_pheno), color = "CA"))+
  geom_boxplot(aes(x=factor("CB"), y=as.numeric(num_newts_By_num_snakes), color = "CB"))+
  geom_boxplot(aes(x=factor("CC"), y=as.numeric(sum_newt_pheno_By_num_snake), color = "CC"))+
  geom_boxplot(aes(x=factor("CD"), y=as.numeric(sum_snake_pheno_By_num_newt), color = "CD"))+
  geom_hline(yintercept=0, linetype="solid")+
  theme(plot.title = element_text(size=5)) +
  facet_wrap(~newt_snake)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank())


  return(plot)
}

```


```{r, general file and graph making}

#the functions to make the params file and the summary and heatmap figures 

create_parm_file <- function(file, min_gen, max_gen){
params <- data_frame()

for(i in 1:length(unique(file$newt_snake_rep))){

  pattern=unique(file$newt_snake_rep)[i]
  sumitup <- file[which(file$gen>=min_gen & file$gen<=max_gen & file$newt_snake_rep ==pattern),]
 
  params_temp<- data_frame(Newt_mean_Pheno=mean(sumitup$Newt_mean_Pheno),
                           Snake_mean_Pheno=mean(sumitup$Snake_mean_Pheno), 
                           Newt_mean_Pheno_sd=sd(sumitup$Newt_mean_Pheno),
                           Snake_mean_Pheno_sd=sd(sumitup$Snake_mean_Pheno),
                           Newt_pop_size=mean(sumitup$Newt_pop_size),
                           Snake_pop_size=mean(sumitup$Snake_pop_size),
                           dif=mean(sumitup$dif),
                           snake_mu_rate=sumitup$snake_mu_rate[1],
                           newt_mu_rate=sumitup$newt_mu_rate[1],
                           snake_mu_effect_sd=sumitup$snake_mu_effect_sd[1],
                           newt_mu_effect_sd=sumitup$newt_mu_effect_sd[1],
                           rep=sumitup$rep[1])
  
  
  params <- rbind(params, params_temp)
}

params$snake <- paste0(params$snake_mu_rate, "_",params$snake_mu_effect_sd)
params$newt <- paste0(params$newt_mu_rate, "_",params$newt_mu_effect_sd)
params$newt_snake <- paste0(params$newt, "_", params$snake)
return(params)
}

GA_summary <- function(file, min_gen, max_gen, x_line, y_line, title, subt, y_label, x_label){

file$newt_snake_rep <- paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd, "_", file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$rep)

params<-create_parm_file(file, min_gen, max_gen)

my_plot <- ggplot(params) +
  #xlim(0, 1000)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
  xlab(x_label) + ylab(y_label)+
  geom_point(aes(x=as.numeric(get(x_line)), y=as.numeric(get(y_line)), color = factor(snake), shape=factor(newt)),size=3)+
#  geom_point(aes(x=as.numeric(Newt_pop_size_20), y=as.numeric(Snake_pop_size_20), color = factor(snake), shape=factor(newt)))+
  theme(plot.title = element_text(size=5)) +
  #scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  #facet_wrap(~sim)+
  theme_bw() +  theme(axis.text.x = element_text( hjust=1, size = 8))

return(my_plot)
}

build_heatmap <- function(file, min_gen, max_gen, fill_line, fill_line_text, title, subt, y_label, x_label, red_blue=F){
  file$newt_snake_rep <- paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd, "_", file$snake_mu_rate, "_", file$snake_mu_effect_sd, "_", file$rep)
  
  params<-create_parm_file(file, min_gen, max_gen)
  
 my_plot <- ggplot(params, aes(newt, paste0(snake, "_", rep))) +    # Create heatmap with ggplot2
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
  xlab(x_label) + ylab(y_label)+
  geom_tile(aes(fill = get(fill_line)))+theme(axis.text.x = element_text(angle = 45, hjust=1, size = 10), axis.text.y = element_text(size = 10))
 
 if(red_blue==FALSE){
  my_plot<- my_plot + scale_fill_viridis_c(name = fill_line_text) + theme(legend.text=element_text(angle = 45, hjust=1, size=10))
  }
 if(red_blue==TRUE){
  my_plot<- my_plot + scale_fill_gradient2(low = "red",mid = "beige", high = "blue", name = fill_line_text) + theme(legend.text=element_text(size=5))
 }
 
  return(my_plot)
}

trends_by_gen <- function(file, title, subt, x_label, y_label, min_gen, max_gen){
 
  plot <- ggplot(file[ which(file$generation>=min_gen & file$generation<=max_gen),]) +
    facet_wrap(~sim)+
    geom_line(aes(generation, dif, group=rep, col="dif"))+
    ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
    geom_line(aes(generation, Snake_mean_Pheno, group=rep, color="Snake_mean_Pheno"),)+
    geom_line(aes(generation, Newt_mean_Pheno, group=rep, color="Newt_mean_Pheno"))+
    geom_hline(yintercept=0, linetype="dashed", color="gray54")+
    ylim(-10,10)+
    xlab(x_label) + ylab(y_label)+
    scale_color_manual(name = "Type",
values = c( "Snake_mean_Pheno" = "steelblue", "Newt_mean_Pheno" = "darkred", "dif" = "black"),
labels = c("Snake", "Newt", "Dif"))+
    theme_bw() + theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), legend.position="none",
                      strip.background = element_blank(), strip.text.x = element_blank(),
                      title =element_text(size=8, face='bold'), axis.title.x = element_blank(),
                      axis.title.y = element_blank())
  return(plot)
}

whale_gen <- function(file, title, subt, x_label, y_label,min_gen, max_gen, rep){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
dif <- ggplot(file[ which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep),]) +
  #xlim(0, 1000)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen, rep ",rep)) +
  xlab(x_label) + ylab(y_label)+
  geom_point(aes(x=as.numeric(Newt_pop_size), y=as.numeric(Snake_pop_size), color = dif))+
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      # strip.background = element_blank(), 
                      # strip.text.x = element_blank(), 
                      # panel.grid.major = element_blank(), 
                      # panel.grid.minor = element_blank(),
                      # panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}


pop_size_hist <- function(file, title, subt, x_label, y_label,min_gen, max_gen, rep){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  file<-file[ which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep),]
  themin <- min(file$Snake_pop_size-file$Newt_pop_size) 
  themax <- max(file$Snake_pop_size-file$Newt_pop_size)
  true_max <- max(abs(themin), abs(themax))
dif <- ggplot(file) +
  #xlim(0, 1000)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(Snake_pop_size-Newt_pop_size), fill="darkolivegreen4")+
  xlim((-1*themax)-5, themax+5)+
  theme(plot.title = element_text(size=5)) +
  facet_wrap(~sim)+
  geom_vline(xintercept = 0)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      # strip.background = element_blank(), 
                      # strip.text.x = element_blank(), 
                      # panel.grid.major = element_blank(), 
                      # panel.grid.minor = element_blank(),
                      # panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)
}

pheno_dif_hist <- function(file, title, subt, x_label, y_label,min_gen, max_gen, rep){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  file<-file[ which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep),]
  
  themin <- min(file$dif) 
  themax <- max(file$dif)
  true_max <- max(abs(themin), abs(themax))
dif <- ggplot(file) +
  #xlim(0, 1000)+
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen, rep ",rep)) +
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(dif), fill="aquamarine4")+
  xlim((-1*true_max)-1, true_max+1)+

  # y=as.numeric(Snake_pop_size-Newt_pop_size), color = snake_GA, shape = factor(newt_GA)
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  #scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  geom_vline(xintercept = 0)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      # strip.background = element_blank(), 
                      # strip.text.x = element_blank(), 
                      # panel.grid.major = element_blank(), 
                      # panel.grid.minor = element_blank(),
                      # panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}




two_hist <- function(file, title, subt, x_label, y_label,min_gen, max_gen, rep){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  
  file<-file[ which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep),]
  
  thepopmin <- min(file$Snake_pop_size-file$Newt_pop_size)/100 
  thepopmax <- max(file$Snake_pop_size-file$Newt_pop_size)/100
  thedifmin <- min(file$dif) 
  thedifmax <- max(file$dif)
  true_max <- max(abs(thepopmin), abs(thepopmax),abs(thedifmin), abs(thedifmax))

  data_points <- nrow(file[which(file$generation>=min_gen & file$generation<=max_gen & file$rep==rep &  file$snake_GA==file$snake_GA[1] &  file$newt_GA==file$newt_GA[1]),])
dif <- ggplot(file) +
  
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen, rep ",rep)) +
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(x=dif, y=..count../data_points), fill="#8B008B",  alpha = 0.65)+
  geom_histogram(aes(x=(Snake_pop_size-Newt_pop_size)/100, y=..count../data_points), fill="#008B00",  alpha = 0.65)+
  scale_y_continuous(labels = scales::percent)+
  xlim((-1*true_max)-1, true_max+1)+
  # y=as.numeric(Snake_pop_size-Newt_pop_size), color = snake_GA, shape = factor(newt_GA)
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  #scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  geom_vline(xintercept = 0)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      # strip.background = element_blank(), 
                      # strip.text.x = element_blank(), 
                      # panel.grid.major = element_blank(), 
                      # panel.grid.minor = element_blank(),
                      # panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}

two_hist_all_rep <- function(file, title, subt, x_label, y_label,min_gen, max_gen){
  #file$rep==rep
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  
  file<-file[ which(file$generation>=min_gen & file$generation<=max_gen),]
  
  thepopmin <- min(file$Snake_pop_size-file$Newt_pop_size)/100 
  thepopmax <- max(file$Snake_pop_size-file$Newt_pop_size)/100
  thedifmin <- min(file$dif) 
  thedifmax <- max(file$dif)
  true_max <- max(abs(thepopmin), abs(thepopmax),abs(thedifmin), abs(thedifmax))

  data_points <- nrow(file[which(file$generation>=min_gen & file$generation<=max_gen  &  file$snake_GA==file$snake_GA[1] &  file$newt_GA==file$newt_GA[1]),])
  
dif <- ggplot(file) +
  
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(x=dif, y=..count../data_points), fill="#8B008B",  alpha = 0.65, bins = 20)+ #purple
  geom_histogram(aes(x=(Snake_pop_size-Newt_pop_size)/100, y=..count../data_points), fill="#008B00",  alpha = 0.65, bins = 20)+ #green
  scale_y_continuous(labels = scales::percent)+
  xlim((-1*true_max)-1, true_max+1)+
  # y=as.numeric(Snake_pop_size-Newt_pop_size), color = snake_GA, shape = factor(newt_GA)
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  #scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  geom_vline(xintercept = 0)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      #strip.background = element_blank(), 
                      strip.text.x = element_blank(), 
                      #panel.grid.major = element_blank(), 
                      #panel.grid.minor = element_blank(),
                      #panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}

two_hist_death_all_rep <- function(file, title, subt, x_label, y_label,min_gen, max_gen){
  #file=GA1_tall_tall_file
  file$snake_GA<-paste0(file$snake_mu_rate, "_", file$snake_mu_effect_sd)
  file$newt_GA<-paste0(file$newt_mu_rate, "_", file$newt_mu_effect_sd)
  
  file<-file[ which(file$generation>=min_gen & file$generation<=max_gen),]
  
  thepopmin <- min(file$newt_deaths)
  thepopmax <- max(file$newt_deaths)
  thedifmin <- min(file$snake_deaths) 
  thedifmax <- max(file$snake_deaths)
  true_max <- max(abs(thepopmin), abs(thepopmax),abs(thedifmin), abs(thedifmax))

  data_points <- nrow(file[which(file$generation>=min_gen & file$generation<=max_gen  &  file$snake_GA==file$snake_GA[1] &  file$newt_GA==file$newt_GA[1]),])
  
dif <- ggplot(file) +
  
  ggtitle(title, subtitle = paste0(subt, " From ", min_gen, " gen to ", max_gen, " gen")) +
  xlab(x_label) + ylab(y_label)+
  geom_histogram(aes(x=newt_deaths), fill="red",  alpha = 0.65, bins = 20)+
  geom_histogram(aes(x=snake_deaths), fill="blue",  alpha = 0.65, bins = 20)+
  #scale_y_continuous(labels = scales::percent)+
  #xlim((-1*true_max)-1, true_max+1)+
  # y=as.numeric(Snake_pop_size-Newt_pop_size), color = snake_GA, shape = factor(newt_GA)
  #paste0(snake_mu_rate, "_", snake_mu_effect_sd), shape = paste0(newt_mu_rate, "_", newt_mu_effect_sd), group=T)
  theme(plot.title = element_text(size=5)) +
  #scale_colour_gradient2(high = "steelblue", mid = "beige", low = "darkred")+
  #labs(colour = color_label) +
  facet_wrap(~sim)+
  #geom_vline(xintercept = 0)+
  theme_bw() +  theme(axis.text.x = element_text(angle = 45, hjust=1, size = 8), 
                      #strip.background = element_blank(), 
                      strip.text.x = element_blank(), 
                      #panel.grid.major = element_blank(), 
                      #panel.grid.minor = element_blank(),
                      #panel.background = element_blank(), 
                      axis.line = element_line(colour = "black"))

return(dif)

}

#two_hist_death_all_rep(GA1_tall_tall_file, title="Snake-Newt Winning Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Phenotype (purple) & Snake-Newt Popsize/100 (green)",  min_gen=20000, max_gen=25000)

```


## Mean Phenotype Whole Simulation

First, I will look at a plot of how the mean phenotype of the entire population of newts and snakes changes overtime. Each of these plots has three colored lines, red for the mean newt phenotype, blue for the mean snake phenotype, and black for the difference between mean snake and mean newt phenotype. There are 4 line per color that represent the different replicas that I ran. **Note this is a mean for the entire population.** Mutational variance increases for the snakes as you go down the figure (top to bottom) and increases for the newts as you go across (left to right).



```{r, graphing by gen}
trends_by_gen(GA1_tall_tall_file, title="Space Tall: Newt VS Snake Population Size GA1", subt="Gen 16sims", y_label="Mean Phenotype", x_label="Generations", 100, 50000)


aggregate(GA1_tall_tall_file[which(GA1_tall_tall_file$generation>=100 & GA1_tall_tall_file$generation<=50000),]$dif, list(GA1_tall_tall_file[which(GA1_tall_tall_file$generation>=100 & GA1_tall_tall_file$generation<=50000),]$group), FUN=mean) 

aggregate(GA1_tall_tall_file[which(GA1_tall_tall_file$generation>=100 & GA1_tall_tall_file$generation<=50000),]$dif, list(GA1_tall_tall_file[which(GA1_tall_tall_file$generation>=100 & GA1_tall_tall_file$generation<=50000),]$group_rep), FUN=mean) 

```


The first thing that I noticed is that newt mean phenotype and snake mean phenotype seem to follow each other. I wonder if they are both drifting up? The second thing I noticed is that this figure is not symmetrical. The mean difference between snake and newt phenotype is not equal between the two species when their GAs are flipped. In the first row, as mutation variance goes up for the newts and stays for constant for the snakes the average difference is 0.03, 2.8, 2.7, 0.09 (first row left to right). When the mutation variance goes up for the snakes and stays the same for the newts (first column) the  average difference is 0.03, 2.0, 2.2, 0.03 (first row left to right). This indicates that there might be different selection pressure for newts and snakes, which is similar describes other works that discuss predator-prey interactions. 


Snakes had a higher phenotype when newts had a low mutation variance. Even when snakes had a higher mutational variance, newts still had a higher phenotype on average (the entire length of the simulation). I had predicted that a higher mutational variance would lead to a higher mean phenotype, but that seems not to be the case. Now there are some caveats to this observation; 1) these observations change over time, like pre 10,000 generations things look a lot different and different conclusions can be made (discussed lower). 2) There is a cost to having a high phenotype. In the last row & column mutations that arise might have too high of a phenotype and die out quickly (making the cost higher might change some of the results/ it would be cool to see if the top right difference between newt and snake mean phenotype grows with a more relaxed cost). This observation is interesting to me for two reasons a) in the real newt-snake example snakes always seem to have a higher phenotype and b) snakes seem to have more of a genetic architecture with a few mutations of high effect size. There are some other real factors that I think about like the difference between life history factors of newts and snake (reproduction 1-2 years vs 5-6 years or the ability to move around).


### Mean Phenotype Beggining Simulation

I like to focus on the beginning of the simulation when newts and snakes are first starting to co-evolve right before some of the slopes start to flat line (~15,000 generations).



```{r, graphing by gen trends}
trends_by_gen(GA1_tall_tall_file, title="Space Tall: Newt VS Snake Population Size GA1", subt="Gen 16sims", y_label="Mean Phenotype", x_label="Generations", 100, 15000)


aggregate(GA1_tall_tall_file[which(GA1_tall_tall_file$generation>=100 & GA1_tall_tall_file$generation<=15000),]$dif, list(GA1_tall_tall_file[which(GA1_tall_tall_file$generation>=100 & GA1_tall_tall_file$generation<=15000),]$group), FUN=mean) 

aggregate(GA1_tall_tall_file[which(GA1_tall_tall_file$generation>=100 & GA1_tall_tall_file$generation<=15000),]$dif, list(GA1_tall_tall_file[which(GA1_tall_tall_file$generation>=100 & GA1_tall_tall_file$generation<=15000),]$group_rep), FUN=mean) 

```

After looking at this section of the data, newts have a higher phenotype on average. Snakes often only have a higher phenotype when the GA of newts has low mutational variance. Is there a way to measure the mutational variance within my species? This would help determine if the cost function was limiting the number of fixing mutations in the GA with the highest mutational variance. Another thing I would like to note, is that when the GA of newts and snakes are the same newts usually end up with a higher phenotype. The case of the 3rd GA for snakes and the 4th GA for newts is extremely weird (is it the only instance where snakes end up with a higher phenotype that is consistently higher through out the simulation and not in the first column).

#### Connection between higher phenotype and population

The next few figures in this write up depict the connection between higher phenotype and higher population size. I predicted that the species with a higher phenotype would have a larger population size. My thought process was that if newts were really toxic and snakes tried to eat them, lots of snakes would die. And if snakes were really resistant lots of newts would get eaten. But how would this work in real life? I.E. Population sizes might not depend on resistance & toxicity.

```{r, whale}
min_gen=5000
max_gen=10000
rep=0

whale_gen(GA1_tall_tall_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake-Newt Popsize", x_label="Snake-Newt Phenotype", min_gen=min_gen, max_gen=max_gen, rep=rep )

#pop_size_hist(GA1_tall_tall_file, title="Snake-Newt Popsize Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Popsize",  min_gen=min_gen, max_gen=max_gen, rep=rep )

#pheno_dif_hist(GA1_tall_tall_file, title="Snake-Newt Phenotype Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Phenotype",  min_gen=min_gen, max_gen=max_gen, rep=rep )

suppressMessages(print(two_hist(GA1_tall_tall_file, title="Snake-Newt Winning Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Popsize/100 (green) & Snake-Newt Phenotype (purple)",  min_gen=min_gen, max_gen=max_gen, rep=rep )))

suppressMessages(print(two_hist_all_rep(GA1_tall_tall_file, title="Snake-Newt Winning Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Popsize/100 (green) & Snake-Newt Phenotype (purple)",  min_gen=min_gen, max_gen=max_gen)))


```

I looked at the results between 5,000 - 10,000 generations where I saw most of the increase in newt and snake phenotype. The first plot has newt population size by snake population size with the color representing the difference between snake and newt mean phenotype (red=newts have a higher mean phenotype, blue=snakes have a higher mean phenotype). The third GA (an intermediate one) seems to do better then all of the other GAs (blue row (3), red column (3)). However, this is dependent on the point in the simulation you focus on. The next two plots show the difference between snake and newt population size (green) and phenotype (purple). For the most part these suggest that when the mean phenotype is higher so is the population size. This also shows the asymmetrical nature between the predator-prey interaction (higher max population sizes seen in snakes). The population size is also more variable than the phenotype (difference in population size has a wider range).

## Correlation

The next section I aim to look at how correlated newt and snakes are at local populations across the geographical area. I am examining correlation between newt and snake phenotypes, population sizes of newts and snakes, amount of toxin and snake population, and the amount of resistance and newt population size. I predicted that there would be a positive correlation between the phenotypes, and a negative correlation between population sizes, and the amount of toxin/resistance and population size. Below is a legend for the first two plots. The third plot is colored by trial.

Legend:

- "CA" = mean_newt_pheno_By_mean_snake_pheno (Pink)
- "CB" = num_newts_By_num_snakes (Green)
- "CC" = sum_newt_pheno_By_num_snake (Blue)
- "CD" = sum_snake_pheno_By_num_newt (Purple)


I first look at the correlation between mean newt phenotype and mean snake phenotype for each of the four trials in every GA combination from 10,000-15,000 generations. The solid line is a 0 with a dashed line at the level of correlation seen in natural newt-snake population(s). The second figure shows the the results of all 4 trials for each correlation measurement I made from 10,000-15,000 generations. The third plot takes the information from the fist plot and shows the distribution of correlation values by each trial (solid line at 0, dashed line at real newt-snake correlation).

```{r, combo myplots}
#files
#GA1_tall_tall_file
#GA2_long_file 
#GA1_cor_tall_file
#GA2_cor_file

ginmin = 10000
ginmax = 15000

boxplot_cors_by_gen(GA1_cor_tall_file, "Simulation Correlation Comparied to Real Correlation Trials", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)


four_types_boxplot_cors_by_gen(GA1_cor_tall_file, "Simulation four Correlation", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)



suppressMessages(print(hist_cors_by_gen_col_rep(GA1_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))



#hist_cors_by_gen_col_rep_nofill(GA1_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)

```

The first thing that I noticed in the first figure, was that most of the correlation values were not as positive as the real newt-snake correlation. This could change depending on which generation window we look through (see figure set below). I also wonder if correlation occurs more when one of the species has a higher phenotype (like newt phenotype drive snake phenotype, but snake phenotype does not drive newt phenotype).

When looking a figure 2 it seems like most values are no different from 0. This troubles me, but I have some thoughts. 1) These simulations are very stochastic and having high and low values averaged together might be 0. 2) Results might be 0. 3) Results are not 0 but close. 4) It might depend on generation window. 5) What is happening in my simulation leading to correlation/no correlation (maybe not getting good local measurements)? I wonder if we only used some of the grids (like the corners) if the correlation values would change. 

The most informative figure to me in this set was the third one. The color represents the simulation trial, and it really displays the stochastic nature of my simulation. I think there are distinct differences between the GA combinations, but its hard to make a solid description between them. 

I decided to look at the trial correlation distributions for different windows of time for all 16 GA combinations. Each of these figures are over a 5,000 generation window. They start at the beginning of the simulation a move through the conclusion of my simulation. There are four independent (msprime/slim) trials for each GA combination.


```{r, ga1 cor by dif windows}

ginmin = 0
ginmax = 5000
suppressMessages(print(hist_cors_by_gen_col_rep(GA1_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))

ginmin = 5000
ginmax = 10000
suppressMessages(print(hist_cors_by_gen_col_rep(GA1_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))

ginmin = 10000
ginmax = 15000
suppressMessages(print(hist_cors_by_gen_col_rep(GA1_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))

ginmin = 15000
ginmax = 20000
suppressMessages(print(hist_cors_by_gen_col_rep(GA1_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))

ginmin = 20000
ginmax = 25000
suppressMessages(print(hist_cors_by_gen_col_rep(GA1_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))

ginmin = 25000
ginmax = 30000
suppressMessages(print(hist_cors_by_gen_col_rep(GA1_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))

ginmin = 30000
ginmax = 35000
suppressMessages(print(hist_cors_by_gen_col_rep(GA1_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))

ginmin = 35000
ginmax = 40000
suppressMessages(print(hist_cors_by_gen_col_rep(GA1_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))

ginmin = 40000
ginmax = 45000
suppressMessages(print(hist_cors_by_gen_col_rep(GA1_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))

ginmin = 45000
ginmax = 50000
suppressMessages(print(hist_cors_by_gen_col_rep(GA1_cor_tall_file, "Simulation Correlation Comparied to Real Correlation", "GA1", "newt/snake GAs&rep", "Cor", ginmin, ginmax)))

```


Flipping through the 10 figures is like looking through a cartoon flip book. Things seem to be moving like waves in different directions (more positive or negative?). The only GA simulation that matches the real newt-snake data is the first one (high mutation rate-low effect size). These simulations reach an area of high correlation, is it because the change in phenotype occurs rapidly in small effects? I wondered if given more time or more space if any other of the GA combination would become more correlated? How are the mean phenotypes for the entire population getting higher without there being correlation at the local level? What do the local population distribution of newts and snakes look like (is there some avoidance or weird density effect)? How are NAs (not enough individuals in a certain area) changing this measurement? Is there a difference in the local correlation when a certain species is driving convolution?  

## Correlation across time

In this section I plot the mean phenotype of newts, the mean phenotype of snakes, and there local correlation values across 50,000 generations. There are 4 trials for each GA combination. I also print out some correlation values; 1) whole population mean snake phenotype and local correlation, 2) whole population mean newt phenotype and local correlation, 3) difference between mean snake and mean newt phenotype and local correlation, and 4) correlation between mean snake and newt phenotype. My thoughts on looking at these correlations were that it might be possible that the local correlations might be more correlated to one of the species. 



```{r, ga1 cor and pheno}
GA1_pattern <- unique(paste0(GA1_tall_tall_file$snake_mu_rate, "_", GA1_tall_tall_file$snake_mu_effect_sd,"_",GA1_tall_tall_file$newt_mu_rate, "_", GA1_tall_tall_file$newt_mu_effect_sd, "_", GA1_tall_tall_file$rep))
for(i in 1:length(GA1_pattern)){
  myine<-cor_trends_by_gen(GA1_tall_tall_file, GA1_cor_tall_file, "test", "GA1", "newt/snake GAs&rep","other", "Cor", min_gen=100, max_gen=50000, pattern=GA1_pattern[i])
  plot(myine)
}

```


The results from all of the correlations and mean phenotypes are very messy! The correlation values range from 0.99 to -0.62, but lets take a deeper look into the correlation values based on GA combination. (must be careful when thinking about the correlation sign with difference)

Results by Pattern:

* 1.0e-08_0.005_1.0e-08_0.005 
  + Newt and snake mean phenotype is positively correlated (68-91)
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype)
  + Mean phenotype tend to go up, when crossing the local correlation goes down
* 1.0e-08_0.005_1.0e-09_0.05 
  + Newt and snake mean phenotype is correlated (72-88)
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype)
  + Snake mean phenotype mostly flat
* 1.0e-08_0.005_1.0e-10_0.5 
  + Newt and snake mean phenotype is a bit less positively correlated (49-62)
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype)
  + Snake mean phenotype mostly flat
* 1.0e-08_0.005_1.0e-11_5.0 
  + Newt and snake mean phenotype is positively correlated in 3 trials (80-83)
  + Newt and snake mean phenotype is negatively correlated in one trial where newt mean phenotype is 0 (-0.44)
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype)
  + Snake mean phenotype mostly flat, newt mean phenotype has been able to exceed snake mean phenotype
* 1.0e-09_0.05_1.0e-08_0.005 
  + Newt and snake mean phenotype is positively correlated (69-93)
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype)
  + Possibly random, but the correlation between snake & local and difference & local were nearly identical for all four trials.
  + Newt mean phenotype mostly flat, snake mean phenotype can start lower and exceed newt mean phenotype
* 1.0e-09_0.05_1.0e-09_0.05 
  + Newt and snake mean phenotype is positively correlated (90-99)
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype)
  + Mean phenotype tend to go up and cross together a lot
* 1.0e-09_0.05_1.0e-10_0.5 
  + Newt and snake mean phenotype is positively correlated (80-96)
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype)
  + Mean phenotype tend to go up together. Newt mean phenotype has larger jumps than snake mean phenotype. 
  + Sometimes it takes time for the snake mean phenotype to catch up to the newt mean phenotype
* 1.0e-09_0.05_1.0e-11_5.0 
  + Newt and snake mean phenotype is positively correlated (89-95)
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype)
  + Mean phenotype tend to go up together. Newt mean phenotype has larger jumps than snake mean phenotype. 
* 1.0e-10_0.5_1.0e-08_0.005 
  + Newt and snake mean phenotype is less positively correlated (42-60)
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype)
  + Newt mean phenotype mostly flat, but slowly rises overtime (does not catch up) 
* 1.0e-10_0.5_1.0e-09_0.05 
  + Newt and snake mean phenotype is positively correlated (67-89)
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype)
  + These mean phenotypes are strange. The snake mean phenotype has larger jumps. Newt and snake mean phenotypes closely match
* 1.0e-10_0.5_1.0e-10_0.5 
  + Newt and snake mean phenotype is positively correlated (61-91)
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype) (all of them are close to 0)
  + Snake and newt mean phenotype closely match, newt mean phenotype is larger than snake mean phenotype
* 1.0e-10_0.5_1.0e-11_5.0 
  + Newt and snake mean phenotype is positively correlated (79-91)
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype) (all of them are close to 0)
  + snake and newt mean phenotypes closely match and intersect a lot.
* 1.0e-11_5.0_1.0e-08_0.005 
  + Newt and snake mean phenotype is positively correlated in 2 trials (40, 57)
  + Newt and snake mean phenotype is negatively correlated in 2 trials (-19, -48) 
  + lots of red and blue flat lines
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype)
  + Possibly random, but the correlation between snake & local and difference & local were nearly identical for all trials where newt mean phenotype flat-lined.
  + newt mean phenotype remain small. The mean phenotypes do not intersect
* 1.0e-11_5.0_1.0e-09_0.05 
  + Newt and snake mean phenotype is positively correlated (84-95)
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype)
  + The correlation between the difference and local correlation values was slightly negative (3 trials)
  + Snake mean phenotype has larger jumps, but the newt mean phenotype has a higher level of toxicity
* 1.0e-11_5.0_1.0e-10_0.5 
  + Newt and snake mean phenotype is positively correlated (43-83)
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype)
  + The correlation between the difference and local correlation values was slightly negative (4 trials)
  + Snake and newt mean phenotype go up together and intersect
* 1.0e-11_5.0_1.0e-11_5.0 
  + Newt and snake mean phenotype is positively correlated in 3 trials (39-80)
  + Newt and snake mean phenotype is negatively correlated in 1 trial (-4) 
  + Local phenotype correlation is not consistently correlated to snake mean phenotype, newt mean phenotype, or the difference (snake-newt mean phenotype)
  + Newt mean phenotype is bigger than snake mean phenotype, even though they have the same GA

## What happens over time (looking at the beginning. middle, and late part of my simulations)

I have noticed that my results change during different stages of my simulation. In the beginning of the simulation (100-5,000 generations), newt and snake mean phenotypes seem to start interacting by slowly getting larger. In the middle of my simulation (10,000-15,000 generations), newt and snake mean phenotypes are getting larger at an increased rate. In the late part of my simulation (45,000-50,000 generations), newt and snake mean phenotypes are more stable (phenotypes are no longer dramatically increasing).

First, I look at the beginning of my simulations. I look at how newt/snake mean phenotypes and population sizes interact. I look at a pair of plots for each trial to observe their similarities and differences. First we compare newt population size to snake population size, with individual points' color representing the difference between snake and newt mean phenotype (red=more toxic blue=more resistant). The entire plot is composed of a 5,000 generation span, with each data point being from one generation. The second plot in the pair is a histogram of the differences between snake and newt phenotype and population size (green=phenotype dif, purple=population size dif). In the differences histogram points on the right of the 0 (black line) indicate snakes have a higher value, while points on the left of the line indicate newts have a higher value.

```{r, early plots}


min_gen=100
max_gen=5000


for(i in 1:length(unique(GA1_tall_tall_file$rep))){
  myine<-whale_gen(GA1_tall_tall_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_tall_tall_file$rep)[i])
  plot(myine)
  myine<-two_hist(GA1_tall_tall_file, title="Snake-Newt Winning Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Phenotype (purple) & Snake-Newt Popsize/100 (green)",  min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_tall_tall_file$rep)[i] )
  suppressMessages(plot(myine))
}

```

At the beginning of the simulations newt and snake population size is the same. Newt and snake phenotypes at the beginning of the simulation are a result of their set GAs (from msprime). Overtime and through their co-evolution the population sizes and phenotypes of newts and snakes vary based on the GA combination. I ask what are the similarities/differences between the trials and what how do the GA combinations differ from each other?

In the scatter plots I noticed two shapes that form, a hill which typically is red (newts have higher phenotype) and a boomerang which is typically blue (snakes have a higher phenotype). I also noticed that not very many of the GA combinations flip between the two colors. There are noticeable differences between the GA combinations, the evolution in each of them is not identical. However, these changes differ across the trials (simulation is very stochastic). 

The histogram plots mirror what I observed in the scatter plots. Each GA combination plot looks very similar to each other. Between the different GA and trials it seems that snakes are likely to have a larger population size. In the beginning of the simulations the difference between newt ans snake phenotype is very close to 0.


#### Summary

Next, I will look at some summary plots. These plots display newt population size by snake population size and the difference between mean snake and newt phenotype by snake population size. Each color of the points is the GA of snakes and each shape of the points is the GA of newts. There are 4 of the same shape/color combination for each of the trials. My goal is to observe is there are clusters of shapes/colors.  

```{r, early plots summary}

min_gen=100
max_gen=5000

# summary
GA_summary(GA1_tall_tall_file, min_gen=min_gen, max_gen=max_gen, x_line="Newt_pop_size", y_line="Snake_pop_size", title="Space: Newt VS Snake Population Size", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize")

GA_summary(GA1_tall_tall_file, min_gen=min_gen, max_gen=max_gen, x_line="dif", y_line="Snake_pop_size", title="Space: Dif VS Snake Population Size", subt="Gen 16sims", y_label="Snake Popsize", x_label="Dif")
```

After a quick glance there does seem to be some grouping occurring. A lot of blue and green points seem to be higher in the line (snakes have a higher population size & phenotype). This indicates that the intermediate snake GAs do well in the early stages of a co-evolutionary arms race. There is also a group of + signs that are also located at the top of the line, suggesting that newt GA 4 does worse in an arms race. We can see a similar effect when snake GA is GA #4, purple points cluster at the bottom of the line. A group of squares cluster towards the bottom of the line, indicating that newts with the third GA have a higher population size and phenotype during the early part of the simulation. It is strange that triangles do not do the same thing?? <- could this be something that might be occurring to a difference in selection pressure?

#### Heatmap

In this section I look at a simulation summary presented as a heatmap. This heatmap averages the snake population size or snake-newt mean phenotype over a selected range of generations. This heat map gives a simplified picture of what is occurring over a 5,000 generation portion of my simulation for both the GA combinations and trials. The goal is to see patterns that are similar between the trials and different between the GA combinations. 

```{r, early plots Heatmap}

min_gen=100
max_gen=5000
#heatmap
build_heatmap(GA1_tall_tall_file, min_gen=min_gen, max_gen=max_gen, fill_line="Snake_pop_size", fill_line_text="Snake Population Size", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA", red_blue=F)

build_heatmap(GA1_tall_tall_file, min_gen=min_gen, max_gen=max_gen, fill_line="dif", fill_line_text="Snake-Newt", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA",red_blue=T)

```

Surprisingly, even towards (at lease what I consider near) the beginning of the simulation we can see some pattern emerging. Specifically, I can see that the third column has fewer snakes (purple) and a higher newt phenotype (red) than the rest of the simulations. The snake GA set of 1.0e-10/0.5 has a higher population size of snakes and leans to a higher snake phenotype. Something is a bit off for the snake GA set of 1.0e-9/0.05, there are some areas of a higher population size, but the newts have a slightly larger phenotype. Sometimes the newt population size is higher, but the snakes have a larger phenotype.

### Mid-simulation

```{r, mis plots}

min_gen=10000
max_gen=15000
rep=0

for(i in 1:length(unique(GA1_tall_tall_file$rep))){
  myine<-whale_gen(GA1_tall_tall_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_tall_tall_file$rep)[i])
  plot(myine)
  myine<-two_hist(GA1_tall_tall_file, title="Snake-Newt Winning Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Phenotype (purple) & Snake-Newt Popsize/100 (green)",  min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_tall_tall_file$rep)[i] )
suppressMessages(plot(myine))
}

```


As newts and snakes co-evolution their population sizes and phenotypes should be a result of their genetic architecture. In this time frame the newts seem to have a higher phenotype in their middle genetic architecture (#2, #3 column). It is not perfectly identical across the trials, but more often than not, newts with GA #2, #3 are winning in a co-evolutionary arms race. If newts have only a slightly higher phenotype they do not have a larger population size. 

The scatter plots all have a smear shape that is either in a linear or flat line. None of GA combinations have a large range in phenotypes or population sizes, and very few show the change from one species having a higher phenotype to another.

The histogram plots mirror what I observed in the scatter plots. The difference between snake and newt phenotype doesn't change all that much, but population size does. A surprising observation is that just a little bit more resistance leads to a higher population size in snakes than a little bit of toxicity does in newts.

#### Summary

```{r, mid plots summary}

min_gen=10000
max_gen=15000

# summary
GA_summary(GA1_tall_tall_file, min_gen=min_gen, max_gen=max_gen, x_line="Newt_pop_size", y_line="Snake_pop_size", title="Space: Newt VS Snake Population Size", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize")

GA_summary(GA1_tall_tall_file, min_gen=min_gen, max_gen=max_gen, x_line="dif", y_line="Snake_pop_size", title="Space: Dif VS Snake Population Size", subt="Gen 16sims", y_label="Snake Popsize", x_label="Dif")
```

It's weird that it looks like there are two lines? One line with snake GA of #2 and #3 (blue and green) and another with snake GA of #1 and #4 (pink and purple). I noticed that newt GA #2 and #3 (squares and triangles) tended to be in the lower part of the line (newts more successful). There are a lot of blue and green circles toward the top of the plots indicating newt GA #1 does worse when snake GA is #2 or #3. There are a lot of blue, pink, and green + toward the top of the plots, which suggests that newt GA #4 does worse when snake GA is #1, #2 or #3.

#### Heatmap

```{r, mid plots Heatmap}

min_gen=10000
max_gen=15000
#heatmap
build_heatmap(GA1_tall_tall_file, min_gen=min_gen, max_gen=max_gen, fill_line="Snake_pop_size", fill_line_text="Snake Population Size", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA", red_blue=F)

build_heatmap(GA1_tall_tall_file, min_gen=min_gen, max_gen=max_gen, fill_line="dif", fill_line_text="Snake-Newt", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA",red_blue=T)

```


Both of these heatmaps show major similarities between the trials. When newts have a GA of #2 and #3 the newt phenotype and population size is larger. When the newt GA is #3 there is an even larger newt advantage. When the newts have a GA of #1 or #4 snakes have a larger population size and phenotype. This result hold regardless of the snakes GA. Although, snakes with GA #3 have a large advantage over newts with GA #1 or #4.

### Late simulation

```{r, late plots}

min_gen=45000
max_gen=50000


for(i in 1:length(unique(GA1_tall_tall_file$rep))){
  myine<-whale_gen(GA1_tall_tall_file, title="Space: Newt VS Snake Population Size Color=S-N Phenotype", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize", min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_tall_tall_file$rep)[i])
  plot(myine)
  myine<-two_hist(GA1_tall_tall_file, title="Snake-Newt Winning Hist", subt="Gen 16sims", y_label="Count", x_label="Snake-Newt Phenotype (purple) & Snake-Newt Popsize/100 (green)",  min_gen=min_gen, max_gen=max_gen, rep=unique(GA1_tall_tall_file$rep)[i] )
  suppressMessages(plot(myine))
}




```
In the later stages of my simulation things have been running for a while and hopefully populations will be in equilibrium. Space makes getting to an equilibrium state difficult to define. Hypothetically, there could be areas that are co-evolving and areas that are not, an individuals can move between different areas, leading to a steady sate that cycles. When looking at the scatter plots I noticed that there was only one row and one column that had consistently had one species with higher population sizes and phenotypes. The species that had the first GA would typically be losing in a co-evolutionary arms race. The species that ended up with the lowest mutation variance ended up being left behind. When both species had GA #1 the phenotype was neutral while snakes had a larger population size. Most of the scatter plots have slight blue and red dotes, with the histograms having small phenotype differences, and larger snake population size. Snakes having a GA of #4 also still had them at a disadvantage (newts had a larger phenotype and population size). 

#### Summary

```{r, late plots summary}

min_gen=45000
max_gen=50000

# summary
GA_summary(GA1_tall_tall_file, min_gen=min_gen, max_gen=max_gen, x_line="Newt_pop_size", y_line="Snake_pop_size", title="Space: Newt VS Snake Population Size", subt="Gen 16sims", y_label="Snake Popsize", x_label="Newt Popsize")

GA_summary(GA1_tall_tall_file, min_gen=min_gen, max_gen=max_gen, x_line="dif", y_line="Snake_pop_size", title="Space: Dif VS Snake Population Size", subt="Gen 16sims", y_label="Snake Popsize", x_label="Dif")
```

Wow each color is in its own line! Snake GA #2 and #3 lead to a higher snake population size and phenotype. Newt GA #1 (circles) tend to lead to lower newt population sizes and phenotypes. Newt GA #2 and #3 (triangles and squares) lead to a higher new phenotype and population size. Snake GA #1 and #4 lead to newts having a larger population size and phenotype. There is some sort of pattern appearing from the GA combinations. Best to worst snake GA #2 -> #3 -> #4 -> #1! Best to worst newt GA #2 -> #3 -> #4 -> #1 OMG these match over population size! There is a difference between the GAs!


#### Heatmap

```{r, late plots Heatmap}

min_gen=45000
max_gen=50000
#heatmap
build_heatmap(GA1_tall_tall_file, min_gen=min_gen, max_gen=max_gen, fill_line="Snake_pop_size", fill_line_text="Snake Population Size", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA", red_blue=F)

build_heatmap(GA1_tall_tall_file, min_gen=min_gen, max_gen=max_gen, fill_line="dif", fill_line_text="Snake-Newt", title="Newt GA by Snake GA", subt="16 Sim Heatmap", y_label="Snake GA", x_label="Newt GA",red_blue=T)

```

As I saw with the summary plots there is remarkable color gradient going from GA #2 -> #3 -> #4 -> #1 for both the newts and snakes. For example the 4th row set (snake GA #4), snake population size grows in the order from GA #2 -> #3 -> #4 -> #1. In this row newt phenotype diminishes GA #2 -> #3 -> #4 -> #1. The same thing happens in in the columns. Column 1 (newt GA #1) snake population size and phenotype get smaller from GA #2 -> #3 -> #4 -> #1. All column gradients go lighter to darker in order GA #2 -> #3 -> #4 -> #1. All row gradients go lighter to darker in GA #2 -> #3 -> #4 -> #1.


## What is up with the correlations

We got to see how the correlation of local phenotype changed overtime. Now, I will take a closer look at what is occurring at the local level. There were 100 local measurements taken every 20 generation for all of my simulation. I took in information about the number of individuals, the min/mean/max phenotype, and the phenotypes sd. To see what is going on, I will plot a measurement (i.e. phenotype) of both newts and snakes at each local population. I will also local newt phenotype by local snake phenotype to see the if there truly is correlation. In the correlation plots I color each point by its location in the map corner, edge, middle (orange, green, blue). 

We will look at two simulations. 1) Snake_1.0e-09_0.05_Newt_1.0e-09_0.05_2 which did not have a high correlation in the plots above. 2) Snake_1.0e-08_0.005_Newt_1.0e-08_0.005_3 which had high correlation values. I will show two plots for each file, one in the middle of my simulation (25,000 gen) and one towards the end (49,000 gen). Snake and newt local phenotypes will be squares and circles, respectively. Locations run 1-5 on the x-axis and 1-20 on the y axis. The locations are more evenly space in SLiM, because my map was tall (please ignore the squished-ness here).

### Snake_1.0e-09_0.05_Newt_1.0e-09_0.05_2


```{r, cor grid by location}

#grid_tall_file


file_name= "Snake_1.0e-09_0.05_Newt_1.0e-09_0.05_2"
spegen=25001

GA1<-grid_tall_file[which(grid_tall_file$snake_newt_rep==file_name & grid_tall_file$generation==spegen),]

GA1_mean = GA1[,grepl("generation|mean", names(GA1)) ]

data_long_mean <- gather(GA1_mean, condition, measurement, newt_mean_pheno_0:snake_mean_pheno_99, factor_key=TRUE)

data_long_mean[,c("species","type", "type2","location")]<- str_split_fixed(data_long_mean$condition, "_", 4)

data_long_mean_short<-data_long_mean

#data_long_mean_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
#data_long_mean_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

data_long_mean_short$y_loc<- rep(c(rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(2, 2)),20)
data_long_mean_short$x_loc<-c(rep.int(1, 10),rep.int(2, 10),rep.int(3, 10),rep.int(4, 10),rep.int(5, 10),rep.int(6, 10),rep.int(7, 10),rep.int(8, 10),rep.int(9, 10),rep.int(10, 10),rep.int(11, 10),rep.int(12, 10),rep.int(13, 10),rep.int(14, 10),rep.int(15, 10),rep.int(16, 10),rep.int(17, 10),rep.int(18, 10),rep.int(19, 10),rep.int(20, 10))

main_plot<-ggplot(data_long_mean_short)+
  labs(title = "Mean Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_mean_short[which(data_long_mean_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_mean_short[which(data_long_mean_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_mean_short[which(data_long_mean_short$species=="snake"),]
newt<-data_long_mean_short[which(data_long_mean_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")

newt$info[newt$location %in% list(0, 4, 95, 99)] <- "corner"
newt$info[newt$location %in% list(1,2,3,5, 9,10, 14,15, 19,20, 24,25, 29,30, 34,35, 39,40, 44,45, 49,50, 54,55, 59,60, 64,65, 69,70, 74,75, 79,80, 84,85, 89,90, 94, 96, 97,98)]   <- "edge"

#newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
#newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("Mean Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)

    
```

After examining this plot, I see that there is no obvious correlation between newt and snake phenotype. There is one area with a higher newt phenotype, but that area does not also have a higher snake phenotype. There is only one area where newts and snakes have a low phenotype and that low phenotype is probably increasing the correlation (possibly incorrectly). I also try to look to see if the edges differ from the center of my simulations. In this case it seems like center and edges of my simulation are very similar. So now let's look at the later plot.

```{r, cor grid by location lateer}

#grid_tall_file


file_name= "Snake_1.0e-09_0.05_Newt_1.0e-09_0.05_2"
spegen=49001

GA1<-grid_tall_file[which(grid_tall_file$snake_newt_rep==file_name & grid_tall_file$generation==spegen),]

GA1_mean = GA1[,grepl("generation|mean", names(GA1)) ]

data_long_mean <- gather(GA1_mean, condition, measurement, newt_mean_pheno_0:snake_mean_pheno_99, factor_key=TRUE)

data_long_mean[,c("species","type", "type2","location")]<- str_split_fixed(data_long_mean$condition, "_", 4)

data_long_mean_short<-data_long_mean

#data_long_mean_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
#data_long_mean_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

data_long_mean_short$y_loc<- rep(c(rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(2, 2)),20)
data_long_mean_short$x_loc<-c(rep.int(1, 10),rep.int(2, 10),rep.int(3, 10),rep.int(4, 10),rep.int(5, 10),rep.int(6, 10),rep.int(7, 10),rep.int(8, 10),rep.int(9, 10),rep.int(10, 10),rep.int(11, 10),rep.int(12, 10),rep.int(13, 10),rep.int(14, 10),rep.int(15, 10),rep.int(16, 10),rep.int(17, 10),rep.int(18, 10),rep.int(19, 10),rep.int(20, 10))

main_plot<-ggplot(data_long_mean_short)+
  labs(title = "Mean Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_mean_short[which(data_long_mean_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_mean_short[which(data_long_mean_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_mean_short[which(data_long_mean_short$species=="snake"),]
newt<-data_long_mean_short[which(data_long_mean_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")


newt$info[newt$location %in% list(0, 4, 95, 99)] <- "corner"
newt$info[newt$location %in% list(1,2,3,5, 9,10, 14,15, 19,20, 24,25, 29,30, 34,35, 39,40, 44,45, 49,50, 54,55, 59,60, 64,65, 69,70, 74,75, 79,80, 84,85, 89,90, 94, 96, 97,98)]   <- "edge"

#newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
#newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("Mean Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)

    
```

In a later section of this simulation I see a newt phenotype range (darker in the center lighter on the edges) that is not repeated in the snakes (very much the same across the map). There is no correlation between newt and snake phenotypes in this plot. There is no difference between corner, edge, or middle sample in my simulation.

### Snake_1.0e-08_0.005_Newt_1.0e-08_0.005_3

This simulation was more correlated (in a previous section) than the simulation we just observed above.

```{r, cor grid by location round 2}

#grid_tall_file


file_name= "Snake_1.0e-08_0.005_Newt_1.0e-08_0.005_3"
spegen=25001

GA1<-grid_tall_file[which(grid_tall_file$snake_newt_rep==file_name & grid_tall_file$generation==spegen),]

GA1_mean = GA1[,grepl("generation|mean", names(GA1)) ]

data_long_mean <- gather(GA1_mean, condition, measurement, newt_mean_pheno_0:snake_mean_pheno_99, factor_key=TRUE)

data_long_mean[,c("species","type", "type2","location")]<- str_split_fixed(data_long_mean$condition, "_", 4)

data_long_mean_short<-data_long_mean

#data_long_mean_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
#data_long_mean_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

data_long_mean_short$y_loc<- rep(c(rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(2, 2)),20)
data_long_mean_short$x_loc<-c(rep.int(1, 10),rep.int(2, 10),rep.int(3, 10),rep.int(4, 10),rep.int(5, 10),rep.int(6, 10),rep.int(7, 10),rep.int(8, 10),rep.int(9, 10),rep.int(10, 10),rep.int(11, 10),rep.int(12, 10),rep.int(13, 10),rep.int(14, 10),rep.int(15, 10),rep.int(16, 10),rep.int(17, 10),rep.int(18, 10),rep.int(19, 10),rep.int(20, 10))

main_plot<-ggplot(data_long_mean_short)+
  labs(title = "Mean Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_mean_short[which(data_long_mean_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_mean_short[which(data_long_mean_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_mean_short[which(data_long_mean_short$species=="snake"),]
newt<-data_long_mean_short[which(data_long_mean_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")


newt$info[newt$location %in% list(0, 4, 95, 99)] <- "corner"
newt$info[newt$location %in% list(1,2,3,5, 9,10, 14,15, 19,20, 24,25, 29,30, 34,35, 39,40, 44,45, 49,50, 54,55, 59,60, 64,65, 69,70, 74,75, 79,80, 84,85, 89,90, 94, 96, 97,98)]   <- "edge"

#newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
#newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("Mean Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)

    
```

The fist thing I noticed in this simulation were stripes that looked so similar that I wondered if my data collection was malfunctioning. But after a closer inspection they are not identical. There are areas where both newt and snake phenotypes are high and areas where both newt and snake phenotypes are low. This leads to a positive correlation between local newt and snake phenotype. It is interesting to see them presented in stripes. I thought it would look more like squares or blocks. I think something is up with how I have placed the locations here. There is no noticeable difference between the corner, edge, or middle samples of my simulation. Now, lets look at a later point in this simulation.


```{r, cor grid by location round 2 later}

#grid_tall_file


file_name= "Snake_1.0e-08_0.005_Newt_1.0e-08_0.005_3"
spegen=49001

GA1<-grid_tall_file[which(grid_tall_file$snake_newt_rep==file_name & grid_tall_file$generation==spegen),]

GA1_mean = GA1[,grepl("generation|mean", names(GA1)) ]

data_long_mean <- gather(GA1_mean, condition, measurement, newt_mean_pheno_0:snake_mean_pheno_99, factor_key=TRUE)

data_long_mean[,c("species","type", "type2","location")]<- str_split_fixed(data_long_mean$condition, "_", 4)

data_long_mean_short<-data_long_mean

#data_long_mean_short$y_loc<- rep(c(rep.int(20, 2),rep.int(19, 2),rep.int(18, 2),rep.int(17, 2),rep.int(16, 2),rep.int(15, 2),rep.int(14, 2),rep.int(13, 2),rep.int(12, 2),rep.int(11, 2),rep.int(10, 2),rep.int(9, 2),rep.int(8, 2),rep.int(7, 2),rep.int(6, 2),rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(1, 2)),5)
#data_long_mean_short$x_loc<-c(rep.int(1, 40),rep.int(2, 40),rep.int(3, 40),rep.int(4, 40),rep.int(5, 40))

data_long_mean_short$y_loc<- rep(c(rep.int(5, 2),rep.int(4, 2),rep.int(3, 2),rep.int(2, 2),rep.int(2, 2)),20)
data_long_mean_short$x_loc<-c(rep.int(1, 10),rep.int(2, 10),rep.int(3, 10),rep.int(4, 10),rep.int(5, 10),rep.int(6, 10),rep.int(7, 10),rep.int(8, 10),rep.int(9, 10),rep.int(10, 10),rep.int(11, 10),rep.int(12, 10),rep.int(13, 10),rep.int(14, 10),rep.int(15, 10),rep.int(16, 10),rep.int(17, 10),rep.int(18, 10),rep.int(19, 10),rep.int(20, 10))

main_plot<-ggplot(data_long_mean_short)+
  labs(title = "Mean Phenotype of Locations",
              subtitle = paste0(file_name, ", Generation: ", spegen),
              fill = "Toxicity/Resistance")+
  geom_point(data = data_long_mean_short[which(data_long_mean_short$species=="snake"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 6, shape = 22, ) +
  geom_point(data = data_long_mean_short[which(data_long_mean_short$species=="newt"),], aes(x = x_loc, y = y_loc, fill = as.numeric(measurement)), size = 4, shape = 21, ) +
  scale_fill_viridis_c()+
  theme_bw()+
  theme(legend.justification = "top")

snake<-data_long_mean_short[which(data_long_mean_short$species=="snake"),]
newt<-data_long_mean_short[which(data_long_mean_short$species=="newt"),]
newt$snake_value <- snake$measurement
cor(as.numeric(snake$measurement), as.numeric(newt$measurement), use="complete.obs")


newt$info[newt$location %in% list(0, 4, 95, 99)] <- "corner"
newt$info[newt$location %in% list(1,2,3,5, 9,10, 14,15, 19,20, 24,25, 29,30, 34,35, 39,40, 44,45, 49,50, 54,55, 59,60, 64,65, 69,70, 74,75, 79,80, 84,85, 89,90, 94, 96, 97,98)]   <- "edge"

#newt$info[newt$location %in% list(1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20, 39, 40, 59, 60, 79, 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98)]   <- "edge"
#newt$info[newt$location %in% list(0, 19, 80, 99)] <- "corner"
newt$info[is.na(newt$info)]<- "middle"

extra_plot <- ggplot(newt)+
  ggtitle("Mean Phenotype") +
  xlab("Newt") + ylab("Snake")+
  geom_point(aes(x = as.numeric(measurement), y = as.numeric(snake_value), color=info), size = 1 ) +
  theme_bw()+
   theme(text = element_text(size=10),title =element_text(size=8),
         legend.text = element_text(size = 8),
         legend.position ="bottom",
         legend.key.size = unit(0.1, "lines"),
         legend.title=element_blank())+
  guides(shape = guide_legend(override.aes = list(size = 1)),
         color = guide_legend(override.aes = list(size = 1)))

#try to arrage the grids

main_plot +  inset_element(extra_plot, left = 1., bottom = -0.12, right = 1.35, top = 0.5)

    
```

At a later point in this simulation there is still some stripe action, but there is also a bit of a gradient. It seems like the snake phenotype is higher on the edges than in the center. There some grey patches in the left, so there might not be a bunch of newts on the left side of the map. There is no noticeable difference between the corner, edge, or middle section of my simulation map. The stripe-ness still bewilders me...


## Animation of correlation

In this plot we look at how the newt and snake phenotypes in "uncorrelated" Snake_1.0e-09_0.05_Newt_1.0e-09_0.05_2 file interact though-out time. I wonder if there is too much stochasticity in the simulation to get a good correlation between newts and snakes. Here we will look at how newt and snake phenotypes at local areas are interacting

```{r, plot experiment}
library(plotly)
library(gapminder)


file_name= "Snake_1.0e-09_0.05_Newt_1.0e-09_0.05_2"

plotty_mean <- gather(grid_tall_file[which(grid_tall_file$snake_newt_rep==file_name),][,grepl("generation|mean", names(grid_tall_file)) ], condition, measurement, newt_mean_pheno_0:snake_mean_pheno_99, factor_key=TRUE)

plotty_mean[,c("species","type", "type2","location")]<- str_split_fixed(plotty_mean$condition, "_", 4)

#snake<-plotty_mean[which(plotty_mean$species=="snake"),]
#newt<-plotty_mean[which(plotty_mean$species=="newt"),]
#newt$snake_value <- snake$measurement



plotty_mean_min<-plotty_mean
plotty_mean_min_s<-plotty_mean_min[which(plotty_mean_min$species=="snake"),]
plotty_mean_min_s$newt_values<-plotty_mean_min[which(plotty_mean_min$species=="newt"),"measurement"]
#plotty_mean_min_s$edge <- "FALSE"
#plotty_mean_min_s$edge <- plotty_mean_min_s$location %in% list(0, 1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20, 39, 40, 59, 60, 79, 80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99)

#plotty_mean_min_s$edge <- plotty_mean_min_s$location %in% list(1,2,3,5, 9,10, 14,15, 19,20, 24,25, 29,30, 34,35, 39,40, 44,45, 49,50, 54,55, 59,60, 64,65, 69,70, 74,75, 79,80, 84,85, 89,90, 94, 96, 97,98) 



#plotty_mean_min_s$info[plotty_mean_min_s$edge=="TRUE"]  <- "edge"
#plotty_mean_min_s$info[plotty_mean_min_s$edge=="FALSE"]  <- "middle"
plotty_mean_min_s$info[plotty_mean_min_s$location %in% list(0, 19, 80, 99)] <- "corner"
plotty_mean_min_s$info[plotty_mean_min_s$location %in% list(1,2,3,5, 9,10, 14,15, 19,20, 24,25, 29,30, 34,35, 39,40, 44,45, 49,50, 54,55, 59,60, 64,65, 69,70, 74,75, 79,80, 84,85, 89,90, 94, 96, 97,98)] <- "edge"
plotty_mean_min_s$info[is.na(plotty_mean_min_s$info)]<- "middle"
#unique(plotty_mean_min_s$info)
p <- plotty_mean_min_s %>%
  plot_ly(
    x = ~as.numeric(newt_values), # newt pheno
    y = ~as.numeric(measurement), #snake pheno
    frame = ~generation, 
    text = ~factor(location), 
    color = ~info, 
    hoverinfo = "text",
    type = 'scatter',
    mode = 'markers'
  ) %>%
  layout(
    xaxis = list(
      type = "log"
    )
  )
p
```
