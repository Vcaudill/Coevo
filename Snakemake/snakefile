"""
Snakefile for running GA Experiment

slim -m -t -d "snake_mu_rate = ${1}" -d "newt_mu_rate = ${2}" -d "snake_mu_effect_sd = ${3}" -d "newt_mu_effect_sd = ${4}" -d "msprime_file = '${5}'" -d "treename = '${6}'" -d "outpath = '${7}'" -d "myFN = '${9}'" -d "NUMGENS = ${10}" '/home/vcaudill/kernlab/coevo/SLiM_script/cost_1on1.slim';

"""

import sys, os, subprocess, glob, pathlib
import numpy as np

rng = np.random.default_rng(12345) ## this will help to se the seeds for the msprime and slim sims

# ###############################################################################
# GENERAL RULES & GLOBALS
# ###############################################################################

# Where you would like all output files from analysis to live

cwd = os.getcwd()
input_dir = "/home/vcaudill/kernlab/coevo/"
prefix = "snakemake_test"
exp_dir = "csv"
input_pre = input_dir + "/" + exp_dir
out_msprime = input_dir + "/" + prefix + "/msprime/"
out_slim = input_dir + "/" + prefix + "/slim/"



#s_param = ["0.1","0.2","0.3","0.4","0.5"] #sigma
#m_param = ["0.1","0.2","0.3","0.4","0.5"] #mutation
#g_param = ["5000","50000","100000"] #ending generation

## These are the output files that I expect
out = expand(f"{out_slim}slim_trees_snake_mu_rate_{{s_mus}}_newt_mu_rate_{{n_mus}}_snake_mu_effect_sd_{{s_es}}_newt_mu_effect_sd_{{n_es}}_sigma_{{sigma}}_rep_{{rep}}_late_{{gen_end}}", rep=range(2), s_mus=config["s_mus"], n_mus=config["n_mus"], s_es=config["s_es"], n_es=config["n_es"], sigma=config["sigma"], gen_end=config["gen_end"])
seeds = rng.integers(0,2**32, len(out))
out = [out[i]+f"_FN_{seeds[i]}.ts" for i in range(len(out))]

# --dry--run
# Run full pipeline!
rule all: 
   input: out


rule slim:
    input: msprime file
    output: out_slim +".{s_par}.p_ctg.gfa"
    #threads:20
    shell: slim -m -t -d "snake_mu_rate = ${1}" -d "newt_mu_rate = ${2}" -d "snake_mu_effect_sd = ${3}" -d "newt_mu_effect_sd = ${4}" -d "msprime_file = '${5}'" -d "treename = '${6}'" -d "outpath = '${7}'" -d "myFN = '${9}'" -d "NUMGENS = ${10}" '/home/vcaudill/kernlab/coevo/SLiM_script/cost_1on1.slim';



rule msprime:
    #input: dont need infile
    output: msp_ts=f"{out_msprime}trees_N_{{N}}_mu_{{mu}}_rep_{{rep}}_seed_{{seed}}.ts"
    #threads:20
    shell: 'python /home/vcaudill/kernlab/coevo/MSprime_script/snake_newt_gv_.py ${snake_mu_rate} ${newt_mu_rate} ${snake_mu_effect_sd} ${newt_mu_effect_sd} ${datadir} ${tag} ${seed}'
